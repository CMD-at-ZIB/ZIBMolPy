<?xml version="1.0" encoding="ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>zgf_reweight</title>
  <link rel="stylesheet" href="epydoc.css" type="text/css" />
  <script type="text/javascript" src="epydoc.js"></script>
	
	<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        displayMath: [['$$', '$$'], ["\\[", "\\]"]]
      }
    });
    </script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
	</head>
	

<body bgcolor="white" text="black" link="blue" vlink="#204080"
      alink="#204080">
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">
  <!-- Home link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="ZIBMolPy-module.html">Home</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="https://wiki.kobv.de/confluence/display/AGCMD/ZIBMolPy">ZIBMolPy</a></th>
          </tr></table></th>
  </tr>
</table>
<table width="100%" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="100%">
      <span class="breadcrumbs">
        Module&nbsp;zgf_reweight
      </span>
    </td>
    <td>
      <table cellpadding="0" cellspacing="0">
        <!-- hide/show private -->
        <tr><td align="right"><span class="options"
            >[<a href="frames.html" target="_top">frames</a
            >]&nbsp;|&nbsp;<a href="zgf_reweight-module.html"
            target="_top">no&nbsp;frames</a>]</span></td></tr>
      </table>
    </td>
  </tr>
</table>
<!-- ==================== MODULE DESCRIPTION ==================== -->
<h1 class="epydoc">Module zgf_reweight</h1><p class="nomargin-top"><span class="codelink"><a href="zgf_reweight-pysrc.html">source&nbsp;code</a></span></p>
<h1 class="heading">What it does</h1>
    <p><b>This is the 7th step of ZIBgridfree.</b></p>
    <p>This tool will perform a direct reweighting of the sampling nodes. 
    It should be run on a pool of converged nodes. From the reweighted 
    partial distributions that were sampled in the individual nodes one can
    reconstruct the overall Boltzmann distribution.</p>
    <p><b>The next step is <a href="zgf_analyze-module.html" 
    class="link">zgf_analyze</a>.</b></p>
  <h1 class="heading">How it works</h1>
    <p>At the command line, type:</p>
<pre class="literalblock">
       $ zgf_reweight [options]
</pre>
  <h1 class="heading">Direct reweighting strategies</h1>
    <p>Currently, three different direct reweighting approaches are 
    implemented:</p>
    <ul>
      <li>
        Direct free energy reweighting: see Klimm, Bujotzek, Weber 2011
      </li>
      <li>
        Entropy reweighting: see Klimm, Bujotzek, Weber 2011
      </li>
      <li>
        Presampling analysis reweighting: see formula 18 in Fackeldey, 
        Durmaz, Weber 2011
      </li>
    </ul>
    <p><b>Entropy reweighting &quot;entropy&quot;</b></p>
    <p>Choice of the evaluation region: The size of the evaluation region 
    is chosen as large as the variance of the internal coordinate time 
    series (obtained from the sampling trajectory), averaged over all 
    nodes.</p>
    <p>Choice of reference points by energy region: Instead of specifying a
    fixed number of reference points, we follow the approach of M. Weber, 
    K. Andrae: A simple method for the estimation of entropy differences. 
    MATCH Comm. Math. Comp. Chem. 63(2):319-332, 2010. This means we are 
    picking a dynamic number of reference points by declaring all the 
    sampling points within a certain energy region (which we choose as the 
    energy standard deviation) around the mean potential energy of the 
    system as reference points.</p>
    <p>Finding of near points: Our measure of conformational entropy is 
    based on an estimate of the sampling density. For this purpose, we look
    for sampling points adjacent to our reference points and denote them as
    'near points'. As each reference points counts as its own near point, 
    the number of near points can never be zero.</p>
    <p>Calculation of entropy and free energy: The number of (inverse) near
    points enters directly into the calculation of entropy for the 
    corresponding node. Finally, thermodynamic weights are derived from the
    free energy differences. Some useful information regarding reference 
    points, their adjacent near points and energy averages will be stored 
    in the reweighting log file.</p>
  <h1 class="heading">Frame weights</h1>
    <p>As in Gromacs we use simple harmonic restraint potentials to 
    approximate the original radial basis functions used in ZIBgridfree, we
    have to perform a frame reweighting of the sampling trajectories 
    afterwards. The frame weight of each individual frame q belonging to 
    node i is calculated as:</p>
    <p>frame_weight(q) = &Phi;_i(q) / exp( -&beta; * penalty_potential_i(q)
    )</p>
    <p>Frame weights should yield values between zero and one. Slightly 
    higher values than one are feasible. Note that frame weights are not 
    normalized to one.</p>
    <p>Overweight frames are possible if &Phi;_i(q) is high (meaning that q
    is well within its native basis function) while the 
    penalty_potential_i(q) is high, as well. Hence, q is punished wrongly, 
    as q should only be punished by the penalty potential if it attempts to
    leave its native basis function.</p>
    <p>When overweight frames occur, this probably means that your 
    approximation of the &Phi; function for the corresponding node is bad. 
    You can check this by using <a href="zgf_browser-module.html" 
    class="link">zgf_browser</a>. If the penalty potential kicks in where 
    &Phi; is still good, you have got a bad approximation of the &Phi; 
    function. Overweight frame weights will trigger a WARNING. Furthermore,
    any occurence of overweight frame weights will be stored in the 
    reweighting log file.</p>
  <h1 class="heading">Options</h1>
    <ul>
      <li>
        <b>sol-energy</b>:
<pre class="literalblock">
 help: include SOL energy contribution
 short_name: s
 datatype: bool
 long_name: sol-energy
</pre>
      </li>
      <li>
        <b>ignore-convergence</b>:
<pre class="literalblock">
 help: reweight despite not-converged
 short_name: c
 datatype: bool
 long_name: ignore-convergence
</pre>
      </li>
      <li>
        <b>method</b>:
<pre class="literalblock">
 default: entropy
 help: reweighting method
 short_name: m
 datatype: choice
 choices: ('entropy', 'direct', 'presampling')
 long_name: method
</pre>
      </li>
      <li>
        <b>presamp-temp</b>:
<pre class="literalblock">
 default: 1000
 help: presampling temp
 short_name: t
 datatype: float
 long_name: presamp-temp
</pre>
      </li>
      <li>
        <b>save-refpoints</b>:
<pre class="literalblock">
 help: save refpoints in observables
 short_name: r
 datatype: bool
 long_name: save-refpoints
</pre>
      </li>
    </ul>

<!-- ==================== FUNCTIONS ==================== -->
<a name="section-Functions"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td align="left" colspan="2" class="table-header">
    <span class="table-header">Functions</span></td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="is_applicable"></a><span class="summary-sig-name">is_applicable</span>()</span></td>
          <td align="right" valign="top">
            <span class="codelink"><a href="zgf_reweight-pysrc.html#is_applicable">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="main"></a><span class="summary-sig-name">main</span>()</span></td>
          <td align="right" valign="top">
            <span class="codelink"><a href="zgf_reweight-pysrc.html#main">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="reweight_direct"></a><span class="summary-sig-name">reweight_direct</span>(<span class="summary-sig-arg">nodes</span>,
        <span class="summary-sig-arg">moi_energies</span>,
        <span class="summary-sig-arg">sol_energy</span>,
        <span class="summary-sig-arg">save_ref</span>=<span class="summary-sig-default">False</span>)</span></td>
          <td align="right" valign="top">
            <span class="codelink"><a href="zgf_reweight-pysrc.html#reweight_direct">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="reweight_entropy"></a><span class="summary-sig-name">reweight_entropy</span>(<span class="summary-sig-arg">nodes</span>,
        <span class="summary-sig-arg">moi_energies</span>,
        <span class="summary-sig-arg">sol_energy</span>,
        <span class="summary-sig-arg">save_ref</span>=<span class="summary-sig-default">False</span>)</span></td>
          <td align="right" valign="top">
            <span class="codelink"><a href="zgf_reweight-pysrc.html#reweight_entropy">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="reweight_presampling"></a><span class="summary-sig-name">reweight_presampling</span>(<span class="summary-sig-arg">nodes</span>,
        <span class="summary-sig-arg">presamp_temp</span>,
        <span class="summary-sig-arg">moi_energies</span>,
        <span class="summary-sig-arg">sol_energy</span>)</span></td>
          <td align="right" valign="top">
            <span class="codelink"><a href="zgf_reweight-pysrc.html#reweight_presampling">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="load_energies"></a><span class="summary-sig-name">load_energies</span>(<span class="summary-sig-arg">node</span>,
        <span class="summary-sig-arg">with_penalty</span>=<span class="summary-sig-default">True</span>,
        <span class="summary-sig-arg">with_sol</span>=<span class="summary-sig-default">True</span>,
        <span class="summary-sig-arg">with_moi_energies</span>=<span class="summary-sig-default">True</span>)</span></td>
          <td align="right" valign="top">
            <span class="codelink"><a href="zgf_reweight-pysrc.html#load_energies">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="zgf_reweight-module.html#check_restraint_energy" class="summary-sig-name">check_restraint_energy</a>(<span class="summary-sig-arg">node</span>)</span><br />
      Uses <a 
      href="http://www.gromacs.org/Documentation/Gromacs_Utilities/g_energy"
      target="_top">g_energy</a> to read the distance- and 
      dihedral-restraint energies used by gromacs for every frame of the 
      node's trajectory and compares them with our own values, which are 
      calulated in <a href="ZIBMolPy.restraint-module.html" 
      class="link">ZIBMolPy.restraint</a>.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="zgf_reweight-pysrc.html#check_restraint_energy">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
</table>
<!-- ==================== VARIABLES ==================== -->
<a name="section-Variables"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td align="left" colspan="2" class="table-header">
    <span class="table-header">Variables</span></td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a name="CRITICAL_FRAME_WEIGHT"></a><span class="summary-name">CRITICAL_FRAME_WEIGHT</span> = <code title="5.0">5.0</code>
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a href="zgf_reweight-module.html#options_desc" class="summary-name">options_desc</a> = <code title="[&lt;ZIBMolPy.ui.Option sol-energy&gt;, &lt;ZIBMolPy.ui.Option ignore-convergen\
ce&gt;, &lt;ZIBMolPy.ui.Option method&gt;, &lt;ZIBMolPy.ui.Option presamp-temp&gt;, &lt;\
ZIBMolPy.ui.Option save-refpoints&gt;]">[&lt;ZIBMolPy.ui.Option sol-energy&gt;, &lt;ZIBMolPy.ui.<code class="variable-ellipsis">...</code></code>
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a name="__package__"></a><span class="summary-name">__package__</span> = <code title="None">None</code><br />
      hash(x)
    </td>
  </tr>
</table>
<!-- ==================== FUNCTION DETAILS ==================== -->
<a name="section-FunctionDetails"></a>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td align="left" colspan="2" class="table-header">
    <span class="table-header">Function Details</span></td>
</tr>
</table>
<a name="check_restraint_energy"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">check_restraint_energy</span>(<span class="sig-arg">node</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="zgf_reweight-pysrc.html#check_restraint_energy">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Uses <a 
  href="http://www.gromacs.org/Documentation/Gromacs_Utilities/g_energy" 
  target="_top">g_energy</a> to read the distance- and dihedral-restraint 
  energies used by gromacs for every frame of the node's trajectory and 
  compares them with our own values, which are calulated in <a 
  href="ZIBMolPy.restraint-module.html" 
  class="link">ZIBMolPy.restraint</a>. This is a safety measure to ensure 
  that <a href="ZIBMolPy.restraint-module.html" 
  class="link">ZIBMolPy.restraint</a> is consistent with gromacs.</p>
  <dl class="fields">
  </dl>
</td></tr></table>
</div>
<br />
<!-- ==================== VARIABLES DETAILS ==================== -->
<a name="section-VariablesDetails"></a>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td align="left" colspan="2" class="table-header">
    <span class="table-header">Variables Details</span></td>
</tr>
</table>
<a name="options_desc"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <h3 class="epydoc">options_desc</h3>
  
  <dl class="fields">
  </dl>
  <dl class="fields">
    <dt>Value:</dt>
      <dd><table><tr><td><pre class="variable">
[&lt;ZIBMolPy.ui.Option sol-energy&gt;, &lt;ZIBMolPy.ui.Option ignore-convergen<span class="variable-linewrap"><img src="crarr.png" alt="\" /></span>
ce&gt;, &lt;ZIBMolPy.ui.Option method&gt;, &lt;ZIBMolPy.ui.Option presamp-temp&gt;, &lt;<span class="variable-linewrap"><img src="crarr.png" alt="\" /></span>
ZIBMolPy.ui.Option save-refpoints&gt;]
</pre></td></tr></table>
</dd>
  </dl>
</td></tr></table>
</div>
<br />
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">
  <!-- Home link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="ZIBMolPy-module.html">Home</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="https://wiki.kobv.de/confluence/display/AGCMD/ZIBMolPy">ZIBMolPy</a></th>
          </tr></table></th>
  </tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%%">
  <tr>
    <td align="left" class="footer">
    Generated by Epydoc 3.0.1 on Mon Jun 11 14:23:48 2012
    </td>
    <td align="right" class="footer">
      <a target="mainFrame" href="http://epydoc.sourceforge.net"
        >http://epydoc.sourceforge.net</a>
    </td>
  </tr>
</table>

<script type="text/javascript">
  <!--
  // Private objects are initially displayed (because if
  // javascript is turned off then we want them to be
  // visible); but by default, we want to hide them.  So hide
  // them unless we have a cookie that says to show them.
  checkCookie();
  // -->
</script>
</body>
</html>
