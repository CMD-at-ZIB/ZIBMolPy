<?xml version="1.0" encoding="ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>zgf_mdrun</title>
  <link rel="stylesheet" href="epydoc.css" type="text/css" />
  <script type="text/javascript" src="epydoc.js"></script>
	
	<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        displayMath: [['$$', '$$'], ["\\[", "\\]"]]
      }
    });
    </script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
	</head>
	

<body bgcolor="white" text="black" link="blue" vlink="#204080"
      alink="#204080">
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">
  <!-- Home link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="ZIBMolPy-module.html">Home</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="https://wiki.kobv.de/confluence/display/AGCMD/ZIBMolPy">ZIBMolPy</a></th>
          </tr></table></th>
  </tr>
</table>
<table width="100%" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="100%">
      <span class="breadcrumbs">
        Module&nbsp;zgf_mdrun
      </span>
    </td>
    <td>
      <table cellpadding="0" cellspacing="0">
        <!-- hide/show private -->
        <tr><td align="right"><span class="options"
            >[<a href="frames.html" target="_top">frames</a
            >]&nbsp;|&nbsp;<a href="zgf_mdrun-pysrc.html"
            target="_top">no&nbsp;frames</a>]</span></td></tr>
      </table>
    </td>
  </tr>
</table>
<h1 class="epydoc">Source Code for <a href="zgf_mdrun-module.html">Module zgf_mdrun</a></h1>
<pre class="py-src">
<a name="L1"></a><tt class="py-lineno">  1</tt>  <tt class="py-line"><tt class="py-comment">#!/usr/bin/python -u</tt> </tt>
<a name="L2"></a><tt class="py-lineno">  2</tt>  <tt class="py-line"><tt class="py-comment"># -*- coding: utf-8 -*-</tt> </tt>
<a name="L3"></a><tt class="py-lineno">  3</tt>  <tt class="py-line"> </tt>
<a name="L4"></a><tt class="py-lineno">  4</tt>  <tt class="py-line"><tt class="py-docstring">"""</tt> </tt>
<a name="L5"></a><tt class="py-lineno">  5</tt>  <tt class="py-line"><tt class="py-docstring">What it does</tt> </tt>
<a name="L6"></a><tt class="py-lineno">  6</tt>  <tt class="py-line"><tt class="py-docstring">============</tt> </tt>
<a name="L7"></a><tt class="py-lineno">  7</tt>  <tt class="py-line"><tt class="py-docstring">        B{This is the fifth step of ZIBgridfree.}</tt> </tt>
<a name="L8"></a><tt class="py-lineno">  8</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L9"></a><tt class="py-lineno">  9</tt>  <tt class="py-line"><tt class="py-docstring">        This tool is a worker script that will process a pool of 'mdrun-able' nodes in node-wise manner. If the script finds a node that is not locked, it will lock the node and process it by initiating a sampling with Gromacs mdrun. After the sampling is finished, the worker will check for convergence by applying the Gelman-Rubin (GR) convergence criterion to the timeseries of internal coordinates. If all internal coordinates satisfy the GR criterion, the node does not need further processing and will be filed as 'converged'. If one or more internal coordinates do not satisfy the GR criterion, the node will remain in state 'mdrun_able' for further processing. If the node has already exceeded the maximum number of sampling extensions, it will be filed as 'not-converged'. Finally, the node will be unlocked.</tt> </tt>
<a name="L10"></a><tt class="py-lineno"> 10</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L11"></a><tt class="py-lineno"> 11</tt>  <tt class="py-line"><tt class="py-docstring">        The sampling progress and current node status can be monitored with L{zgf_browser}.</tt> </tt>
<a name="L12"></a><tt class="py-lineno"> 12</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L13"></a><tt class="py-lineno"> 13</tt>  <tt class="py-line"><tt class="py-docstring">        Note that several workers can process the same node pool simultaneously.</tt> </tt>
<a name="L14"></a><tt class="py-lineno"> 14</tt>  <tt class="py-line"><tt class="py-docstring">        </tt> </tt>
<a name="L15"></a><tt class="py-lineno"> 15</tt>  <tt class="py-line"><tt class="py-docstring">        B{The next step is L{zgf_refine}, if you want to refine or extend nodes where convergence has not been achieved. Otherwise, you can proceed with L{zgf_reweight}.}</tt> </tt>
<a name="L16"></a><tt class="py-lineno"> 16</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L17"></a><tt class="py-lineno"> 17</tt>  <tt class="py-line"><tt class="py-docstring">How it works</tt> </tt>
<a name="L18"></a><tt class="py-lineno"> 18</tt>  <tt class="py-line"><tt class="py-docstring">============</tt> </tt>
<a name="L19"></a><tt class="py-lineno"> 19</tt>  <tt class="py-line"><tt class="py-docstring">        At the command line, type::</tt> </tt>
<a name="L20"></a><tt class="py-lineno"> 20</tt>  <tt class="py-line"><tt class="py-docstring">                $ zgf_mdrun [options]</tt> </tt>
<a name="L21"></a><tt class="py-lineno"> 21</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L22"></a><tt class="py-lineno"> 22</tt>  <tt class="py-line"><tt class="py-docstring">Stale node locks</tt> </tt>
<a name="L23"></a><tt class="py-lineno"> 23</tt>  <tt class="py-line"><tt class="py-docstring">================</tt> </tt>
<a name="L24"></a><tt class="py-lineno"> 24</tt>  <tt class="py-line"><tt class="py-docstring">        If a worker process hits the wall time while it is sampling a certain node, or the sampling crashes for some unforeseen reason, B{the affected node will remain in a locked state} ("stale node lock"). While the node lock remains, the affected node cannot be sampled by another worker process. If you encounter a stale node lock, you can use L{zgf_cleanup} to have it removed. Afterwards, normal processing of the node can be resumed.</tt> </tt>
<a name="L25"></a><tt class="py-lineno"> 25</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L26"></a><tt class="py-lineno"> 26</tt>  <tt class="py-line"><tt class="py-docstring">Convergence</tt> </tt>
<a name="L27"></a><tt class="py-lineno"> 27</tt>  <tt class="py-line"><tt class="py-docstring">===========</tt> </tt>
<a name="L28"></a><tt class="py-lineno"> 28</tt>  <tt class="py-line"><tt class="py-docstring">        Information about the convergence properties of individual internal coordinates can be found in the convergence log file named 'node0042_convergence.log' stored in the node directory. B{Note that convergence as indicated by the GR criterion does not necessarily mean that the sampling is sufficient}. If, at the end of the day, not all of the nodes in the pool have converged, you can use L{zgf_browser} to get an impression where convergence was not achieved. Generally, if a node is situated in a transition region, convergence may not be achieved at all and refinement is the only option.</tt> </tt>
<a name="L29"></a><tt class="py-lineno"> 29</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L30"></a><tt class="py-lineno"> 30</tt>  <tt class="py-line"><tt class="py-docstring">Automatic refinement</tt> </tt>
<a name="L31"></a><tt class="py-lineno"> 31</tt>  <tt class="py-line"><tt class="py-docstring">====================</tt> </tt>
<a name="L32"></a><tt class="py-lineno"> 32</tt>  <tt class="py-line"><tt class="py-docstring">        If you use this option, L{zgf_mdrun} will automatically call L{zgf_refine} at most n times (where n is an option specified by you) in order to resolve nodes that have not converged. Refinement is performed using default parameters from L{zgf_create_nodes}.</tt> </tt>
<a name="L33"></a><tt class="py-lineno"> 33</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L34"></a><tt class="py-lineno"> 34</tt>  <tt class="py-line"><tt class="py-docstring">Nodes with state "mdrun-failed"</tt> </tt>
<a name="L35"></a><tt class="py-lineno"> 35</tt>  <tt class="py-line"><tt class="py-docstring">===============================</tt> </tt>
<a name="L36"></a><tt class="py-lineno"> 36</tt>  <tt class="py-line"><tt class="py-docstring">        If something goes wrong during the sampling of a node, it will adapt the state "mdrun-failed". After the problem is resolved (see below), you have to recover the node back to state "mdrun-able" by calling the tool L{zgf_recover_state}. Failed node samplings are often related to domain decomposition problems in systems with explicit solvent and L{linear coordinates&lt;ZIBMolPy.internals&gt;}:</tt> </tt>
<a name="L37"></a><tt class="py-lineno"> 37</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L38"></a><tt class="py-lineno"> 38</tt>  <tt class="py-line"><tt class="py-docstring">                - B{Problem:} Domain decomposition does not fit number of nodes/PME nodes. B{Solution:} Change number of nodes/PME nodes, or change PME grid dimension, or use particle decomposition.</tt> </tt>
<a name="L39"></a><tt class="py-lineno"> 39</tt>  <tt class="py-line"><tt class="py-docstring">                - B{Problem:} Domain decomposition does not work due to (long) distance restraints (L{linear coordinates&lt;ZIBMolPy.internals&gt;}). B{Solution:} Change number of nodes/PME nodes, or change PME grid dimension, or use particle decomposition. Using particle decomposition and a relatively low number of processors per node (preferably sharing the same memory) works best in difficult cases.</tt> </tt>
<a name="L40"></a><tt class="py-lineno"> 40</tt>  <tt class="py-line"><tt class="py-docstring">                - B{Problem:} Unspecific crashes when L{linear coordinates&lt;ZIBMolPy.internals&gt;} are used. B{Solution:} Make periodic box bigger (at least double the size of the largest L{linear coordinate&lt;ZIBMolPy.internals&gt;}).</tt> </tt>
<a name="L41"></a><tt class="py-lineno"> 41</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L42"></a><tt class="py-lineno"> 42</tt>  <tt class="py-line"><tt class="py-docstring">        A recovered node sampling will be resumed at the latest Gromacs checkpoint file (state.cpt).</tt> </tt>
<a name="L43"></a><tt class="py-lineno"> 43</tt>  <tt class="py-line"><tt class="py-docstring">"""</tt> </tt>
<a name="L44"></a><tt class="py-lineno"> 44</tt>  <tt class="py-line"> </tt>
<a name="L45"></a><tt class="py-lineno"> 45</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt id="link-0" class="py-name" targets="Package ZIBMolPy=ZIBMolPy-module.html"><a title="ZIBMolPy" class="py-name" href="#" onclick="return doclink('link-0', 'ZIBMolPy', 'link-0');">ZIBMolPy</a></tt><tt class="py-op">.</tt><tt id="link-1" class="py-name" targets="Module ZIBMolPy.utils=ZIBMolPy.utils-module.html"><a title="ZIBMolPy.utils" class="py-name" href="#" onclick="return doclink('link-1', 'utils', 'link-1');">utils</a></tt> <tt class="py-keyword">import</tt> <tt id="link-2" class="py-name" targets="Function ZIBMolPy.utils.check_call()=ZIBMolPy.utils-module.html#check_call"><a title="ZIBMolPy.utils.check_call" class="py-name" href="#" onclick="return doclink('link-2', 'check_call', 'link-2');">check_call</a></tt> </tt>
<a name="L46"></a><tt class="py-lineno"> 46</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt id="link-3" class="py-name"><a title="ZIBMolPy" class="py-name" href="#" onclick="return doclink('link-3', 'ZIBMolPy', 'link-0');">ZIBMolPy</a></tt><tt class="py-op">.</tt><tt id="link-4" class="py-name" targets="Variable ZIBMolPy.node.Node.pool=ZIBMolPy.node.Node-class.html#pool,Module ZIBMolPy.pool=ZIBMolPy.pool-module.html"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-4', 'pool', 'link-4');">pool</a></tt> <tt class="py-keyword">import</tt> <tt id="link-5" class="py-name" targets="Class ZIBMolPy.pool.Pool=ZIBMolPy.pool.Pool-class.html"><a title="ZIBMolPy.pool.Pool" class="py-name" href="#" onclick="return doclink('link-5', 'Pool', 'link-5');">Pool</a></tt> </tt>
<a name="L47"></a><tt class="py-lineno"> 47</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt id="link-6" class="py-name"><a title="ZIBMolPy" class="py-name" href="#" onclick="return doclink('link-6', 'ZIBMolPy', 'link-0');">ZIBMolPy</a></tt><tt class="py-op">.</tt><tt id="link-7" class="py-name" targets="Module ZIBMolPy.algorithms=ZIBMolPy.algorithms-module.html"><a title="ZIBMolPy.algorithms" class="py-name" href="#" onclick="return doclink('link-7', 'algorithms', 'link-7');">algorithms</a></tt> <tt class="py-keyword">import</tt> <tt id="link-8" class="py-name" targets="Function ZIBMolPy.algorithms.gelman_rubin()=ZIBMolPy.algorithms-module.html#gelman_rubin"><a title="ZIBMolPy.algorithms.gelman_rubin" class="py-name" href="#" onclick="return doclink('link-8', 'gelman_rubin', 'link-8');">gelman_rubin</a></tt> </tt>
<a name="L48"></a><tt class="py-lineno"> 48</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt id="link-9" class="py-name"><a title="ZIBMolPy" class="py-name" href="#" onclick="return doclink('link-9', 'ZIBMolPy', 'link-0');">ZIBMolPy</a></tt><tt class="py-op">.</tt><tt id="link-10" class="py-name" targets="Module ZIBMolPy.ui=ZIBMolPy.ui-module.html"><a title="ZIBMolPy.ui" class="py-name" href="#" onclick="return doclink('link-10', 'ui', 'link-10');">ui</a></tt> <tt class="py-keyword">import</tt> <tt id="link-11" class="py-name" targets="Class ZIBMolPy.ui.Option=ZIBMolPy.ui.Option-class.html"><a title="ZIBMolPy.ui.Option" class="py-name" href="#" onclick="return doclink('link-11', 'Option', 'link-11');">Option</a></tt><tt class="py-op">,</tt> <tt id="link-12" class="py-name" targets="Class ZIBMolPy.ui.OptionsList=ZIBMolPy.ui.OptionsList-class.html"><a title="ZIBMolPy.ui.OptionsList" class="py-name" href="#" onclick="return doclink('link-12', 'OptionsList', 'link-12');">OptionsList</a></tt> </tt>
<a name="L49"></a><tt class="py-lineno"> 49</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt id="link-13" class="py-name"><a title="ZIBMolPy" class="py-name" href="#" onclick="return doclink('link-13', 'ZIBMolPy', 'link-0');">ZIBMolPy</a></tt><tt class="py-op">.</tt><tt id="link-14" class="py-name" targets="Package ZIBMolPy.io=ZIBMolPy.io-module.html"><a title="ZIBMolPy.io" class="py-name" href="#" onclick="return doclink('link-14', 'io', 'link-14');">io</a></tt><tt class="py-op">.</tt><tt id="link-15" class="py-name" targets="Module ZIBMolPy.io.trr=ZIBMolPy.io.trr-module.html"><a title="ZIBMolPy.io.trr" class="py-name" href="#" onclick="return doclink('link-15', 'trr', 'link-15');">trr</a></tt> <tt class="py-keyword">import</tt> <tt id="link-16" class="py-name" targets="Class ZIBMolPy.io.trr.TrrFile=ZIBMolPy.io.trr.TrrFile-class.html"><a title="ZIBMolPy.io.trr.TrrFile" class="py-name" href="#" onclick="return doclink('link-16', 'TrrFile', 'link-16');">TrrFile</a></tt> </tt>
<a name="L50"></a><tt class="py-lineno"> 50</tt>  <tt class="py-line"> </tt>
<a name="L51"></a><tt class="py-lineno"> 51</tt>  <tt class="py-line"><tt class="py-keyword">import</tt> <tt id="link-17" class="py-name" targets="Module zgf_refine=zgf_refine-module.html"><a title="zgf_refine" class="py-name" href="#" onclick="return doclink('link-17', 'zgf_refine', 'link-17');">zgf_refine</a></tt> </tt>
<a name="L52"></a><tt class="py-lineno"> 52</tt>  <tt class="py-line"><tt class="py-keyword">import</tt> <tt id="link-18" class="py-name" targets="Module zgf_grompp=zgf_grompp-module.html"><a title="zgf_grompp" class="py-name" href="#" onclick="return doclink('link-18', 'zgf_grompp', 'link-18');">zgf_grompp</a></tt> </tt>
<a name="L53"></a><tt class="py-lineno"> 53</tt>  <tt class="py-line"> </tt>
<a name="L54"></a><tt class="py-lineno"> 54</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt class="py-name">subprocess</tt> <tt class="py-keyword">import</tt> <tt class="py-name">call</tt><tt class="py-op">,</tt> <tt class="py-name">Popen</tt><tt class="py-op">,</tt> <tt class="py-name">PIPE</tt> </tt>
<a name="L55"></a><tt class="py-lineno"> 55</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt class="py-name">warnings</tt> <tt class="py-keyword">import</tt> <tt class="py-name">warn</tt> </tt>
<a name="L56"></a><tt class="py-lineno"> 56</tt>  <tt class="py-line"><tt class="py-keyword">import</tt> <tt class="py-name">traceback</tt> </tt>
<a name="L57"></a><tt class="py-lineno"> 57</tt>  <tt class="py-line"><tt class="py-keyword">import</tt> <tt class="py-name">sys</tt> </tt>
<a name="L58"></a><tt class="py-lineno"> 58</tt>  <tt class="py-line"> </tt>
<a name="L59"></a><tt class="py-lineno"> 59</tt>  <tt class="py-line"><tt class="py-keyword">import</tt> <tt class="py-name">time</tt> </tt>
<a name="L60"></a><tt class="py-lineno"> 60</tt>  <tt class="py-line"> </tt>
<a name="L61"></a><tt class="py-lineno"> 61</tt>  <tt class="py-line"><tt class="py-keyword">import</tt> <tt class="py-name">os</tt> </tt>
<a name="L62"></a><tt class="py-lineno"> 62</tt>  <tt class="py-line"><tt class="py-keyword">import</tt> <tt class="py-name">re</tt> </tt>
<a name="L63"></a><tt class="py-lineno"> 63</tt>  <tt class="py-line"><tt class="py-keyword">import</tt> <tt class="py-name">numpy</tt> <tt class="py-keyword">as</tt> <tt class="py-name">np</tt> </tt>
<a name="L64"></a><tt class="py-lineno"> 64</tt>  <tt class="py-line"> </tt>
<a name="L65"></a><tt class="py-lineno"> 65</tt>  <tt class="py-line"><tt id="link-19" class="py-name" targets="Variable zgf_analyze.options_desc=zgf_analyze-module.html#options_desc,Variable zgf_cleanup.options_desc=zgf_cleanup-module.html#options_desc,Variable zgf_concatenate_stuff.options_desc=zgf_concatenate_stuff-module.html#options_desc,Variable zgf_create_nodes.options_desc=zgf_create_nodes-module.html#options_desc,Variable zgf_create_pmatrix.options_desc=zgf_create_pmatrix-module.html#options_desc,Variable zgf_create_pool.options_desc=zgf_create_pool-module.html#options_desc,Variable zgf_create_rates.options_desc=zgf_create_rates-module.html#options_desc,Variable zgf_create_tnodes.options_desc=zgf_create_tnodes-module.html#options_desc,Variable zgf_create_unrestrained_nodes.options_desc=zgf_create_unrestrained_nodes-module.html#options_desc,Variable zgf_discard_solvent.options_desc=zgf_discard_solvent-module.html#options_desc,Variable zgf_export_pool.options_desc=zgf_export_pool-module.html#options_desc,Variable zgf_extract_conformations.options_desc=zgf_extract_conformations-module.html#options_desc,Variable zgf_genion.options_desc=zgf_genion-module.html#options_desc,Variable zgf_grompp.options_desc=zgf_grompp-module.html#options_desc,Variable zgf_mdrun.options_desc=zgf_mdrun-module.html#options_desc,Variable zgf_recover_state.options_desc=zgf_recover_state-module.html#options_desc,Variable zgf_refine.options_desc=zgf_refine-module.html#options_desc,Variable zgf_remove_nodes.options_desc=zgf_remove_nodes-module.html#options_desc,Variable zgf_rerun.options_desc=zgf_rerun-module.html#options_desc,Variable zgf_reweight.options_desc=zgf_reweight-module.html#options_desc,Variable zgf_reweight_wham.options_desc=zgf_reweight_wham-module.html#options_desc,Variable zgf_setup_nodes.options_desc=zgf_setup_nodes-module.html#options_desc,Variable zgf_solvate_nodes.options_desc=zgf_solvate_nodes-module.html#options_desc,Variable zgf_submit_job_HLRN.options_desc=zgf_submit_job_HLRN-module.html#options_desc,Variable zgf_upgrade.options_desc=zgf_upgrade-module.html#options_desc"><a title="zgf_analyze.options_desc
zgf_cleanup.options_desc
zgf_concatenate_stuff.options_desc
zgf_create_nodes.options_desc
zgf_create_pmatrix.options_desc
zgf_create_pool.options_desc
zgf_create_rates.options_desc
zgf_create_tnodes.options_desc
zgf_create_unrestrained_nodes.options_desc
zgf_discard_solvent.options_desc
zgf_export_pool.options_desc
zgf_extract_conformations.options_desc
zgf_genion.options_desc
zgf_grompp.options_desc
zgf_mdrun.options_desc
zgf_recover_state.options_desc
zgf_refine.options_desc
zgf_remove_nodes.options_desc
zgf_rerun.options_desc
zgf_reweight.options_desc
zgf_reweight_wham.options_desc
zgf_setup_nodes.options_desc
zgf_solvate_nodes.options_desc
zgf_submit_job_HLRN.options_desc
zgf_upgrade.options_desc" class="py-name" href="#" onclick="return doclink('link-19', 'options_desc', 'link-19');">options_desc</a></tt> <tt class="py-op">=</tt> <tt id="link-20" class="py-name"><a title="ZIBMolPy.ui.OptionsList" class="py-name" href="#" onclick="return doclink('link-20', 'OptionsList', 'link-12');">OptionsList</a></tt><tt class="py-op">(</tt><tt class="py-op">[</tt>  </tt>
<a name="L66"></a><tt class="py-lineno"> 66</tt>  <tt class="py-line">        <tt id="link-21" class="py-name"><a title="ZIBMolPy.ui.Option" class="py-name" href="#" onclick="return doclink('link-21', 'Option', 'link-11');">Option</a></tt><tt class="py-op">(</tt><tt class="py-string">"s"</tt><tt class="py-op">,</tt> <tt class="py-string">"seq"</tt><tt class="py-op">,</tt> <tt class="py-string">"bool"</tt><tt class="py-op">,</tt> <tt class="py-string">"Suppress MPI"</tt><tt class="py-op">,</tt> <tt class="py-name">default</tt><tt class="py-op">=</tt><tt class="py-name">False</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> </tt>
<a name="L67"></a><tt class="py-lineno"> 67</tt>  <tt class="py-line">        <tt id="link-22" class="py-name"><a title="ZIBMolPy.ui.Option" class="py-name" href="#" onclick="return doclink('link-22', 'Option', 'link-11');">Option</a></tt><tt class="py-op">(</tt><tt class="py-string">"n"</tt><tt class="py-op">,</tt> <tt class="py-string">"np"</tt><tt class="py-op">,</tt> <tt class="py-string">"int"</tt><tt class="py-op">,</tt> <tt class="py-string">"Number of processors to be used for MPI"</tt><tt class="py-op">,</tt> <tt class="py-name">default</tt><tt class="py-op">=</tt><tt class="py-number">4</tt><tt class="py-op">,</tt> <tt class="py-name">min_value</tt><tt class="py-op">=</tt><tt class="py-number">1</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> </tt>
<a name="L68"></a><tt class="py-lineno"> 68</tt>  <tt class="py-line">        <tt id="link-23" class="py-name"><a title="ZIBMolPy.ui.Option" class="py-name" href="#" onclick="return doclink('link-23', 'Option', 'link-11');">Option</a></tt><tt class="py-op">(</tt><tt class="py-string">"t"</tt><tt class="py-op">,</tt> <tt class="py-string">"nt"</tt><tt class="py-op">,</tt> <tt class="py-string">"int"</tt><tt class="py-op">,</tt> <tt class="py-string">"Number of threads to start, 0 is guess"</tt><tt class="py-op">,</tt> <tt class="py-name">default</tt><tt class="py-op">=</tt><tt class="py-number">0</tt><tt class="py-op">,</tt> <tt class="py-name">min_value</tt><tt class="py-op">=</tt><tt class="py-number">0</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> </tt>
<a name="L69"></a><tt class="py-lineno"> 69</tt>  <tt class="py-line">        <tt id="link-24" class="py-name"><a title="ZIBMolPy.ui.Option" class="py-name" href="#" onclick="return doclink('link-24', 'Option', 'link-11');">Option</a></tt><tt class="py-op">(</tt><tt class="py-string">"p"</tt><tt class="py-op">,</tt> <tt class="py-string">"npme"</tt><tt class="py-op">,</tt> <tt class="py-string">"int"</tt><tt class="py-op">,</tt> <tt class="py-string">"Number of separate processors to be used for PME, -1 is guess"</tt><tt class="py-op">,</tt> <tt class="py-name">default</tt><tt class="py-op">=</tt><tt class="py-op">-</tt><tt class="py-number">1</tt><tt class="py-op">,</tt> <tt class="py-name">min_value</tt><tt class="py-op">=</tt><tt class="py-op">-</tt><tt class="py-number">1</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> </tt>
<a name="L70"></a><tt class="py-lineno"> 70</tt>  <tt class="py-line">        <tt id="link-25" class="py-name"><a title="ZIBMolPy.ui.Option" class="py-name" href="#" onclick="return doclink('link-25', 'Option', 'link-11');">Option</a></tt><tt class="py-op">(</tt><tt class="py-string">"r"</tt><tt class="py-op">,</tt> <tt class="py-string">"reprod"</tt><tt class="py-op">,</tt> <tt class="py-string">"bool"</tt><tt class="py-op">,</tt> <tt class="py-string">"Avoid mdrun optimizations that affect binary reproducibility"</tt><tt class="py-op">,</tt> <tt class="py-name">default</tt><tt class="py-op">=</tt><tt class="py-name">False</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> </tt>
<a name="L71"></a><tt class="py-lineno"> 71</tt>  <tt class="py-line">        <tt id="link-26" class="py-name"><a title="ZIBMolPy.ui.Option" class="py-name" href="#" onclick="return doclink('link-26', 'Option', 'link-11');">Option</a></tt><tt class="py-op">(</tt><tt class="py-string">"d"</tt><tt class="py-op">,</tt> <tt class="py-string">"pd"</tt><tt class="py-op">,</tt> <tt class="py-string">"bool"</tt><tt class="py-op">,</tt> <tt class="py-string">"Use particle decomposition"</tt><tt class="py-op">,</tt> <tt class="py-name">default</tt><tt class="py-op">=</tt><tt class="py-name">False</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> </tt>
<a name="L72"></a><tt class="py-lineno"> 72</tt>  <tt class="py-line">        <tt id="link-27" class="py-name"><a title="ZIBMolPy.ui.Option" class="py-name" href="#" onclick="return doclink('link-27', 'Option', 'link-11');">Option</a></tt><tt class="py-op">(</tt><tt class="py-string">"c"</tt><tt class="py-op">,</tt> <tt class="py-string">"convtest"</tt><tt class="py-op">,</tt> <tt class="py-string">"bool"</tt><tt class="py-op">,</tt> <tt class="py-string">"Test if nodes are converged - does not simulate"</tt><tt class="py-op">,</tt> <tt class="py-name">default</tt><tt class="py-op">=</tt><tt class="py-name">False</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> </tt>
<a name="L73"></a><tt class="py-lineno"> 73</tt>  <tt class="py-line">        <tt id="link-28" class="py-name"><a title="ZIBMolPy.ui.Option" class="py-name" href="#" onclick="return doclink('link-28', 'Option', 'link-11');">Option</a></tt><tt class="py-op">(</tt><tt class="py-string">"a"</tt><tt class="py-op">,</tt> <tt class="py-string">"auto-refines"</tt><tt class="py-op">,</tt> <tt class="py-string">"int"</tt><tt class="py-op">,</tt> <tt class="py-string">"Number of automatic refinements"</tt><tt class="py-op">,</tt> <tt class="py-name">default</tt><tt class="py-op">=</tt><tt class="py-number">0</tt><tt class="py-op">,</tt> <tt class="py-name">min_value</tt><tt class="py-op">=</tt><tt class="py-number">0</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> </tt>
<a name="L74"></a><tt class="py-lineno"> 74</tt>  <tt class="py-line">        <tt id="link-29" class="py-name"><a title="ZIBMolPy.ui.Option" class="py-name" href="#" onclick="return doclink('link-29', 'Option', 'link-11');">Option</a></tt><tt class="py-op">(</tt><tt class="py-string">"m"</tt><tt class="py-op">,</tt> <tt class="py-string">"multistart"</tt><tt class="py-op">,</tt> <tt class="py-string">"bool"</tt><tt class="py-op">,</tt> <tt class="py-string">"Sampling is restarted instead of extended"</tt><tt class="py-op">,</tt> <tt class="py-name">default</tt><tt class="py-op">=</tt><tt class="py-name">False</tt><tt class="py-op">)</tt> </tt>
<a name="L75"></a><tt class="py-lineno"> 75</tt>  <tt class="py-line">        <tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L76"></a><tt class="py-lineno"> 76</tt>  <tt class="py-line"> </tt>
<a name="L77"></a><tt class="py-lineno"> 77</tt>  <tt class="py-line"><tt class="py-name">sys</tt><tt class="py-op">.</tt><tt class="py-name">modules</tt><tt class="py-op">[</tt><tt class="py-name">__name__</tt><tt class="py-op">]</tt><tt class="py-op">.</tt><tt class="py-name">__doc__</tt> <tt class="py-op">+=</tt> <tt id="link-30" class="py-name"><a title="zgf_analyze.options_desc
zgf_cleanup.options_desc
zgf_concatenate_stuff.options_desc
zgf_create_nodes.options_desc
zgf_create_pmatrix.options_desc
zgf_create_pool.options_desc
zgf_create_rates.options_desc
zgf_create_tnodes.options_desc
zgf_create_unrestrained_nodes.options_desc
zgf_discard_solvent.options_desc
zgf_export_pool.options_desc
zgf_extract_conformations.options_desc
zgf_genion.options_desc
zgf_grompp.options_desc
zgf_mdrun.options_desc
zgf_recover_state.options_desc
zgf_refine.options_desc
zgf_remove_nodes.options_desc
zgf_rerun.options_desc
zgf_reweight.options_desc
zgf_reweight_wham.options_desc
zgf_setup_nodes.options_desc
zgf_solvate_nodes.options_desc
zgf_submit_job_HLRN.options_desc
zgf_upgrade.options_desc" class="py-name" href="#" onclick="return doclink('link-30', 'options_desc', 'link-19');">options_desc</a></tt><tt class="py-op">.</tt><tt id="link-31" class="py-name" targets="Method ZIBMolPy.ui.OptionsList.epytext()=ZIBMolPy.ui.OptionsList-class.html#epytext"><a title="ZIBMolPy.ui.OptionsList.epytext" class="py-name" href="#" onclick="return doclink('link-31', 'epytext', 'link-31');">epytext</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt> <tt class="py-comment"># for epydoc</tt> </tt>
<a name="L78"></a><tt class="py-lineno"> 78</tt>  <tt class="py-line"> </tt>
<a name="L79"></a><tt class="py-lineno"> 79</tt>  <tt class="py-line"> </tt>
<a name="is_applicable"></a><div id="is_applicable-def"><a name="L80"></a><tt class="py-lineno"> 80</tt> <a class="py-toggle" href="#" id="is_applicable-toggle" onclick="return toggle('is_applicable');">-</a><tt class="py-line"><tt class="py-keyword">def</tt> <a class="py-def-name" href="zgf_mdrun-module.html#is_applicable">is_applicable</a><tt class="py-op">(</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
</div><div id="is_applicable-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="is_applicable-expanded"><a name="L81"></a><tt class="py-lineno"> 81</tt>  <tt class="py-line">        <tt id="link-32" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-32', 'pool', 'link-4');">pool</a></tt> <tt class="py-op">=</tt> <tt id="link-33" class="py-name"><a title="ZIBMolPy.pool.Pool" class="py-name" href="#" onclick="return doclink('link-33', 'Pool', 'link-5');">Pool</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L82"></a><tt class="py-lineno"> 82</tt>  <tt class="py-line">        <tt class="py-keyword">return</tt><tt class="py-op">(</tt><tt class="py-name">len</tt><tt class="py-op">(</tt><tt id="link-34" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-34', 'pool', 'link-4');">pool</a></tt><tt class="py-op">.</tt><tt id="link-35" class="py-name" targets="Method ZIBMolPy.pool.NodeList.where()=ZIBMolPy.pool.NodeList-class.html#where"><a title="ZIBMolPy.pool.NodeList.where" class="py-name" href="#" onclick="return doclink('link-35', 'where', 'link-35');">where</a></tt><tt class="py-op">(</tt><tt class="py-string">"state in ('em-mdrun-able', 'mdrun-able', 'converged', 'not-converged', 'rerun-able-converged', 'rerun-able-not-converged')"</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> <tt class="py-op">&gt;</tt> <tt class="py-number">0</tt><tt class="py-op">)</tt> </tt>
</div><a name="L83"></a><tt class="py-lineno"> 83</tt>  <tt class="py-line">         </tt>
<a name="L84"></a><tt class="py-lineno"> 84</tt>  <tt class="py-line"> </tt>
<a name="L85"></a><tt class="py-lineno"> 85</tt>  <tt class="py-line"><tt class="py-comment">#===============================================================================</tt> </tt>
<a name="main"></a><div id="main-def"><a name="L86"></a><tt class="py-lineno"> 86</tt> <a class="py-toggle" href="#" id="main-toggle" onclick="return toggle('main');">-</a><tt class="py-line"><tt class="py-keyword">def</tt> <a class="py-def-name" href="zgf_mdrun-module.html#main">main</a><tt class="py-op">(</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
</div><div id="main-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="main-expanded"><a name="L87"></a><tt class="py-lineno"> 87</tt>  <tt class="py-line">        <tt class="py-name">options</tt> <tt class="py-op">=</tt> <tt id="link-36" class="py-name"><a title="zgf_analyze.options_desc
zgf_cleanup.options_desc
zgf_concatenate_stuff.options_desc
zgf_create_nodes.options_desc
zgf_create_pmatrix.options_desc
zgf_create_pool.options_desc
zgf_create_rates.options_desc
zgf_create_tnodes.options_desc
zgf_create_unrestrained_nodes.options_desc
zgf_discard_solvent.options_desc
zgf_export_pool.options_desc
zgf_extract_conformations.options_desc
zgf_genion.options_desc
zgf_grompp.options_desc
zgf_mdrun.options_desc
zgf_recover_state.options_desc
zgf_refine.options_desc
zgf_remove_nodes.options_desc
zgf_rerun.options_desc
zgf_reweight.options_desc
zgf_reweight_wham.options_desc
zgf_setup_nodes.options_desc
zgf_solvate_nodes.options_desc
zgf_submit_job_HLRN.options_desc
zgf_upgrade.options_desc" class="py-name" href="#" onclick="return doclink('link-36', 'options_desc', 'link-19');">options_desc</a></tt><tt class="py-op">.</tt><tt id="link-37" class="py-name" targets="Method ZIBMolPy.ui.OptionsList.parse_args()=ZIBMolPy.ui.OptionsList-class.html#parse_args"><a title="ZIBMolPy.ui.OptionsList.parse_args" class="py-name" href="#" onclick="return doclink('link-37', 'parse_args', 'link-37');">parse_args</a></tt><tt class="py-op">(</tt><tt class="py-name">sys</tt><tt class="py-op">.</tt><tt class="py-name">argv</tt><tt class="py-op">)</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">]</tt> </tt>
<a name="L88"></a><tt class="py-lineno"> 88</tt>  <tt class="py-line">        <tt id="link-38" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-38', 'pool', 'link-4');">pool</a></tt> <tt class="py-op">=</tt> <tt id="link-39" class="py-name"><a title="ZIBMolPy.pool.Pool" class="py-name" href="#" onclick="return doclink('link-39', 'Pool', 'link-5');">Pool</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L89"></a><tt class="py-lineno"> 89</tt>  <tt class="py-line">         </tt>
<a name="L90"></a><tt class="py-lineno"> 90</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt><tt class="py-op">(</tt><tt class="py-name">options</tt><tt class="py-op">.</tt><tt class="py-name">convtest</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L91"></a><tt class="py-lineno"> 91</tt>  <tt class="py-line">                <tt class="py-keyword">for</tt> <tt class="py-name">n</tt> <tt class="py-keyword">in</tt> <tt id="link-40" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-40', 'pool', 'link-4');">pool</a></tt><tt class="py-op">.</tt><tt id="link-41" class="py-name"><a title="ZIBMolPy.pool.NodeList.where" class="py-name" href="#" onclick="return doclink('link-41', 'where', 'link-35');">where</a></tt><tt class="py-op">(</tt><tt class="py-string">"state in ('converged', 'not-converged')"</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L92"></a><tt class="py-lineno"> 92</tt>  <tt class="py-line">                        <tt class="py-keyword">print</tt><tt class="py-op">(</tt><tt class="py-string">"\n\nRunning Gelman-Rubin on %s"</tt><tt class="py-op">%</tt><tt class="py-name">n</tt><tt class="py-op">)</tt> </tt>
<a name="L93"></a><tt class="py-lineno"> 93</tt>  <tt class="py-line">                        <tt id="link-42" class="py-name" targets="Function zgf_mdrun.conv_check_gelman_rubin()=zgf_mdrun-module.html#conv_check_gelman_rubin"><a title="zgf_mdrun.conv_check_gelman_rubin" class="py-name" href="#" onclick="return doclink('link-42', 'conv_check_gelman_rubin', 'link-42');">conv_check_gelman_rubin</a></tt><tt class="py-op">(</tt><tt class="py-name">n</tt><tt class="py-op">)</tt> </tt>
<a name="L94"></a><tt class="py-lineno"> 94</tt>  <tt class="py-line">                <tt class="py-keyword">return</tt> <tt class="py-comment"># exit</tt> </tt>
<a name="L95"></a><tt class="py-lineno"> 95</tt>  <tt class="py-line"> </tt>
<a name="L96"></a><tt class="py-lineno"> 96</tt>  <tt class="py-line">        <tt class="py-name">auto_refines_counter</tt> <tt class="py-op">=</tt> <tt class="py-number">0</tt> </tt>
<a name="L97"></a><tt class="py-lineno"> 97</tt>  <tt class="py-line">        <tt class="py-keyword">while</tt><tt class="py-op">(</tt><tt class="py-name">True</tt><tt class="py-op">)</tt><tt class="py-op">:</tt>             </tt>
<a name="L98"></a><tt class="py-lineno"> 98</tt>  <tt class="py-line">                <tt id="link-43" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-43', 'pool', 'link-4');">pool</a></tt><tt class="py-op">.</tt><tt id="link-44" class="py-name" targets="Method ZIBMolPy.node.Node.reload()=ZIBMolPy.node.Node-class.html#reload,Method ZIBMolPy.pool.Pool.reload()=ZIBMolPy.pool.Pool-class.html#reload"><a title="ZIBMolPy.node.Node.reload
ZIBMolPy.pool.Pool.reload" class="py-name" href="#" onclick="return doclink('link-44', 'reload', 'link-44');">reload</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L99"></a><tt class="py-lineno"> 99</tt>  <tt class="py-line">                <tt id="link-45" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-45', 'pool', 'link-4');">pool</a></tt><tt class="py-op">.</tt><tt id="link-46" class="py-name" targets="Method ZIBMolPy.pool.Pool.reload_nodes()=ZIBMolPy.pool.Pool-class.html#reload_nodes"><a title="ZIBMolPy.pool.Pool.reload_nodes" class="py-name" href="#" onclick="return doclink('link-46', 'reload_nodes', 'link-46');">reload_nodes</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L100"></a><tt class="py-lineno">100</tt>  <tt class="py-line">                <tt class="py-keyword">for</tt> <tt class="py-name">n</tt> <tt class="py-keyword">in</tt> <tt id="link-47" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-47', 'pool', 'link-4');">pool</a></tt><tt class="py-op">:</tt> </tt>
<a name="L101"></a><tt class="py-lineno">101</tt>  <tt class="py-line">                        <tt class="py-name">n</tt><tt class="py-op">.</tt><tt id="link-48" class="py-name"><a title="ZIBMolPy.node.Node.reload
ZIBMolPy.pool.Pool.reload" class="py-name" href="#" onclick="return doclink('link-48', 'reload', 'link-44');">reload</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L102"></a><tt class="py-lineno">102</tt>  <tt class="py-line"> </tt>
<a name="L103"></a><tt class="py-lineno">103</tt>  <tt class="py-line">                <tt class="py-name">active_node</tt> <tt class="py-op">=</tt> <tt class="py-name">None</tt> </tt>
<a name="L104"></a><tt class="py-lineno">104</tt>  <tt class="py-line">                <tt class="py-keyword">for</tt> <tt class="py-name">n</tt> <tt class="py-keyword">in</tt> <tt id="link-49" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-49', 'pool', 'link-4');">pool</a></tt><tt class="py-op">.</tt><tt id="link-50" class="py-name"><a title="ZIBMolPy.pool.NodeList.where" class="py-name" href="#" onclick="return doclink('link-50', 'where', 'link-35');">where</a></tt><tt class="py-op">(</tt><tt class="py-string">"state in ('em-mdrun-able', 'mdrun-able', 'rerun-able-converged', 'rerun-able-not-converged')"</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L105"></a><tt class="py-lineno">105</tt>  <tt class="py-line">                        <tt class="py-keyword">if</tt><tt class="py-op">(</tt><tt class="py-name">n</tt><tt class="py-op">.</tt><tt id="link-51" class="py-name" targets="Method ZIBMolPy.node.Node.lock()=ZIBMolPy.node.Node-class.html#lock"><a title="ZIBMolPy.node.Node.lock" class="py-name" href="#" onclick="return doclink('link-51', 'lock', 'link-51');">lock</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L106"></a><tt class="py-lineno">106</tt>  <tt class="py-line">                                <tt class="py-name">active_node</tt> <tt class="py-op">=</tt> <tt class="py-name">n</tt> </tt>
<a name="L107"></a><tt class="py-lineno">107</tt>  <tt class="py-line">                                <tt class="py-keyword">break</tt> </tt>
<a name="L108"></a><tt class="py-lineno">108</tt>  <tt class="py-line"> </tt>
<a name="L109"></a><tt class="py-lineno">109</tt>  <tt class="py-line">                <tt class="py-keyword">if</tt><tt class="py-op">(</tt><tt class="py-name">active_node</tt> <tt class="py-op">==</tt> <tt class="py-name">None</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L110"></a><tt class="py-lineno">110</tt>  <tt class="py-line">                        <tt class="py-keyword">if</tt><tt class="py-op">(</tt><tt class="py-name">auto_refines_counter</tt> <tt class="py-op">&lt;</tt> <tt class="py-name">options</tt><tt class="py-op">.</tt><tt class="py-name">auto_refines</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L111"></a><tt class="py-lineno">111</tt>  <tt class="py-line">                                <tt class="py-name">auto_refines_counter</tt> <tt class="py-op">+=</tt> <tt class="py-number">1</tt> </tt>
<a name="L112"></a><tt class="py-lineno">112</tt>  <tt class="py-line">                                <tt class="py-keyword">print</tt><tt class="py-op">(</tt><tt class="py-string">"\n\nRunning 'zgf_refine --refine-all' for the %d time..."</tt><tt class="py-op">%</tt><tt class="py-name">auto_refines_counter</tt><tt class="py-op">)</tt> </tt>
<a name="L113"></a><tt class="py-lineno">113</tt>  <tt class="py-line">                                <tt id="link-52" class="py-name"><a title="zgf_refine" class="py-name" href="#" onclick="return doclink('link-52', 'zgf_refine', 'link-17');">zgf_refine</a></tt><tt class="py-op">.</tt><tt id="link-53" class="py-name" targets="Function zgf_analyze.main()=zgf_analyze-module.html#main,Function zgf_browser.main()=zgf_browser-module.html#main,Function zgf_cleanup.main()=zgf_cleanup-module.html#main,Function zgf_concatenate_stuff.main()=zgf_concatenate_stuff-module.html#main,Function zgf_create_nodes.main()=zgf_create_nodes-module.html#main,Function zgf_create_pmatrix.main()=zgf_create_pmatrix-module.html#main,Function zgf_create_pool.main()=zgf_create_pool-module.html#main,Function zgf_create_rates.main()=zgf_create_rates-module.html#main,Function zgf_create_tnodes.main()=zgf_create_tnodes-module.html#main,Function zgf_create_unrestrained_nodes.main()=zgf_create_unrestrained_nodes-module.html#main,Function zgf_discard_solvent.main()=zgf_discard_solvent-module.html#main,Function zgf_export_pool.main()=zgf_export_pool-module.html#main,Function zgf_extract_conformations.main()=zgf_extract_conformations-module.html#main,Function zgf_gauge_times.main()=zgf_gauge_times-module.html#main,Function zgf_genion.main()=zgf_genion-module.html#main,Function zgf_grompp.main()=zgf_grompp-module.html#main,Function zgf_mdrun.main()=zgf_mdrun-module.html#main,Function zgf_recover_state.main()=zgf_recover_state-module.html#main,Function zgf_refine.main()=zgf_refine-module.html#main,Function zgf_remove_nodes.main()=zgf_remove_nodes-module.html#main,Function zgf_rerun.main()=zgf_rerun-module.html#main,Function zgf_reweight.main()=zgf_reweight-module.html#main,Function zgf_reweight_wham.main()=zgf_reweight_wham-module.html#main,Function zgf_setup_nodes.main()=zgf_setup_nodes-module.html#main,Function zgf_solvate_nodes.main()=zgf_solvate_nodes-module.html#main,Function zgf_submit_job_HLRN.main()=zgf_submit_job_HLRN-module.html#main,Function zgf_test.main()=zgf_test-module.html#main,Function zgf_upgrade.main()=zgf_upgrade-module.html#main"><a title="zgf_analyze.main
zgf_browser.main
zgf_cleanup.main
zgf_concatenate_stuff.main
zgf_create_nodes.main
zgf_create_pmatrix.main
zgf_create_pool.main
zgf_create_rates.main
zgf_create_tnodes.main
zgf_create_unrestrained_nodes.main
zgf_discard_solvent.main
zgf_export_pool.main
zgf_extract_conformations.main
zgf_gauge_times.main
zgf_genion.main
zgf_grompp.main
zgf_mdrun.main
zgf_recover_state.main
zgf_refine.main
zgf_remove_nodes.main
zgf_rerun.main
zgf_reweight.main
zgf_reweight_wham.main
zgf_setup_nodes.main
zgf_solvate_nodes.main
zgf_submit_job_HLRN.main
zgf_test.main
zgf_upgrade.main" class="py-name" href="#" onclick="return doclink('link-53', 'main', 'link-53');">main</a></tt><tt class="py-op">(</tt><tt class="py-op">[</tt><tt class="py-string">"--refine-all"</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L114"></a><tt class="py-lineno">114</tt>  <tt class="py-line">                                <tt class="py-keyword">continue</tt> </tt>
<a name="L115"></a><tt class="py-lineno">115</tt>  <tt class="py-line">                        <tt class="py-keyword">else</tt><tt class="py-op">:</tt> </tt>
<a name="L116"></a><tt class="py-lineno">116</tt>  <tt class="py-line">                                <tt class="py-keyword">break</tt> <tt class="py-comment"># we're done - exit</tt> </tt>
<a name="L117"></a><tt class="py-lineno">117</tt>  <tt class="py-line">         </tt>
<a name="L118"></a><tt class="py-lineno">118</tt>  <tt class="py-line">                <tt class="py-keyword">try</tt><tt class="py-op">:</tt> </tt>
<a name="L119"></a><tt class="py-lineno">119</tt>  <tt class="py-line">                        <tt id="link-54" class="py-name" targets="Function zgf_mdrun.process()=zgf_mdrun-module.html#process"><a title="zgf_mdrun.process" class="py-name" href="#" onclick="return doclink('link-54', 'process', 'link-54');">process</a></tt><tt class="py-op">(</tt><tt class="py-name">active_node</tt><tt class="py-op">,</tt> <tt class="py-name">options</tt><tt class="py-op">)</tt> </tt>
<a name="L120"></a><tt class="py-lineno">120</tt>  <tt class="py-line">                        <tt class="py-name">active_node</tt><tt class="py-op">.</tt><tt id="link-55" class="py-name" targets="Method ZIBMolPy.node.Node.save()=ZIBMolPy.node.Node-class.html#save,Method ZIBMolPy.pool.Pool.save()=ZIBMolPy.pool.Pool-class.html#save"><a title="ZIBMolPy.node.Node.save
ZIBMolPy.pool.Pool.save" class="py-name" href="#" onclick="return doclink('link-55', 'save', 'link-55');">save</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L121"></a><tt class="py-lineno">121</tt>  <tt class="py-line">                        <tt class="py-name">active_node</tt><tt class="py-op">.</tt><tt id="link-56" class="py-name" targets="Method ZIBMolPy.node.Node.unlock()=ZIBMolPy.node.Node-class.html#unlock,Method ZIBMolPy.pool.NodeList.unlock()=ZIBMolPy.pool.NodeList-class.html#unlock"><a title="ZIBMolPy.node.Node.unlock
ZIBMolPy.pool.NodeList.unlock" class="py-name" href="#" onclick="return doclink('link-56', 'unlock', 'link-56');">unlock</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L122"></a><tt class="py-lineno">122</tt>  <tt class="py-line">                <tt class="py-keyword">except</tt><tt class="py-op">:</tt> </tt>
<a name="L123"></a><tt class="py-lineno">123</tt>  <tt class="py-line">                        <tt class="py-keyword">print</tt> <tt class="py-string">"MDRUN FAILED"</tt> </tt>
<a name="L124"></a><tt class="py-lineno">124</tt>  <tt class="py-line">                        <tt class="py-name">active_node</tt><tt class="py-op">.</tt><tt class="py-name">state</tt> <tt class="py-op">=</tt> <tt class="py-string">"mdrun-failed"</tt> </tt>
<a name="L125"></a><tt class="py-lineno">125</tt>  <tt class="py-line">                        <tt class="py-name">active_node</tt><tt class="py-op">.</tt><tt id="link-57" class="py-name"><a title="ZIBMolPy.node.Node.save
ZIBMolPy.pool.Pool.save" class="py-name" href="#" onclick="return doclink('link-57', 'save', 'link-55');">save</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L126"></a><tt class="py-lineno">126</tt>  <tt class="py-line">                        <tt class="py-name">active_node</tt><tt class="py-op">.</tt><tt id="link-58" class="py-name"><a title="ZIBMolPy.node.Node.unlock
ZIBMolPy.pool.NodeList.unlock" class="py-name" href="#" onclick="return doclink('link-58', 'unlock', 'link-56');">unlock</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L127"></a><tt class="py-lineno">127</tt>  <tt class="py-line">                        <tt class="py-name">traceback</tt><tt class="py-op">.</tt><tt class="py-name">print_exc</tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L128"></a><tt class="py-lineno">128</tt>  <tt class="py-line">                        <tt class="py-keyword">continue</tt> </tt>
</div><a name="L129"></a><tt class="py-lineno">129</tt>  <tt class="py-line">                         </tt>
<a name="L130"></a><tt class="py-lineno">130</tt>  <tt class="py-line"> </tt>
<a name="L131"></a><tt class="py-lineno">131</tt>  <tt class="py-line"><tt class="py-comment">#===============================================================================</tt> </tt>
<a name="process"></a><div id="process-def"><a name="L132"></a><tt class="py-lineno">132</tt> <a class="py-toggle" href="#" id="process-toggle" onclick="return toggle('process');">-</a><tt class="py-line"><tt class="py-keyword">def</tt> <a class="py-def-name" href="zgf_mdrun-module.html#process">process</a><tt class="py-op">(</tt><tt class="py-param">node</tt><tt class="py-op">,</tt> <tt class="py-param">options</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
</div><div id="process-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="process-expanded"><a name="L133"></a><tt class="py-lineno">133</tt>  <tt class="py-line">         </tt>
<a name="L134"></a><tt class="py-lineno">134</tt>  <tt class="py-line">        <tt class="py-name">cmd1</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-string">"mdrun"</tt><tt class="py-op">]</tt> </tt>
<a name="L135"></a><tt class="py-lineno">135</tt>  <tt class="py-line">         </tt>
<a name="L136"></a><tt class="py-lineno">136</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt><tt class="py-op">(</tt><tt id="link-59" class="py-name" targets="Module ZIBMolPy.node=ZIBMolPy.node-module.html"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-59', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt class="py-name">state</tt> <tt class="py-op">==</tt> <tt class="py-string">"em-mdrun-able"</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L137"></a><tt class="py-lineno">137</tt>  <tt class="py-line">                <tt class="py-name">cmd1</tt> <tt class="py-op">+=</tt> <tt class="py-op">[</tt><tt class="py-string">"-s"</tt><tt class="py-op">,</tt> <tt class="py-string">"../../"</tt><tt class="py-op">+</tt><tt id="link-60" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-60', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-61" class="py-name" targets="Variable ZIBMolPy.node.Node.tpr_fn=ZIBMolPy.node.Node-class.html#tpr_fn"><a title="ZIBMolPy.node.Node.tpr_fn" class="py-name" href="#" onclick="return doclink('link-61', 'tpr_fn', 'link-61');">tpr_fn</a></tt><tt class="py-op">]</tt> </tt>
<a name="L138"></a><tt class="py-lineno">138</tt>  <tt class="py-line">                <tt class="py-name">cmd1</tt> <tt class="py-op">+=</tt> <tt class="py-op">[</tt><tt class="py-string">"-c"</tt><tt class="py-op">,</tt> <tt class="py-string">"../../"</tt><tt class="py-op">+</tt><tt id="link-62" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-62', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-63" class="py-name" targets="Variable ZIBMolPy.node.Node.pdb_fn=ZIBMolPy.node.Node-class.html#pdb_fn"><a title="ZIBMolPy.node.Node.pdb_fn" class="py-name" href="#" onclick="return doclink('link-63', 'pdb_fn', 'link-63');">pdb_fn</a></tt><tt class="py-op">]</tt> </tt>
<a name="L139"></a><tt class="py-lineno">139</tt>  <tt class="py-line">                <tt class="py-name">cmd1</tt> <tt class="py-op">+=</tt> <tt class="py-op">[</tt><tt class="py-string">"-o"</tt><tt class="py-op">,</tt> <tt class="py-string">"../../"</tt><tt class="py-op">+</tt><tt id="link-64" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-64', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-65" class="py-name" targets="Variable ZIBMolPy.node.Node.dir=ZIBMolPy.node.Node-class.html#dir"><a title="ZIBMolPy.node.Node.dir" class="py-name" href="#" onclick="return doclink('link-65', 'dir', 'link-65');">dir</a></tt><tt class="py-op">+</tt><tt class="py-string">"/em.trr"</tt><tt class="py-op">]</tt> </tt>
<a name="L140"></a><tt class="py-lineno">140</tt>  <tt class="py-line">                <tt class="py-name">cmd1</tt> <tt class="py-op">+=</tt> <tt class="py-op">[</tt><tt class="py-string">"-e"</tt><tt class="py-op">,</tt> <tt class="py-string">"../../"</tt><tt class="py-op">+</tt><tt id="link-66" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-66', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-67" class="py-name"><a title="ZIBMolPy.node.Node.dir" class="py-name" href="#" onclick="return doclink('link-67', 'dir', 'link-65');">dir</a></tt><tt class="py-op">+</tt><tt class="py-string">"/em.edr"</tt><tt class="py-op">]</tt> </tt>
<a name="L141"></a><tt class="py-lineno">141</tt>  <tt class="py-line">                <tt class="py-name">cmd1</tt> <tt class="py-op">+=</tt> <tt class="py-op">[</tt><tt class="py-string">"-g"</tt><tt class="py-op">,</tt> <tt class="py-string">"../../"</tt><tt class="py-op">+</tt><tt id="link-68" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-68', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-69" class="py-name"><a title="ZIBMolPy.node.Node.dir" class="py-name" href="#" onclick="return doclink('link-69', 'dir', 'link-65');">dir</a></tt><tt class="py-op">+</tt><tt class="py-string">"/em.log"</tt><tt class="py-op">]</tt> </tt>
<a name="L142"></a><tt class="py-lineno">142</tt>  <tt class="py-line">        <tt class="py-keyword">elif</tt><tt class="py-op">(</tt><tt id="link-70" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-70', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt class="py-name">state</tt> <tt class="py-keyword">in</tt> <tt class="py-op">(</tt><tt class="py-string">'rerun-able-converged'</tt><tt class="py-op">,</tt><tt class="py-string">'rerun-able-not-converged'</tt><tt class="py-op">)</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L143"></a><tt class="py-lineno">143</tt>  <tt class="py-line">                <tt class="py-name">cmd1</tt> <tt class="py-op">+=</tt> <tt class="py-op">[</tt><tt class="py-string">"-s"</tt><tt class="py-op">,</tt> <tt class="py-string">"../../"</tt><tt class="py-op">+</tt><tt id="link-71" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-71', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-72" class="py-name"><a title="ZIBMolPy.node.Node.dir" class="py-name" href="#" onclick="return doclink('link-72', 'dir', 'link-65');">dir</a></tt><tt class="py-op">+</tt><tt class="py-string">"/rerun_me.tpr"</tt><tt class="py-op">]</tt> </tt>
<a name="L144"></a><tt class="py-lineno">144</tt>  <tt class="py-line">                <tt class="py-name">cmd1</tt> <tt class="py-op">+=</tt> <tt class="py-op">[</tt><tt class="py-string">"-rerun"</tt><tt class="py-op">,</tt> <tt class="py-string">"../../"</tt><tt class="py-op">+</tt><tt id="link-73" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-73', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-74" class="py-name"><a title="ZIBMolPy.node.Node.dir" class="py-name" href="#" onclick="return doclink('link-74', 'dir', 'link-65');">dir</a></tt><tt class="py-op">+</tt><tt class="py-string">"/rerun_me.trr"</tt><tt class="py-op">]</tt> </tt>
<a name="L145"></a><tt class="py-lineno">145</tt>  <tt class="py-line">                <tt class="py-name">cmd1</tt> <tt class="py-op">+=</tt> <tt class="py-op">[</tt><tt class="py-string">"-o"</tt><tt class="py-op">,</tt> <tt class="py-string">"../../"</tt><tt class="py-op">+</tt><tt id="link-75" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-75', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-76" class="py-name"><a title="ZIBMolPy.node.Node.dir" class="py-name" href="#" onclick="return doclink('link-76', 'dir', 'link-65');">dir</a></tt><tt class="py-op">+</tt><tt class="py-string">"/rerun.trr"</tt><tt class="py-op">]</tt> </tt>
<a name="L146"></a><tt class="py-lineno">146</tt>  <tt class="py-line">                <tt class="py-name">cmd1</tt> <tt class="py-op">+=</tt> <tt class="py-op">[</tt><tt class="py-string">"-e"</tt><tt class="py-op">,</tt> <tt class="py-string">"../../"</tt><tt class="py-op">+</tt><tt id="link-77" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-77', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-78" class="py-name"><a title="ZIBMolPy.node.Node.dir" class="py-name" href="#" onclick="return doclink('link-78', 'dir', 'link-65');">dir</a></tt><tt class="py-op">+</tt><tt class="py-string">"/rerun.edr"</tt><tt class="py-op">]</tt> </tt>
<a name="L147"></a><tt class="py-lineno">147</tt>  <tt class="py-line">                <tt class="py-name">cmd1</tt> <tt class="py-op">+=</tt> <tt class="py-op">[</tt><tt class="py-string">"-g"</tt><tt class="py-op">,</tt> <tt class="py-string">"../../"</tt><tt class="py-op">+</tt><tt id="link-79" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-79', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-80" class="py-name"><a title="ZIBMolPy.node.Node.dir" class="py-name" href="#" onclick="return doclink('link-80', 'dir', 'link-65');">dir</a></tt><tt class="py-op">+</tt><tt class="py-string">"/rerun.log"</tt><tt class="py-op">]</tt> </tt>
<a name="L148"></a><tt class="py-lineno">148</tt>  <tt class="py-line">        <tt class="py-keyword">else</tt><tt class="py-op">:</tt> </tt>
<a name="L149"></a><tt class="py-lineno">149</tt>  <tt class="py-line">                <tt class="py-name">cmd1</tt> <tt class="py-op">+=</tt> <tt class="py-op">[</tt><tt class="py-string">"-s"</tt><tt class="py-op">,</tt> <tt class="py-string">"../../"</tt><tt class="py-op">+</tt><tt id="link-81" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-81', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-82" class="py-name"><a title="ZIBMolPy.node.Node.tpr_fn" class="py-name" href="#" onclick="return doclink('link-82', 'tpr_fn', 'link-61');">tpr_fn</a></tt><tt class="py-op">]</tt> </tt>
<a name="L150"></a><tt class="py-lineno">150</tt>  <tt class="py-line">                <tt class="py-name">cmd1</tt> <tt class="py-op">+=</tt> <tt class="py-op">[</tt><tt class="py-string">"-o"</tt><tt class="py-op">,</tt> <tt class="py-string">"../../"</tt><tt class="py-op">+</tt><tt id="link-83" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-83', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-84" class="py-name" targets="Variable ZIBMolPy.node.Node.trr_fn=ZIBMolPy.node.Node-class.html#trr_fn"><a title="ZIBMolPy.node.Node.trr_fn" class="py-name" href="#" onclick="return doclink('link-84', 'trr_fn', 'link-84');">trr_fn</a></tt><tt class="py-op">]</tt> </tt>
<a name="L151"></a><tt class="py-lineno">151</tt>  <tt class="py-line">                <tt class="py-name">cmd1</tt> <tt class="py-op">+=</tt> <tt class="py-op">[</tt><tt class="py-string">"-c"</tt><tt class="py-op">,</tt> <tt class="py-string">"../../"</tt><tt class="py-op">+</tt><tt id="link-85" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-85', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-86" class="py-name"><a title="ZIBMolPy.node.Node.dir" class="py-name" href="#" onclick="return doclink('link-86', 'dir', 'link-65');">dir</a></tt><tt class="py-op">+</tt><tt class="py-string">"/outfile.pdb"</tt><tt class="py-op">]</tt> </tt>
<a name="L152"></a><tt class="py-lineno">152</tt>  <tt class="py-line"> </tt>
<a name="L153"></a><tt class="py-lineno">153</tt>  <tt class="py-line">        <tt class="py-name">cmd1</tt> <tt class="py-op">+=</tt> <tt class="py-op">[</tt><tt class="py-string">"-append"</tt><tt class="py-op">,</tt> <tt class="py-string">"-cpi"</tt><tt class="py-op">,</tt> <tt class="py-string">"state.cpt"</tt><tt class="py-op">]</tt> <tt class="py-comment"># continue previouly state, if exists</tt> </tt>
<a name="L154"></a><tt class="py-lineno">154</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt><tt class="py-op">(</tt><tt class="py-name">options</tt><tt class="py-op">.</tt><tt class="py-name">npme</tt> <tt class="py-op">!=</tt> <tt class="py-op">-</tt><tt class="py-number">1</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L155"></a><tt class="py-lineno">155</tt>  <tt class="py-line">                <tt class="py-name">cmd1</tt> <tt class="py-op">+=</tt> <tt class="py-op">[</tt><tt class="py-string">"-npme"</tt><tt class="py-op">,</tt> <tt class="py-name">str</tt><tt class="py-op">(</tt><tt class="py-name">options</tt><tt class="py-op">.</tt><tt class="py-name">npme</tt><tt class="py-op">)</tt><tt class="py-op">]</tt> </tt>
<a name="L156"></a><tt class="py-lineno">156</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt><tt class="py-op">(</tt><tt class="py-name">options</tt><tt class="py-op">.</tt><tt class="py-name">nt</tt> <tt class="py-op">!=</tt> <tt class="py-number">0</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L157"></a><tt class="py-lineno">157</tt>  <tt class="py-line">                <tt class="py-name">cmd1</tt> <tt class="py-op">+=</tt> <tt class="py-op">[</tt><tt class="py-string">"-nt"</tt><tt class="py-op">,</tt> <tt class="py-name">str</tt><tt class="py-op">(</tt><tt class="py-name">options</tt><tt class="py-op">.</tt><tt class="py-name">nt</tt><tt class="py-op">)</tt><tt class="py-op">]</tt> </tt>
<a name="L158"></a><tt class="py-lineno">158</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt><tt class="py-op">(</tt><tt class="py-name">options</tt><tt class="py-op">.</tt><tt class="py-name">reprod</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L159"></a><tt class="py-lineno">159</tt>  <tt class="py-line">                <tt class="py-name">cmd1</tt> <tt class="py-op">+=</tt> <tt class="py-op">[</tt><tt class="py-string">"-reprod"</tt><tt class="py-op">]</tt> </tt>
<a name="L160"></a><tt class="py-lineno">160</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt><tt class="py-op">(</tt><tt class="py-name">options</tt><tt class="py-op">.</tt><tt class="py-name">pd</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L161"></a><tt class="py-lineno">161</tt>  <tt class="py-line">                <tt class="py-name">cmd1</tt> <tt class="py-op">+=</tt> <tt class="py-op">[</tt><tt class="py-string">"-pd"</tt><tt class="py-op">]</tt> </tt>
<a name="L162"></a><tt class="py-lineno">162</tt>  <tt class="py-line">         </tt>
<a name="L163"></a><tt class="py-lineno">163</tt>  <tt class="py-line">        <tt class="py-comment"># use mpiexec and mdrun_mpi if available</tt> </tt>
<a name="L164"></a><tt class="py-lineno">164</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt><tt class="py-op">(</tt><tt class="py-keyword">not</tt> <tt class="py-name">options</tt><tt class="py-op">.</tt><tt class="py-name">seq</tt> <tt class="py-keyword">and</tt> <tt class="py-name">call</tt><tt class="py-op">(</tt><tt class="py-op">[</tt><tt class="py-string">"which"</tt><tt class="py-op">,</tt><tt class="py-string">"mpiexec"</tt><tt class="py-op">]</tt><tt class="py-op">)</tt><tt class="py-op">==</tt><tt class="py-number">0</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L165"></a><tt class="py-lineno">165</tt>  <tt class="py-line">                <tt class="py-keyword">if</tt><tt class="py-op">(</tt><tt class="py-name">call</tt><tt class="py-op">(</tt><tt class="py-op">[</tt><tt class="py-string">"which"</tt><tt class="py-op">,</tt><tt class="py-string">"mdrun_mpi"</tt><tt class="py-op">]</tt><tt class="py-op">)</tt><tt class="py-op">==</tt><tt class="py-number">0</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L166"></a><tt class="py-lineno">166</tt>  <tt class="py-line">                        <tt class="py-name">cmd1</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-string">"mdrun_mpi"</tt> </tt>
<a name="L167"></a><tt class="py-lineno">167</tt>  <tt class="py-line">                <tt class="py-name">cmd1</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-string">"mpiexec"</tt><tt class="py-op">,</tt> <tt class="py-string">"-np"</tt><tt class="py-op">,</tt> <tt class="py-name">str</tt><tt class="py-op">(</tt><tt class="py-name">options</tt><tt class="py-op">.</tt><tt class="py-name">np</tt><tt class="py-op">)</tt><tt class="py-op">]</tt> <tt class="py-op">+</tt> <tt class="py-name">cmd1</tt> </tt>
<a name="L168"></a><tt class="py-lineno">168</tt>  <tt class="py-line">                 </tt>
<a name="L169"></a><tt class="py-lineno">169</tt>  <tt class="py-line">        <tt class="py-comment">#http://stackoverflow.com/questions/4554767/terminating-subprocess-in-python</tt> </tt>
<a name="L170"></a><tt class="py-lineno">170</tt>  <tt class="py-line">        <tt class="py-comment">#alternative</tt> </tt>
<a name="L171"></a><tt class="py-lineno">171</tt>  <tt class="py-line">        <tt class="py-comment">#p = Popen(...)</tt> </tt>
<a name="L172"></a><tt class="py-lineno">172</tt>  <tt class="py-line">        <tt class="py-comment">#pp = psutil.Process(p.pid)</tt> </tt>
<a name="L173"></a><tt class="py-lineno">173</tt>  <tt class="py-line">        <tt class="py-comment">#for child in pp.get_children():</tt> </tt>
<a name="L174"></a><tt class="py-lineno">174</tt>  <tt class="py-line">        <tt class="py-comment">#       child.send_signal(signal.SIGINT)</tt> </tt>
<a name="L175"></a><tt class="py-lineno">175</tt>  <tt class="py-line">         </tt>
<a name="L176"></a><tt class="py-lineno">176</tt>  <tt class="py-line">        <tt class="py-comment">#ensure, that childprocess dies when parent dies. Alternative: write own signal-handler e.g for atexit-module</tt> </tt>
<a name="L177"></a><tt class="py-lineno">177</tt>  <tt class="py-line">        <tt class="py-comment">#http://stackoverflow.com/questions/1884941/killing-the-child-processes-with-the-parent-process</tt> </tt>
<a name="L178"></a><tt class="py-lineno">178</tt>  <tt class="py-line">        <tt class="py-name">implant_bomb</tt> <tt class="py-op">=</tt> <tt class="py-name">None</tt> </tt>
<a name="L179"></a><tt class="py-lineno">179</tt>  <tt class="py-line">        <tt class="py-keyword">try</tt><tt class="py-op">:</tt> </tt>
<a name="L180"></a><tt class="py-lineno">180</tt>  <tt class="py-line">                <tt class="py-keyword">import</tt> <tt class="py-name">ctypes</tt> </tt>
<a name="L181"></a><tt class="py-lineno">181</tt>  <tt class="py-line">                <tt class="py-name">libc</tt> <tt class="py-op">=</tt> <tt class="py-name">ctypes</tt><tt class="py-op">.</tt><tt class="py-name">CDLL</tt><tt class="py-op">(</tt><tt class="py-string">'libc.so.6'</tt><tt class="py-op">)</tt> </tt>
<a name="L182"></a><tt class="py-lineno">182</tt>  <tt class="py-line">                <tt class="py-name">PR_SET_PDEATHSIG</tt> <tt class="py-op">=</tt> <tt class="py-number">1</tt><tt class="py-op">;</tt> <tt class="py-name">TERM</tt> <tt class="py-op">=</tt> <tt class="py-number">15</tt> </tt>
<a name="L183"></a><tt class="py-lineno">183</tt>  <tt class="py-line">                <tt class="py-name">implant_bomb</tt> <tt class="py-op">=</tt> <tt class="py-keyword">lambda</tt><tt class="py-op">:</tt> <tt class="py-name">libc</tt><tt class="py-op">.</tt><tt class="py-name">prctl</tt><tt class="py-op">(</tt><tt class="py-name">PR_SET_PDEATHSIG</tt><tt class="py-op">,</tt> <tt class="py-name">TERM</tt><tt class="py-op">)</tt> </tt>
<a name="L184"></a><tt class="py-lineno">184</tt>  <tt class="py-line">        <tt class="py-keyword">except</tt><tt class="py-op">:</tt> </tt>
<a name="L185"></a><tt class="py-lineno">185</tt>  <tt class="py-line">                <tt class="py-name">warn</tt><tt class="py-op">(</tt><tt class="py-string">"Child process might live on when parent gets terminated (feature requires python 2.6)."</tt><tt class="py-op">)</tt> </tt>
<a name="L186"></a><tt class="py-lineno">186</tt>  <tt class="py-line">         </tt>
<a name="L187"></a><tt class="py-lineno">187</tt>  <tt class="py-line">        <tt class="py-keyword">print</tt><tt class="py-op">(</tt><tt class="py-string">"Calling: %s"</tt><tt class="py-op">%</tt><tt class="py-string">" "</tt><tt class="py-op">.</tt><tt class="py-name">join</tt><tt class="py-op">(</tt><tt class="py-name">cmd1</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> </tt>
<a name="L188"></a><tt class="py-lineno">188</tt>  <tt class="py-line">        <tt id="link-87" class="py-name"><a title="ZIBMolPy.utils.check_call" class="py-name" href="#" onclick="return doclink('link-87', 'check_call', 'link-2');">check_call</a></tt><tt class="py-op">(</tt><tt class="py-name">cmd1</tt><tt class="py-op">,</tt> <tt class="py-name">cwd</tt><tt class="py-op">=</tt><tt id="link-88" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-88', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-89" class="py-name"><a title="ZIBMolPy.node.Node.dir" class="py-name" href="#" onclick="return doclink('link-89', 'dir', 'link-65');">dir</a></tt><tt class="py-op">,</tt> <tt class="py-name">preexec_fn</tt><tt class="py-op">=</tt><tt class="py-name">implant_bomb</tt><tt class="py-op">)</tt> </tt>
<a name="L189"></a><tt class="py-lineno">189</tt>  <tt class="py-line"> </tt>
<a name="L190"></a><tt class="py-lineno">190</tt>  <tt class="py-line">        <tt class="py-comment"># if we were just minimizing, we go back to grompp-able now</tt> </tt>
<a name="L191"></a><tt class="py-lineno">191</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt><tt class="py-op">(</tt><tt id="link-90" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-90', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt class="py-name">state</tt> <tt class="py-op">==</tt> <tt class="py-string">"em-mdrun-able"</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L192"></a><tt class="py-lineno">192</tt>  <tt class="py-line">                <tt id="link-91" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-91', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt class="py-name">state</tt> <tt class="py-op">=</tt> <tt class="py-string">"grompp-able"</tt> </tt>
<a name="L193"></a><tt class="py-lineno">193</tt>  <tt class="py-line">                <tt class="py-keyword">return</tt> </tt>
<a name="L194"></a><tt class="py-lineno">194</tt>  <tt class="py-line"> </tt>
<a name="L195"></a><tt class="py-lineno">195</tt>  <tt class="py-line">        <tt class="py-comment"># if we were just rerunnning, we go back to original state now</tt> </tt>
<a name="L196"></a><tt class="py-lineno">196</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt><tt class="py-op">(</tt><tt id="link-92" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-92', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt class="py-name">state</tt> <tt class="py-keyword">in</tt> <tt class="py-op">(</tt><tt class="py-string">'rerun-able-converged'</tt><tt class="py-op">,</tt><tt class="py-string">'rerun-able-not-converged'</tt><tt class="py-op">)</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L197"></a><tt class="py-lineno">197</tt>  <tt class="py-line">                <tt id="link-93" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-93', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt class="py-name">state</tt> <tt class="py-op">=</tt> <tt id="link-94" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-94', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt class="py-name">state</tt><tt class="py-op">.</tt><tt class="py-name">rsplit</tt><tt class="py-op">(</tt><tt class="py-string">"rerun-able-"</tt><tt class="py-op">,</tt> <tt class="py-number">1</tt><tt class="py-op">)</tt><tt class="py-op">[</tt><tt class="py-number">1</tt><tt class="py-op">]</tt> </tt>
<a name="L198"></a><tt class="py-lineno">198</tt>  <tt class="py-line">                <tt class="py-keyword">return</tt> </tt>
<a name="L199"></a><tt class="py-lineno">199</tt>  <tt class="py-line"> </tt>
<a name="L200"></a><tt class="py-lineno">200</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt><tt class="py-op">(</tt><tt id="link-95" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-95', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-96" class="py-name" targets="Variable ZIBMolPy.node.Node.has_restraints=ZIBMolPy.node.Node-class.html#has_restraints"><a title="ZIBMolPy.node.Node.has_restraints" class="py-name" href="#" onclick="return doclink('link-96', 'has_restraints', 'link-96');">has_restraints</a></tt> <tt class="py-keyword">and</tt> <tt class="py-keyword">not</tt> <tt class="py-name">options</tt><tt class="py-op">.</tt><tt class="py-name">multistart</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L201"></a><tt class="py-lineno">201</tt>  <tt class="py-line">                <tt class="py-comment"># check for convergence</tt> </tt>
<a name="L202"></a><tt class="py-lineno">202</tt>  <tt class="py-line">                <tt class="py-name">converged</tt> <tt class="py-op">=</tt> <tt id="link-97" class="py-name"><a title="zgf_mdrun.conv_check_gelman_rubin" class="py-name" href="#" onclick="return doclink('link-97', 'conv_check_gelman_rubin', 'link-42');">conv_check_gelman_rubin</a></tt><tt class="py-op">(</tt><tt id="link-98" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-98', 'node', 'link-59');">node</a></tt><tt class="py-op">)</tt> </tt>
<a name="L203"></a><tt class="py-lineno">203</tt>  <tt class="py-line">        <tt class="py-keyword">else</tt><tt class="py-op">:</tt> </tt>
<a name="L204"></a><tt class="py-lineno">204</tt>  <tt class="py-line">                <tt class="py-comment"># stow away sampling data</tt> </tt>
<a name="L205"></a><tt class="py-lineno">205</tt>  <tt class="py-line">                <tt class="py-name">converged</tt> <tt class="py-op">=</tt> <tt class="py-name">False</tt> </tt>
<a name="L206"></a><tt class="py-lineno">206</tt>  <tt class="py-line">                <tt class="py-name">os</tt><tt class="py-op">.</tt><tt class="py-name">remove</tt><tt class="py-op">(</tt><tt id="link-99" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-99', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-100" class="py-name"><a title="ZIBMolPy.node.Node.dir" class="py-name" href="#" onclick="return doclink('link-100', 'dir', 'link-65');">dir</a></tt><tt class="py-op">+</tt><tt class="py-string">"/state.cpt"</tt><tt class="py-op">)</tt> </tt>
<a name="L207"></a><tt class="py-lineno">207</tt>  <tt class="py-line">                <tt class="py-keyword">for</tt> <tt class="py-name">fn</tt> <tt class="py-keyword">in</tt> <tt class="py-op">[</tt><tt id="link-101" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-101', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-102" class="py-name"><a title="ZIBMolPy.node.Node.dir" class="py-name" href="#" onclick="return doclink('link-102', 'dir', 'link-65');">dir</a></tt><tt class="py-op">+</tt><tt class="py-string">"/outfile.pdb"</tt><tt class="py-op">,</tt><tt id="link-103" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-103', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-104" class="py-name"><a title="ZIBMolPy.node.Node.trr_fn" class="py-name" href="#" onclick="return doclink('link-104', 'trr_fn', 'link-84');">trr_fn</a></tt><tt class="py-op">,</tt> <tt id="link-105" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-105', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-106" class="py-name"><a title="ZIBMolPy.node.Node.dir" class="py-name" href="#" onclick="return doclink('link-106', 'dir', 'link-65');">dir</a></tt><tt class="py-op">+</tt><tt class="py-string">"/ener.edr"</tt><tt class="py-op">,</tt> <tt id="link-107" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-107', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-108" class="py-name"><a title="ZIBMolPy.node.Node.dir" class="py-name" href="#" onclick="return doclink('link-108', 'dir', 'link-65');">dir</a></tt><tt class="py-op">+</tt><tt class="py-string">"/md.log"</tt><tt class="py-op">]</tt><tt class="py-op">:</tt> </tt>
<a name="L208"></a><tt class="py-lineno">208</tt>  <tt class="py-line">                        <tt id="link-109" class="py-name" targets="Function zgf_mdrun.archive_file()=zgf_mdrun-module.html#archive_file"><a title="zgf_mdrun.archive_file" class="py-name" href="#" onclick="return doclink('link-109', 'archive_file', 'link-109');">archive_file</a></tt><tt class="py-op">(</tt><tt class="py-name">fn</tt><tt class="py-op">,</tt> <tt id="link-110" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-110', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt class="py-name">extensions_counter</tt><tt class="py-op">)</tt> </tt>
<a name="L209"></a><tt class="py-lineno">209</tt>  <tt class="py-line"> </tt>
<a name="L210"></a><tt class="py-lineno">210</tt>  <tt class="py-line">        <tt class="py-comment"># check if user wants to delete files except pdb</tt> </tt>
<a name="L211"></a><tt class="py-lineno">211</tt>  <tt class="py-line">        <tt class="py-keyword">try</tt><tt class="py-op">:</tt> </tt>
<a name="L212"></a><tt class="py-lineno">212</tt>  <tt class="py-line">                <tt class="py-keyword">if</tt> <tt class="py-op">(</tt><tt id="link-111" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-111', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt class="py-name">save_mode</tt> <tt class="py-op">==</tt> <tt class="py-string">"pdb"</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L213"></a><tt class="py-lineno">213</tt>  <tt class="py-line">                        <tt class="py-comment"># delete all files except pdb and start files</tt> </tt>
<a name="L214"></a><tt class="py-lineno">214</tt>  <tt class="py-line">                        <tt class="py-keyword">for</tt> <tt class="py-name">fn</tt> <tt class="py-keyword">in</tt> <tt class="py-name">os</tt><tt class="py-op">.</tt><tt class="py-name">listdir</tt><tt class="py-op">(</tt><tt id="link-112" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-112', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-113" class="py-name"><a title="ZIBMolPy.node.Node.dir" class="py-name" href="#" onclick="return doclink('link-113', 'dir', 'link-65');">dir</a></tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L215"></a><tt class="py-lineno">215</tt>  <tt class="py-line">                                <tt class="py-keyword">if</tt><tt class="py-op">(</tt><tt class="py-name">re</tt><tt class="py-op">.</tt><tt id="link-114" class="py-name" targets="Function zgf_test.match()=zgf_test-module.html#match"><a title="zgf_test.match" class="py-name" href="#" onclick="return doclink('link-114', 'match', 'link-114');">match</a></tt><tt class="py-op">(</tt><tt class="py-string">".+.pdb"</tt><tt class="py-op">,</tt><tt class="py-name">fn</tt><tt class="py-op">)</tt><tt class="py-op">==</tt><tt class="py-name">None</tt> </tt>
<a name="L216"></a><tt class="py-lineno">216</tt>  <tt class="py-line">                                <tt class="py-keyword">and</tt> <tt class="py-name">re</tt><tt class="py-op">.</tt><tt id="link-115" class="py-name"><a title="zgf_test.match" class="py-name" href="#" onclick="return doclink('link-115', 'match', 'link-114');">match</a></tt><tt class="py-op">(</tt><tt class="py-string">"[^#].+.mdp"</tt><tt class="py-op">,</tt><tt class="py-name">fn</tt><tt class="py-op">)</tt><tt class="py-op">==</tt><tt class="py-name">None</tt> </tt>
<a name="L217"></a><tt class="py-lineno">217</tt>  <tt class="py-line">                                <tt class="py-keyword">and</tt> <tt class="py-name">re</tt><tt class="py-op">.</tt><tt id="link-116" class="py-name"><a title="zgf_test.match" class="py-name" href="#" onclick="return doclink('link-116', 'match', 'link-114');">match</a></tt><tt class="py-op">(</tt><tt class="py-string">".+.txt"</tt><tt class="py-op">,</tt><tt class="py-name">fn</tt><tt class="py-op">)</tt><tt class="py-op">==</tt><tt class="py-name">None</tt> </tt>
<a name="L218"></a><tt class="py-lineno">218</tt>  <tt class="py-line">                                <tt class="py-keyword">and</tt> <tt class="py-name">re</tt><tt class="py-op">.</tt><tt id="link-117" class="py-name"><a title="zgf_test.match" class="py-name" href="#" onclick="return doclink('link-117', 'match', 'link-114');">match</a></tt><tt class="py-op">(</tt><tt class="py-string">"[^#].+.tpr"</tt><tt class="py-op">,</tt><tt class="py-name">fn</tt><tt class="py-op">)</tt><tt class="py-op">==</tt><tt class="py-name">None</tt> </tt>
<a name="L219"></a><tt class="py-lineno">219</tt>  <tt class="py-line">                                <tt class="py-keyword">and</tt> <tt class="py-name">re</tt><tt class="py-op">.</tt><tt id="link-118" class="py-name"><a title="zgf_test.match" class="py-name" href="#" onclick="return doclink('link-118', 'match', 'link-114');">match</a></tt><tt class="py-op">(</tt><tt class="py-string">".+.top"</tt><tt class="py-op">,</tt><tt class="py-name">fn</tt><tt class="py-op">)</tt><tt class="py-op">==</tt><tt class="py-name">None</tt> </tt>
<a name="L220"></a><tt class="py-lineno">220</tt>  <tt class="py-line">                                <tt class="py-keyword">and</tt> <tt class="py-name">fn</tt><tt class="py-op">!=</tt><tt class="py-string">"lock"</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L221"></a><tt class="py-lineno">221</tt>  <tt class="py-line">                                        <tt class="py-name">os</tt><tt class="py-op">.</tt><tt class="py-name">remove</tt><tt class="py-op">(</tt><tt id="link-119" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-119', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-120" class="py-name"><a title="ZIBMolPy.node.Node.dir" class="py-name" href="#" onclick="return doclink('link-120', 'dir', 'link-65');">dir</a></tt><tt class="py-op">+</tt><tt class="py-string">"/"</tt><tt class="py-op">+</tt><tt class="py-name">str</tt><tt class="py-op">(</tt><tt class="py-name">fn</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> </tt>
<a name="L222"></a><tt class="py-lineno">222</tt>  <tt class="py-line">        <tt class="py-keyword">except</tt> <tt class="py-name">AttributeError</tt><tt class="py-op">:</tt> </tt>
<a name="L223"></a><tt class="py-lineno">223</tt>  <tt class="py-line">                <tt class="py-keyword">pass</tt> </tt>
<a name="L224"></a><tt class="py-lineno">224</tt>  <tt class="py-line">         </tt>
<a name="L225"></a><tt class="py-lineno">225</tt>  <tt class="py-line">        <tt class="py-comment"># decide what to do next</tt> </tt>
<a name="L226"></a><tt class="py-lineno">226</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt><tt class="py-op">(</tt><tt class="py-name">converged</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L227"></a><tt class="py-lineno">227</tt>  <tt class="py-line">                <tt id="link-121" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-121', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt class="py-name">state</tt> <tt class="py-op">=</tt> <tt class="py-string">"converged"</tt> </tt>
<a name="L228"></a><tt class="py-lineno">228</tt>  <tt class="py-line">        <tt class="py-keyword">elif</tt><tt class="py-op">(</tt><tt id="link-122" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-122', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt class="py-name">extensions_counter</tt> <tt class="py-op">&gt;=</tt> <tt id="link-123" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-123', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt class="py-name">extensions_max</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L229"></a><tt class="py-lineno">229</tt>  <tt class="py-line">                <tt class="py-keyword">if</tt><tt class="py-op">(</tt><tt id="link-124" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-124', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-125" class="py-name"><a title="ZIBMolPy.node.Node.has_restraints" class="py-name" href="#" onclick="return doclink('link-125', 'has_restraints', 'link-96');">has_restraints</a></tt> <tt class="py-keyword">and</tt> <tt class="py-keyword">not</tt> <tt class="py-name">options</tt><tt class="py-op">.</tt><tt class="py-name">multistart</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L230"></a><tt class="py-lineno">230</tt>  <tt class="py-line">                        <tt id="link-126" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-126', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt class="py-name">state</tt> <tt class="py-op">=</tt> <tt class="py-string">"not-converged"</tt> </tt>
<a name="L231"></a><tt class="py-lineno">231</tt>  <tt class="py-line">                <tt class="py-keyword">else</tt><tt class="py-op">:</tt> </tt>
<a name="L232"></a><tt class="py-lineno">232</tt>  <tt class="py-line">                        <tt class="py-comment"># if user wants to keep everthing we at merge trajectorie and edr files</tt> </tt>
<a name="L233"></a><tt class="py-lineno">233</tt>  <tt class="py-line">                        <tt class="py-comment"># and delete backups</tt> </tt>
<a name="L234"></a><tt class="py-lineno">234</tt>  <tt class="py-line">                        <tt class="py-keyword">try</tt><tt class="py-op">:</tt>                     </tt>
<a name="L235"></a><tt class="py-lineno">235</tt>  <tt class="py-line">                                <tt class="py-keyword">if</tt> <tt class="py-op">(</tt><tt id="link-127" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-127', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt class="py-name">save_mode</tt> <tt class="py-op">==</tt> <tt class="py-string">"complete"</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L236"></a><tt class="py-lineno">236</tt>  <tt class="py-line">                                        <tt class="py-comment"># merge sampling trajectories</tt> </tt>
<a name="L237"></a><tt class="py-lineno">237</tt>  <tt class="py-line">                                        <tt class="py-name">trr_fns</tt> <tt class="py-op">=</tt> <tt class="py-name">sorted</tt><tt class="py-op">(</tt><tt class="py-op">[</tt> <tt class="py-name">fn</tt> <tt class="py-keyword">for</tt> <tt class="py-name">fn</tt> <tt class="py-keyword">in</tt> <tt class="py-name">os</tt><tt class="py-op">.</tt><tt class="py-name">listdir</tt><tt class="py-op">(</tt><tt id="link-128" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-128', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-129" class="py-name"><a title="ZIBMolPy.node.Node.dir" class="py-name" href="#" onclick="return doclink('link-129', 'dir', 'link-65');">dir</a></tt><tt class="py-op">)</tt> <tt class="py-keyword">if</tt> <tt class="py-name">re</tt><tt class="py-op">.</tt><tt id="link-130" class="py-name"><a title="zgf_test.match" class="py-name" href="#" onclick="return doclink('link-130', 'match', 'link-114');">match</a></tt><tt class="py-op">(</tt><tt class="py-string">"[^#].+run\d+.trr"</tt><tt class="py-op">,</tt> <tt class="py-name">fn</tt><tt class="py-op">)</tt> <tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L238"></a><tt class="py-lineno">238</tt>  <tt class="py-line">                                        <tt class="py-name">cmd2</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-string">"trjcat"</tt><tt class="py-op">,</tt> <tt class="py-string">"-f"</tt><tt class="py-op">]</tt> </tt>
<a name="L239"></a><tt class="py-lineno">239</tt>  <tt class="py-line">                                        <tt class="py-name">cmd2</tt> <tt class="py-op">+=</tt> <tt class="py-name">trr_fns</tt> </tt>
<a name="L240"></a><tt class="py-lineno">240</tt>  <tt class="py-line">                                        <tt class="py-name">cmd2</tt> <tt class="py-op">+=</tt> <tt class="py-op">[</tt><tt class="py-string">"-o"</tt><tt class="py-op">,</tt> <tt class="py-string">"../../"</tt><tt class="py-op">+</tt><tt id="link-131" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-131', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-132" class="py-name"><a title="ZIBMolPy.node.Node.trr_fn" class="py-name" href="#" onclick="return doclink('link-132', 'trr_fn', 'link-84');">trr_fn</a></tt><tt class="py-op">,</tt> <tt class="py-string">"-cat"</tt><tt class="py-op">]</tt> </tt>
<a name="L241"></a><tt class="py-lineno">241</tt>  <tt class="py-line">                                        <tt class="py-keyword">print</tt><tt class="py-op">(</tt><tt class="py-string">"Calling: %s"</tt><tt class="py-op">%</tt><tt class="py-string">" "</tt><tt class="py-op">.</tt><tt class="py-name">join</tt><tt class="py-op">(</tt><tt class="py-name">cmd2</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> </tt>
<a name="L242"></a><tt class="py-lineno">242</tt>  <tt class="py-line">                                        <tt id="link-133" class="py-name"><a title="ZIBMolPy.utils.check_call" class="py-name" href="#" onclick="return doclink('link-133', 'check_call', 'link-2');">check_call</a></tt><tt class="py-op">(</tt><tt class="py-name">cmd2</tt><tt class="py-op">,</tt> <tt class="py-name">cwd</tt><tt class="py-op">=</tt><tt id="link-134" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-134', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-135" class="py-name"><a title="ZIBMolPy.node.Node.dir" class="py-name" href="#" onclick="return doclink('link-135', 'dir', 'link-65');">dir</a></tt><tt class="py-op">)</tt> </tt>
<a name="L243"></a><tt class="py-lineno">243</tt>  <tt class="py-line">                                        <tt class="py-comment"># merge edr files</tt> </tt>
<a name="L244"></a><tt class="py-lineno">244</tt>  <tt class="py-line">                                        <tt id="link-136" class="py-name" targets="Function zgf_mdrun.get_merged_edr()=zgf_mdrun-module.html#get_merged_edr"><a title="zgf_mdrun.get_merged_edr" class="py-name" href="#" onclick="return doclink('link-136', 'get_merged_edr', 'link-136');">get_merged_edr</a></tt><tt class="py-op">(</tt><tt id="link-137" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-137', 'node', 'link-59');">node</a></tt><tt class="py-op">)</tt> </tt>
<a name="L245"></a><tt class="py-lineno">245</tt>  <tt class="py-line">                                        <tt class="py-comment"># delete backups, assuming each backup file starts with '#'</tt> </tt>
<a name="L246"></a><tt class="py-lineno">246</tt>  <tt class="py-line">                                        <tt class="py-keyword">for</tt> <tt class="py-name">fn</tt> <tt class="py-keyword">in</tt> <tt class="py-name">os</tt><tt class="py-op">.</tt><tt class="py-name">listdir</tt><tt class="py-op">(</tt><tt id="link-138" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-138', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-139" class="py-name"><a title="ZIBMolPy.node.Node.dir" class="py-name" href="#" onclick="return doclink('link-139', 'dir', 'link-65');">dir</a></tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L247"></a><tt class="py-lineno">247</tt>  <tt class="py-line">                                                <tt class="py-keyword">if</tt><tt class="py-op">(</tt><tt class="py-name">re</tt><tt class="py-op">.</tt><tt id="link-140" class="py-name"><a title="zgf_test.match" class="py-name" href="#" onclick="return doclink('link-140', 'match', 'link-114');">match</a></tt><tt class="py-op">(</tt><tt class="py-string">"#.+"</tt><tt class="py-op">,</tt><tt class="py-name">fn</tt><tt class="py-op">)</tt><tt class="py-op">)</tt><tt class="py-op">:</tt>                                  </tt>
<a name="L248"></a><tt class="py-lineno">248</tt>  <tt class="py-line">                                                        <tt class="py-name">os</tt><tt class="py-op">.</tt><tt class="py-name">remove</tt><tt class="py-op">(</tt><tt id="link-141" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-141', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-142" class="py-name"><a title="ZIBMolPy.node.Node.dir" class="py-name" href="#" onclick="return doclink('link-142', 'dir', 'link-65');">dir</a></tt><tt class="py-op">+</tt><tt class="py-string">"/"</tt><tt class="py-op">+</tt><tt class="py-name">str</tt><tt class="py-op">(</tt><tt class="py-name">fn</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> </tt>
<a name="L249"></a><tt class="py-lineno">249</tt>  <tt class="py-line">                        <tt class="py-keyword">except</tt> <tt class="py-name">AttributeError</tt><tt class="py-op">:</tt> </tt>
<a name="L250"></a><tt class="py-lineno">250</tt>  <tt class="py-line">                                <tt class="py-keyword">pass</tt> </tt>
<a name="L251"></a><tt class="py-lineno">251</tt>  <tt class="py-line">                         </tt>
<a name="L252"></a><tt class="py-lineno">252</tt>  <tt class="py-line">                        <tt class="py-comment"># in either case, save as ready node</tt> </tt>
<a name="L253"></a><tt class="py-lineno">253</tt>  <tt class="py-line">                        <tt id="link-143" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-143', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt class="py-name">state</tt> <tt class="py-op">=</tt> <tt class="py-string">"ready"</tt> </tt>
<a name="L254"></a><tt class="py-lineno">254</tt>  <tt class="py-line">                         </tt>
<a name="L255"></a><tt class="py-lineno">255</tt>  <tt class="py-line"> </tt>
<a name="L256"></a><tt class="py-lineno">256</tt>  <tt class="py-line">        <tt class="py-keyword">else</tt><tt class="py-op">:</tt> </tt>
<a name="L257"></a><tt class="py-lineno">257</tt>  <tt class="py-line">                <tt id="link-144" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-144', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt class="py-name">extensions_counter</tt> <tt class="py-op">+=</tt> <tt class="py-number">1</tt> </tt>
<a name="L258"></a><tt class="py-lineno">258</tt>  <tt class="py-line">                <tt id="link-145" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-145', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt class="py-name">state</tt> <tt class="py-op">=</tt> <tt class="py-string">"mdrun-able"</tt> <tt class="py-comment"># actually it should still be in this state</tt> </tt>
<a name="L259"></a><tt class="py-lineno">259</tt>  <tt class="py-line">         </tt>
<a name="L260"></a><tt class="py-lineno">260</tt>  <tt class="py-line">                <tt class="py-keyword">if</tt><tt class="py-op">(</tt><tt id="link-146" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-146', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-147" class="py-name"><a title="ZIBMolPy.node.Node.has_restraints" class="py-name" href="#" onclick="return doclink('link-147', 'has_restraints', 'link-96');">has_restraints</a></tt> <tt class="py-keyword">and</tt> <tt class="py-keyword">not</tt> <tt class="py-name">options</tt><tt class="py-op">.</tt><tt class="py-name">multistart</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L261"></a><tt class="py-lineno">261</tt>  <tt class="py-line">                        <tt class="py-name">cmd0</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-string">"tpbconv"</tt><tt class="py-op">,</tt> <tt class="py-string">"-s"</tt><tt class="py-op">,</tt> <tt id="link-148" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-148', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-149" class="py-name"><a title="ZIBMolPy.node.Node.tpr_fn" class="py-name" href="#" onclick="return doclink('link-149', 'tpr_fn', 'link-61');">tpr_fn</a></tt><tt class="py-op">,</tt> <tt class="py-string">"-o"</tt><tt class="py-op">,</tt> <tt id="link-150" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-150', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-151" class="py-name"><a title="ZIBMolPy.node.Node.tpr_fn" class="py-name" href="#" onclick="return doclink('link-151', 'tpr_fn', 'link-61');">tpr_fn</a></tt><tt class="py-op">,</tt> <tt class="py-string">"-extend"</tt><tt class="py-op">,</tt> <tt class="py-name">str</tt><tt class="py-op">(</tt><tt id="link-152" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-152', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt class="py-name">extensions_length</tt><tt class="py-op">)</tt><tt class="py-op">]</tt> </tt>
<a name="L262"></a><tt class="py-lineno">262</tt>  <tt class="py-line">                        <tt class="py-keyword">print</tt><tt class="py-op">(</tt><tt class="py-string">"Calling: %s"</tt><tt class="py-op">%</tt><tt class="py-string">" "</tt><tt class="py-op">.</tt><tt class="py-name">join</tt><tt class="py-op">(</tt><tt class="py-name">cmd0</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> </tt>
<a name="L263"></a><tt class="py-lineno">263</tt>  <tt class="py-line">                        <tt id="link-153" class="py-name"><a title="ZIBMolPy.utils.check_call" class="py-name" href="#" onclick="return doclink('link-153', 'check_call', 'link-2');">check_call</a></tt><tt class="py-op">(</tt><tt class="py-name">cmd0</tt><tt class="py-op">)</tt> <tt class="py-comment"># tell Gromacs to extend the tpr file for another round</tt> </tt>
<a name="L264"></a><tt class="py-lineno">264</tt>  <tt class="py-line">                <tt class="py-keyword">else</tt><tt class="py-op">:</tt> </tt>
<a name="L265"></a><tt class="py-lineno">265</tt>  <tt class="py-line">                        <tt id="link-154" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-154', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt class="py-name">state</tt> <tt class="py-op">=</tt> <tt class="py-string">"grompp-able"</tt> </tt>
<a name="L266"></a><tt class="py-lineno">266</tt>  <tt class="py-line">                        <tt id="link-155" class="py-name"><a title="zgf_grompp" class="py-name" href="#" onclick="return doclink('link-155', 'zgf_grompp', 'link-18');">zgf_grompp</a></tt><tt class="py-op">.</tt><tt id="link-156" class="py-name" targets="Function zgf_grompp.call_grompp()=zgf_grompp-module.html#call_grompp"><a title="zgf_grompp.call_grompp" class="py-name" href="#" onclick="return doclink('link-156', 'call_grompp', 'link-156');">call_grompp</a></tt><tt class="py-op">(</tt><tt id="link-157" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-157', 'node', 'link-59');">node</a></tt><tt class="py-op">)</tt> <tt class="py-comment"># re-grompp to obtain new random impulse</tt> </tt>
</div><a name="L267"></a><tt class="py-lineno">267</tt>  <tt class="py-line"> </tt>
<a name="L268"></a><tt class="py-lineno">268</tt>  <tt class="py-line"> </tt>
<a name="L269"></a><tt class="py-lineno">269</tt>  <tt class="py-line"><tt class="py-comment">#===============================================================================</tt> </tt>
<a name="archive_file"></a><div id="archive_file-def"><a name="L270"></a><tt class="py-lineno">270</tt> <a class="py-toggle" href="#" id="archive_file-toggle" onclick="return toggle('archive_file');">-</a><tt class="py-line"><tt class="py-keyword">def</tt> <a class="py-def-name" href="zgf_mdrun-module.html#archive_file">archive_file</a><tt class="py-op">(</tt><tt class="py-param">fn</tt><tt class="py-op">,</tt> <tt class="py-param">count</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
</div><div id="archive_file-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="archive_file-expanded"><a name="L271"></a><tt class="py-lineno">271</tt>  <tt class="py-line">        <tt class="py-keyword">assert</tt><tt class="py-op">(</tt> <tt class="py-name">os</tt><tt class="py-op">.</tt><tt class="py-name">path</tt><tt class="py-op">.</tt><tt class="py-name">exists</tt><tt class="py-op">(</tt><tt class="py-name">fn</tt><tt class="py-op">)</tt> <tt class="py-op">)</tt> </tt>
<a name="L272"></a><tt class="py-lineno">272</tt>  <tt class="py-line">        <tt class="py-name">out_fn</tt> <tt class="py-op">=</tt> <tt class="py-name">fn</tt><tt class="py-op">.</tt><tt class="py-name">rsplit</tt><tt class="py-op">(</tt><tt class="py-string">"."</tt><tt class="py-op">,</tt> <tt class="py-number">1</tt><tt class="py-op">)</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">]</tt> <tt class="py-op">+</tt> <tt class="py-string">"_run"</tt> <tt class="py-op">+</tt> <tt class="py-name">str</tt><tt class="py-op">(</tt><tt class="py-name">count</tt><tt class="py-op">)</tt> <tt class="py-op">+</tt> <tt class="py-string">"."</tt> <tt class="py-op">+</tt> <tt class="py-name">fn</tt><tt class="py-op">.</tt><tt class="py-name">rsplit</tt><tt class="py-op">(</tt><tt class="py-string">"."</tt><tt class="py-op">,</tt> <tt class="py-number">1</tt><tt class="py-op">)</tt><tt class="py-op">[</tt><tt class="py-number">1</tt><tt class="py-op">]</tt> </tt>
<a name="L273"></a><tt class="py-lineno">273</tt>  <tt class="py-line">        <tt class="py-name">os</tt><tt class="py-op">.</tt><tt class="py-name">rename</tt><tt class="py-op">(</tt><tt class="py-name">fn</tt><tt class="py-op">,</tt> <tt class="py-name">out_fn</tt><tt class="py-op">)</tt> </tt>
</div><a name="L274"></a><tt class="py-lineno">274</tt>  <tt class="py-line"> </tt>
<a name="L275"></a><tt class="py-lineno">275</tt>  <tt class="py-line"> </tt>
<a name="L276"></a><tt class="py-lineno">276</tt>  <tt class="py-line"><tt class="py-comment">#===============================================================================</tt> </tt>
<a name="conv_check_gelman_rubin"></a><div id="conv_check_gelman_rubin-def"><a name="L277"></a><tt class="py-lineno">277</tt> <a class="py-toggle" href="#" id="conv_check_gelman_rubin-toggle" onclick="return toggle('conv_check_gelman_rubin');">-</a><tt class="py-line"><tt class="py-keyword">def</tt> <a class="py-def-name" href="zgf_mdrun-module.html#conv_check_gelman_rubin">conv_check_gelman_rubin</a><tt class="py-op">(</tt><tt class="py-param">node</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
</div><div id="conv_check_gelman_rubin-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="conv_check_gelman_rubin-expanded"><a name="L278"></a><tt class="py-lineno">278</tt>  <tt class="py-line">        <tt id="link-158" class="py-name" targets="Method ZIBMolPy.internals.InternalArray.frames()=ZIBMolPy.internals.InternalArray-class.html#frames"><a title="ZIBMolPy.internals.InternalArray.frames" class="py-name" href="#" onclick="return doclink('link-158', 'frames', 'link-158');">frames</a></tt> <tt class="py-op">=</tt> <tt id="link-159" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-159', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-160" class="py-name" targets="Variable ZIBMolPy.node.Node.trajectory=ZIBMolPy.node.Node-class.html#trajectory"><a title="ZIBMolPy.node.Node.trajectory" class="py-name" href="#" onclick="return doclink('link-160', 'trajectory', 'link-160');">trajectory</a></tt> </tt>
<a name="L279"></a><tt class="py-lineno">279</tt>  <tt class="py-line">        <tt class="py-name">n_chains</tt> <tt class="py-op">=</tt> <tt id="link-161" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-161', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-162" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-162', 'pool', 'link-4');">pool</a></tt><tt class="py-op">.</tt><tt class="py-name">gr_chains</tt> </tt>
<a name="L280"></a><tt class="py-lineno">280</tt>  <tt class="py-line">        <tt class="py-name">threshold</tt> <tt class="py-op">=</tt> <tt id="link-163" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-163', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-164" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-164', 'pool', 'link-4');">pool</a></tt><tt class="py-op">.</tt><tt class="py-name">gr_threshold</tt> </tt>
<a name="L281"></a><tt class="py-lineno">281</tt>  <tt class="py-line">        <tt class="py-name">log</tt> <tt class="py-op">=</tt> <tt class="py-name">open</tt><tt class="py-op">(</tt><tt id="link-165" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-165', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-166" class="py-name" targets="Variable ZIBMolPy.node.Node.convergence_log_fn=ZIBMolPy.node.Node-class.html#convergence_log_fn"><a title="ZIBMolPy.node.Node.convergence_log_fn" class="py-name" href="#" onclick="return doclink('link-166', 'convergence_log_fn', 'link-166');">convergence_log_fn</a></tt><tt class="py-op">,</tt> <tt class="py-string">"a"</tt><tt class="py-op">)</tt> </tt>
<a name="L282"></a><tt class="py-lineno">282</tt>  <tt class="py-line">        <tt class="py-name">is_converged</tt> <tt class="py-op">=</tt> <tt id="link-167" class="py-name"><a title="ZIBMolPy.algorithms.gelman_rubin" class="py-name" href="#" onclick="return doclink('link-167', 'gelman_rubin', 'link-8');">gelman_rubin</a></tt><tt class="py-op">(</tt><tt id="link-168" class="py-name"><a title="ZIBMolPy.internals.InternalArray.frames" class="py-name" href="#" onclick="return doclink('link-168', 'frames', 'link-158');">frames</a></tt><tt class="py-op">,</tt> <tt class="py-name">n_chains</tt><tt class="py-op">,</tt> <tt class="py-name">threshold</tt><tt class="py-op">,</tt> <tt class="py-name">log</tt><tt class="py-op">)</tt> </tt>
<a name="L283"></a><tt class="py-lineno">283</tt>  <tt class="py-line">        <tt class="py-name">log</tt><tt class="py-op">.</tt><tt id="link-169" class="py-name" targets="Method ZIBMolPy.io.trr.TrrFile.close()=ZIBMolPy.io.trr.TrrFile-class.html#close"><a title="ZIBMolPy.io.trr.TrrFile.close" class="py-name" href="#" onclick="return doclink('link-169', 'close', 'link-169');">close</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L284"></a><tt class="py-lineno">284</tt>  <tt class="py-line">        <tt class="py-keyword">return</tt><tt class="py-op">(</tt><tt class="py-name">is_converged</tt><tt class="py-op">)</tt> </tt>
</div><a name="L285"></a><tt class="py-lineno">285</tt>  <tt class="py-line"> </tt>
<a name="L286"></a><tt class="py-lineno">286</tt>  <tt class="py-line"> </tt>
<a name="L287"></a><tt class="py-lineno">287</tt>  <tt class="py-line"><tt class="py-comment">#===============================================================================</tt> </tt>
<a name="get_merged_edr"></a><div id="get_merged_edr-def"><a name="L288"></a><tt class="py-lineno">288</tt> <a class="py-toggle" href="#" id="get_merged_edr-toggle" onclick="return toggle('get_merged_edr');">-</a><tt class="py-line"><tt class="py-keyword">def</tt> <a class="py-def-name" href="zgf_mdrun-module.html#get_merged_edr">get_merged_edr</a><tt class="py-op">(</tt><tt class="py-param">node</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
</div><div id="get_merged_edr-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="get_merged_edr-expanded"><a name="L289"></a><tt class="py-lineno">289</tt>  <tt class="py-line">        <tt class="py-comment"># get list of edr files</tt> </tt>
<a name="L290"></a><tt class="py-lineno">290</tt>  <tt class="py-line">        <tt class="py-name">edr_fnames</tt> <tt class="py-op">=</tt> <tt class="py-name">sorted</tt><tt class="py-op">(</tt><tt class="py-op">[</tt> <tt id="link-170" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-170', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-171" class="py-name"><a title="ZIBMolPy.node.Node.dir" class="py-name" href="#" onclick="return doclink('link-171', 'dir', 'link-65');">dir</a></tt><tt class="py-op">+</tt><tt class="py-string">"/"</tt><tt class="py-op">+</tt><tt class="py-name">fn</tt> <tt class="py-keyword">for</tt> <tt class="py-name">fn</tt> <tt class="py-keyword">in</tt> <tt class="py-name">os</tt><tt class="py-op">.</tt><tt class="py-name">listdir</tt><tt class="py-op">(</tt><tt id="link-172" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-172', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-173" class="py-name"><a title="ZIBMolPy.node.Node.dir" class="py-name" href="#" onclick="return doclink('link-173', 'dir', 'link-65');">dir</a></tt><tt class="py-op">)</tt> <tt class="py-keyword">if</tt> <tt class="py-name">re</tt><tt class="py-op">.</tt><tt id="link-174" class="py-name"><a title="zgf_test.match" class="py-name" href="#" onclick="return doclink('link-174', 'match', 'link-114');">match</a></tt><tt class="py-op">(</tt><tt class="py-string">"[^#].+run\d+.edr"</tt><tt class="py-op">,</tt> <tt class="py-name">fn</tt><tt class="py-op">)</tt> <tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L291"></a><tt class="py-lineno">291</tt>  <tt class="py-line">        <tt class="py-keyword">assert</tt><tt class="py-op">(</tt> <tt class="py-name">len</tt><tt class="py-op">(</tt><tt class="py-name">edr_fnames</tt><tt class="py-op">)</tt> <tt class="py-op">==</tt>  <tt id="link-175" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-175', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt class="py-name">extensions_max</tt><tt class="py-op">+</tt><tt class="py-number">1</tt> <tt class="py-op">)</tt> </tt>
<a name="L292"></a><tt class="py-lineno">292</tt>  <tt class="py-line"> </tt>
<a name="L293"></a><tt class="py-lineno">293</tt>  <tt class="py-line">        <tt class="py-comment"># find out about trr time step</tt> </tt>
<a name="L294"></a><tt class="py-lineno">294</tt>  <tt class="py-line">        <tt id="link-176" class="py-name"><a title="ZIBMolPy.io.trr" class="py-name" href="#" onclick="return doclink('link-176', 'trr', 'link-15');">trr</a></tt> <tt class="py-op">=</tt> <tt id="link-177" class="py-name"><a title="ZIBMolPy.io.trr.TrrFile" class="py-name" href="#" onclick="return doclink('link-177', 'TrrFile', 'link-16');">TrrFile</a></tt><tt class="py-op">(</tt><tt id="link-178" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-178', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-179" class="py-name"><a title="ZIBMolPy.node.Node.trr_fn" class="py-name" href="#" onclick="return doclink('link-179', 'trr_fn', 'link-84');">trr_fn</a></tt><tt class="py-op">)</tt> </tt>
<a name="L295"></a><tt class="py-lineno">295</tt>  <tt class="py-line">        <tt class="py-name">dt</tt> <tt class="py-op">=</tt> <tt id="link-180" class="py-name"><a title="ZIBMolPy.io.trr" class="py-name" href="#" onclick="return doclink('link-180', 'trr', 'link-15');">trr</a></tt><tt class="py-op">.</tt><tt class="py-name">first_frame</tt><tt class="py-op">.</tt><tt id="link-181" class="py-name" targets="Method ZIBMolPy.io.trr.TrrFrame.next()=ZIBMolPy.io.trr.TrrFrame-class.html#next"><a title="ZIBMolPy.io.trr.TrrFrame.next" class="py-name" href="#" onclick="return doclink('link-181', 'next', 'link-181');">next</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt><tt class="py-op">.</tt><tt class="py-name">t</tt> <tt class="py-op">-</tt> <tt id="link-182" class="py-name"><a title="ZIBMolPy.io.trr" class="py-name" href="#" onclick="return doclink('link-182', 'trr', 'link-15');">trr</a></tt><tt class="py-op">.</tt><tt class="py-name">first_frame</tt><tt class="py-op">.</tt><tt class="py-name">t</tt> </tt>
<a name="L296"></a><tt class="py-lineno">296</tt>  <tt class="py-line">        <tt id="link-183" class="py-name"><a title="ZIBMolPy.io.trr" class="py-name" href="#" onclick="return doclink('link-183', 'trr', 'link-15');">trr</a></tt><tt class="py-op">.</tt><tt id="link-184" class="py-name"><a title="ZIBMolPy.io.trr.TrrFile.close" class="py-name" href="#" onclick="return doclink('link-184', 'close', 'link-169');">close</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L297"></a><tt class="py-lineno">297</tt>  <tt class="py-line">        <tt class="py-comment"># dt is sometimes noisy in the final digits (three digits is femtosecond step = enough)</tt> </tt>
<a name="L298"></a><tt class="py-lineno">298</tt>  <tt class="py-line">        <tt class="py-name">dt</tt> <tt class="py-op">=</tt> <tt class="py-name">np</tt><tt class="py-op">.</tt><tt class="py-name">around</tt><tt class="py-op">(</tt><tt class="py-name">dt</tt><tt class="py-op">,</tt> <tt class="py-name">decimals</tt><tt class="py-op">=</tt><tt class="py-number">3</tt><tt class="py-op">)</tt> </tt>
<a name="L299"></a><tt class="py-lineno">299</tt>  <tt class="py-line"> </tt>
<a name="L300"></a><tt class="py-lineno">300</tt>  <tt class="py-line">        <tt class="py-name">time_offset</tt> <tt class="py-op">=</tt> <tt id="link-185" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-185', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt class="py-name">sampling_length</tt><tt class="py-op">+</tt><tt class="py-name">dt</tt> </tt>
<a name="L301"></a><tt class="py-lineno">301</tt>  <tt class="py-line"> </tt>
<a name="L302"></a><tt class="py-lineno">302</tt>  <tt class="py-line">        <tt class="py-keyword">for</tt> <tt class="py-name">edr_fn</tt> <tt class="py-keyword">in</tt> <tt class="py-name">edr_fnames</tt><tt class="py-op">[</tt><tt class="py-number">1</tt><tt class="py-op">:</tt><tt class="py-op">]</tt><tt class="py-op">:</tt>    </tt>
<a name="L303"></a><tt class="py-lineno">303</tt>  <tt class="py-line">                <tt class="py-comment"># adapt edr starting times</tt> </tt>
<a name="L304"></a><tt class="py-lineno">304</tt>  <tt class="py-line">                <tt class="py-name">cmd</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-string">"eneconv"</tt><tt class="py-op">,</tt> <tt class="py-string">"-f"</tt><tt class="py-op">,</tt> <tt class="py-name">edr_fn</tt><tt class="py-op">,</tt> <tt class="py-string">"-o"</tt><tt class="py-op">,</tt> <tt class="py-name">edr_fn</tt><tt class="py-op">,</tt> <tt class="py-string">"-settime"</tt><tt class="py-op">]</tt> </tt>
<a name="L305"></a><tt class="py-lineno">305</tt>  <tt class="py-line">                <tt class="py-keyword">print</tt><tt class="py-op">(</tt><tt class="py-string">"Calling: "</tt><tt class="py-op">+</tt><tt class="py-op">(</tt><tt class="py-string">" "</tt><tt class="py-op">.</tt><tt class="py-name">join</tt><tt class="py-op">(</tt><tt class="py-name">cmd</tt><tt class="py-op">)</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> </tt>
<a name="L306"></a><tt class="py-lineno">306</tt>  <tt class="py-line">                <tt class="py-name">p</tt> <tt class="py-op">=</tt> <tt class="py-name">Popen</tt><tt class="py-op">(</tt><tt class="py-name">cmd</tt><tt class="py-op">,</tt> <tt class="py-name">stdin</tt><tt class="py-op">=</tt><tt class="py-name">PIPE</tt><tt class="py-op">)</tt> </tt>
<a name="L307"></a><tt class="py-lineno">307</tt>  <tt class="py-line">                <tt class="py-name">p</tt><tt class="py-op">.</tt><tt class="py-name">communicate</tt><tt class="py-op">(</tt><tt class="py-name">input</tt><tt class="py-op">=</tt><tt class="py-op">(</tt><tt class="py-name">str</tt><tt class="py-op">(</tt><tt class="py-name">time_offset</tt><tt class="py-op">)</tt><tt class="py-op">+</tt><tt class="py-string">"\n"</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> </tt>
<a name="L308"></a><tt class="py-lineno">308</tt>  <tt class="py-line">                <tt class="py-keyword">assert</tt><tt class="py-op">(</tt><tt class="py-name">p</tt><tt class="py-op">.</tt><tt class="py-name">wait</tt><tt class="py-op">(</tt><tt class="py-op">)</tt> <tt class="py-op">==</tt> <tt class="py-number">0</tt><tt class="py-op">)</tt> </tt>
<a name="L309"></a><tt class="py-lineno">309</tt>  <tt class="py-line"> </tt>
<a name="L310"></a><tt class="py-lineno">310</tt>  <tt class="py-line">                <tt class="py-name">time_offset</tt> <tt class="py-op">+=</tt> <tt id="link-186" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-186', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt class="py-name">extensions_length</tt><tt class="py-op">+</tt><tt class="py-name">dt</tt> </tt>
<a name="L311"></a><tt class="py-lineno">311</tt>  <tt class="py-line"> </tt>
<a name="L312"></a><tt class="py-lineno">312</tt>  <tt class="py-line">        <tt class="py-comment"># concatenate edr files with adapted starting times</tt> </tt>
<a name="L313"></a><tt class="py-lineno">313</tt>  <tt class="py-line">        <tt class="py-name">cmd</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-string">"eneconv"</tt><tt class="py-op">,</tt> <tt class="py-string">"-f"</tt><tt class="py-op">]</tt> <tt class="py-op">+</tt> <tt class="py-name">edr_fnames</tt> <tt class="py-op">+</tt> <tt class="py-op">[</tt><tt class="py-string">"-o"</tt><tt class="py-op">,</tt> <tt id="link-187" class="py-name"><a title="ZIBMolPy.node" class="py-name" href="#" onclick="return doclink('link-187', 'node', 'link-59');">node</a></tt><tt class="py-op">.</tt><tt id="link-188" class="py-name"><a title="ZIBMolPy.node.Node.dir" class="py-name" href="#" onclick="return doclink('link-188', 'dir', 'link-65');">dir</a></tt><tt class="py-op">+</tt><tt class="py-string">"/ener.edr"</tt><tt class="py-op">]</tt> </tt>
<a name="L314"></a><tt class="py-lineno">314</tt>  <tt class="py-line">        <tt class="py-keyword">print</tt><tt class="py-op">(</tt><tt class="py-string">"Calling: "</tt><tt class="py-op">+</tt><tt class="py-op">(</tt><tt class="py-string">" "</tt><tt class="py-op">.</tt><tt class="py-name">join</tt><tt class="py-op">(</tt><tt class="py-name">cmd</tt><tt class="py-op">)</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> </tt>
<a name="L315"></a><tt class="py-lineno">315</tt>  <tt class="py-line">        <tt class="py-name">p</tt> <tt class="py-op">=</tt> <tt class="py-name">Popen</tt><tt class="py-op">(</tt><tt class="py-name">cmd</tt><tt class="py-op">)</tt> </tt>
<a name="L316"></a><tt class="py-lineno">316</tt>  <tt class="py-line">        <tt class="py-name">retcode</tt> <tt class="py-op">=</tt> <tt class="py-name">p</tt><tt class="py-op">.</tt><tt class="py-name">wait</tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L317"></a><tt class="py-lineno">317</tt>  <tt class="py-line">        <tt class="py-keyword">assert</tt><tt class="py-op">(</tt><tt class="py-name">retcode</tt> <tt class="py-op">==</tt> <tt class="py-number">0</tt><tt class="py-op">)</tt> </tt>
</div><a name="L318"></a><tt class="py-lineno">318</tt>  <tt class="py-line"> </tt>
<a name="L319"></a><tt class="py-lineno">319</tt>  <tt class="py-line"> </tt>
<a name="L320"></a><tt class="py-lineno">320</tt>  <tt class="py-line"><tt class="py-comment">#===============================================================================</tt> </tt>
<a name="L321"></a><tt class="py-lineno">321</tt>  <tt class="py-line"><tt class="py-keyword">if</tt><tt class="py-op">(</tt><tt class="py-name">__name__</tt> <tt class="py-op">==</tt> <tt class="py-string">"__main__"</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L322"></a><tt class="py-lineno">322</tt>  <tt class="py-line">        <tt id="link-189" class="py-name"><a title="zgf_analyze.main
zgf_browser.main
zgf_cleanup.main
zgf_concatenate_stuff.main
zgf_create_nodes.main
zgf_create_pmatrix.main
zgf_create_pool.main
zgf_create_rates.main
zgf_create_tnodes.main
zgf_create_unrestrained_nodes.main
zgf_discard_solvent.main
zgf_export_pool.main
zgf_extract_conformations.main
zgf_gauge_times.main
zgf_genion.main
zgf_grompp.main
zgf_mdrun.main
zgf_recover_state.main
zgf_refine.main
zgf_remove_nodes.main
zgf_rerun.main
zgf_reweight.main
zgf_reweight_wham.main
zgf_setup_nodes.main
zgf_solvate_nodes.main
zgf_submit_job_HLRN.main
zgf_test.main
zgf_upgrade.main" class="py-name" href="#" onclick="return doclink('link-189', 'main', 'link-53');">main</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L323"></a><tt class="py-lineno">323</tt>  <tt class="py-line"> </tt>
<a name="L324"></a><tt class="py-lineno">324</tt>  <tt class="py-line"><tt class="py-comment">#EOF</tt> </tt>
<a name="L325"></a><tt class="py-lineno">325</tt>  <tt class="py-line"> </tt><script type="text/javascript">
<!--
expandto(location.href);
// -->
</script>
</pre>
<br />
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">
  <!-- Home link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="ZIBMolPy-module.html">Home</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="https://wiki.kobv.de/confluence/display/AGCMD/ZIBMolPy">ZIBMolPy</a></th>
          </tr></table></th>
  </tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%%">
  <tr>
    <td align="left" class="footer">
    Generated by Epydoc 3.0.1 on Wed Feb 13 11:19:38 2013
    </td>
    <td align="right" class="footer">
      <a target="mainFrame" href="http://epydoc.sourceforge.net"
        >http://epydoc.sourceforge.net</a>
    </td>
  </tr>
</table>

<script type="text/javascript">
  <!--
  // Private objects are initially displayed (because if
  // javascript is turned off then we want them to be
  // visible); but by default, we want to hide them.  So hide
  // them unless we have a cookie that says to show them.
  checkCookie();
  // -->
</script>
</body>
</html>
