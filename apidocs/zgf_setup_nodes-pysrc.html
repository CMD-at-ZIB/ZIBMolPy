<?xml version="1.0" encoding="ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>zgf_setup_nodes</title>
  <link rel="stylesheet" href="epydoc.css" type="text/css" />
  <script type="text/javascript" src="epydoc.js"></script>
	
	<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        displayMath: [['$$', '$$'], ["\\[", "\\]"]]
      }
    });
    </script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
	</head>
	

<body bgcolor="white" text="black" link="blue" vlink="#204080"
      alink="#204080">
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">
  <!-- Home link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="ZIBMolPy-module.html">Home</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="https://wiki.kobv.de/confluence/display/AGCMD/ZIBMolPy">ZIBMolPy</a></th>
          </tr></table></th>
  </tr>
</table>
<table width="100%" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="100%">
      <span class="breadcrumbs">
        Module&nbsp;zgf_setup_nodes
      </span>
    </td>
    <td>
      <table cellpadding="0" cellspacing="0">
        <!-- hide/show private -->
        <tr><td align="right"><span class="options"
            >[<a href="frames.html" target="_top">frames</a
            >]&nbsp;|&nbsp;<a href="zgf_setup_nodes-pysrc.html"
            target="_top">no&nbsp;frames</a>]</span></td></tr>
      </table>
    </td>
  </tr>
</table>
<h1 class="epydoc">Source Code for <a href="zgf_setup_nodes-module.html">Module zgf_setup_nodes</a></h1>
<pre class="py-src">
<a name="L1"></a><tt class="py-lineno">  1</tt>  <tt class="py-line"><tt class="py-comment">#!/usr/bin/python</tt> </tt>
<a name="L2"></a><tt class="py-lineno">  2</tt>  <tt class="py-line"><tt class="py-comment"># -*- coding: utf-8 -*-</tt> </tt>
<a name="L3"></a><tt class="py-lineno">  3</tt>  <tt class="py-line"> </tt>
<a name="L4"></a><tt class="py-lineno">  4</tt>  <tt class="py-line"><tt class="py-docstring">"""</tt> </tt>
<a name="L5"></a><tt class="py-lineno">  5</tt>  <tt class="py-line"><tt class="py-docstring">What it does</tt> </tt>
<a name="L6"></a><tt class="py-lineno">  6</tt>  <tt class="py-line"><tt class="py-docstring">============</tt> </tt>
<a name="L7"></a><tt class="py-lineno">  7</tt>  <tt class="py-line"><tt class="py-docstring">        B{This is the third step of ZIBgridfree.}</tt> </tt>
<a name="L8"></a><tt class="py-lineno">  8</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L9"></a><tt class="py-lineno">  9</tt>  <tt class="py-line"><tt class="py-docstring">        After a set of initial nodes has been created by zgf_create_nodes, this tool will, for each node, setup all the files that are necessary for Gromacs to run the sampling. This includes writing the initial geometry to each node directory, and creating a per-node topology file that contains the restraint setup that is used to fit the node's phi function.</tt> </tt>
<a name="L10"></a><tt class="py-lineno"> 10</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L11"></a><tt class="py-lineno"> 11</tt>  <tt class="py-line"><tt class="py-docstring">        B{The next step is L{zgf_grompp}.}</tt> </tt>
<a name="L12"></a><tt class="py-lineno"> 12</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L13"></a><tt class="py-lineno"> 13</tt>  <tt class="py-line"><tt class="py-docstring">How it works</tt> </tt>
<a name="L14"></a><tt class="py-lineno"> 14</tt>  <tt class="py-line"><tt class="py-docstring">============</tt> </tt>
<a name="L15"></a><tt class="py-lineno"> 15</tt>  <tt class="py-line"><tt class="py-docstring">        At the command line, type::</tt> </tt>
<a name="L16"></a><tt class="py-lineno"> 16</tt>  <tt class="py-line"><tt class="py-docstring">                $ zgf_setup_nodes</tt> </tt>
<a name="L17"></a><tt class="py-lineno"> 17</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L18"></a><tt class="py-lineno"> 18</tt>  <tt class="py-line"><tt class="py-docstring">"""</tt> </tt>
<a name="L19"></a><tt class="py-lineno"> 19</tt>  <tt class="py-line"> </tt>
<a name="L20"></a><tt class="py-lineno"> 20</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt id="link-0" class="py-name" targets="Package ZIBMolPy=ZIBMolPy-module.html"><a title="ZIBMolPy" class="py-name" href="#" onclick="return doclink('link-0', 'ZIBMolPy', 'link-0');">ZIBMolPy</a></tt><tt class="py-op">.</tt><tt id="link-1" class="py-name" targets="Module ZIBMolPy.restraint=ZIBMolPy.restraint-module.html"><a title="ZIBMolPy.restraint" class="py-name" href="#" onclick="return doclink('link-1', 'restraint', 'link-1');">restraint</a></tt> <tt class="py-keyword">import</tt> <tt id="link-2" class="py-name" targets="Class ZIBMolPy.restraint.DihedralRestraint=ZIBMolPy.restraint.DihedralRestraint-class.html"><a title="ZIBMolPy.restraint.DihedralRestraint" class="py-name" href="#" onclick="return doclink('link-2', 'DihedralRestraint', 'link-2');">DihedralRestraint</a></tt><tt class="py-op">,</tt> <tt id="link-3" class="py-name" targets="Class ZIBMolPy.restraint.DistanceRestraint=ZIBMolPy.restraint.DistanceRestraint-class.html"><a title="ZIBMolPy.restraint.DistanceRestraint" class="py-name" href="#" onclick="return doclink('link-3', 'DistanceRestraint', 'link-3');">DistanceRestraint</a></tt> </tt>
<a name="L21"></a><tt class="py-lineno"> 21</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt id="link-4" class="py-name"><a title="ZIBMolPy" class="py-name" href="#" onclick="return doclink('link-4', 'ZIBMolPy', 'link-0');">ZIBMolPy</a></tt><tt class="py-op">.</tt><tt id="link-5" class="py-name" targets="Variable ZIBMolPy.node.Node.pool=ZIBMolPy.node.Node-class.html#pool,Module ZIBMolPy.pool=ZIBMolPy.pool-module.html"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-5', 'pool', 'link-5');">pool</a></tt> <tt class="py-keyword">import</tt> <tt id="link-6" class="py-name" targets="Class ZIBMolPy.pool.Pool=ZIBMolPy.pool.Pool-class.html"><a title="ZIBMolPy.pool.Pool" class="py-name" href="#" onclick="return doclink('link-6', 'Pool', 'link-6');">Pool</a></tt> </tt>
<a name="L22"></a><tt class="py-lineno"> 22</tt>  <tt class="py-line"><tt class="py-keyword">import</tt> <tt id="link-7" class="py-name"><a title="ZIBMolPy" class="py-name" href="#" onclick="return doclink('link-7', 'ZIBMolPy', 'link-0');">ZIBMolPy</a></tt><tt class="py-op">.</tt><tt id="link-8" class="py-name" targets="Module ZIBMolPy.io.topology=ZIBMolPy.io.topology-module.html,Module ZIBMolPy.topology=ZIBMolPy.topology-module.html"><a title="ZIBMolPy.io.topology
ZIBMolPy.topology" class="py-name" href="#" onclick="return doclink('link-8', 'topology', 'link-8');">topology</a></tt> <tt class="py-keyword">as</tt> <tt id="link-9" class="py-name"><a title="ZIBMolPy.io.topology
ZIBMolPy.topology" class="py-name" href="#" onclick="return doclink('link-9', 'topology', 'link-8');">topology</a></tt> </tt>
<a name="L23"></a><tt class="py-lineno"> 23</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt id="link-10" class="py-name"><a title="ZIBMolPy" class="py-name" href="#" onclick="return doclink('link-10', 'ZIBMolPy', 'link-0');">ZIBMolPy</a></tt><tt class="py-op">.</tt><tt id="link-11" class="py-name" targets="Module ZIBMolPy.ui=ZIBMolPy.ui-module.html"><a title="ZIBMolPy.ui" class="py-name" href="#" onclick="return doclink('link-11', 'ui', 'link-11');">ui</a></tt> <tt class="py-keyword">import</tt> <tt id="link-12" class="py-name" targets="Class ZIBMolPy.ui.OptionsList=ZIBMolPy.ui.OptionsList-class.html"><a title="ZIBMolPy.ui.OptionsList" class="py-name" href="#" onclick="return doclink('link-12', 'OptionsList', 'link-12');">OptionsList</a></tt> </tt>
<a name="L24"></a><tt class="py-lineno"> 24</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt id="link-13" class="py-name"><a title="ZIBMolPy" class="py-name" href="#" onclick="return doclink('link-13', 'ZIBMolPy', 'link-0');">ZIBMolPy</a></tt><tt class="py-op">.</tt><tt id="link-14" class="py-name" targets="Package ZIBMolPy.io=ZIBMolPy.io-module.html"><a title="ZIBMolPy.io" class="py-name" href="#" onclick="return doclink('link-14', 'io', 'link-14');">io</a></tt><tt class="py-op">.</tt><tt id="link-15" class="py-name" targets="Module ZIBMolPy.io.trr=ZIBMolPy.io.trr-module.html"><a title="ZIBMolPy.io.trr" class="py-name" href="#" onclick="return doclink('link-15', 'trr', 'link-15');">trr</a></tt> <tt class="py-keyword">import</tt> <tt id="link-16" class="py-name" targets="Class ZIBMolPy.io.trr.TrrFile=ZIBMolPy.io.trr.TrrFile-class.html"><a title="ZIBMolPy.io.trr.TrrFile" class="py-name" href="#" onclick="return doclink('link-16', 'TrrFile', 'link-16');">TrrFile</a></tt> </tt>
<a name="L25"></a><tt class="py-lineno"> 25</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt id="link-17" class="py-name"><a title="ZIBMolPy" class="py-name" href="#" onclick="return doclink('link-17', 'ZIBMolPy', 'link-0');">ZIBMolPy</a></tt><tt class="py-op">.</tt><tt id="link-18" class="py-name" targets="Module ZIBMolPy.gromacs=ZIBMolPy.gromacs-module.html"><a title="ZIBMolPy.gromacs" class="py-name" href="#" onclick="return doclink('link-18', 'gromacs', 'link-18');">gromacs</a></tt> <tt class="py-keyword">import</tt> <tt id="link-19" class="py-name" targets="Function ZIBMolPy.gromacs.read_mdp_file()=ZIBMolPy.gromacs-module.html#read_mdp_file"><a title="ZIBMolPy.gromacs.read_mdp_file" class="py-name" href="#" onclick="return doclink('link-19', 'read_mdp_file', 'link-19');">read_mdp_file</a></tt> </tt>
<a name="L26"></a><tt class="py-lineno"> 26</tt>  <tt class="py-line"> </tt>
<a name="L27"></a><tt class="py-lineno"> 27</tt>  <tt class="py-line"><tt class="py-keyword">import</tt> <tt class="py-name">sys</tt> </tt>
<a name="L28"></a><tt class="py-lineno"> 28</tt>  <tt class="py-line"><tt class="py-keyword">import</tt> <tt class="py-name">os</tt> </tt>
<a name="L29"></a><tt class="py-lineno"> 29</tt>  <tt class="py-line"><tt class="py-keyword">import</tt> <tt class="py-name">re</tt> </tt>
<a name="L30"></a><tt class="py-lineno"> 30</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt class="py-name">tempfile</tt> <tt class="py-keyword">import</tt> <tt class="py-name">mktemp</tt> </tt>
<a name="L31"></a><tt class="py-lineno"> 31</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt class="py-name">subprocess</tt> <tt class="py-keyword">import</tt> <tt class="py-name">Popen</tt><tt class="py-op">,</tt> <tt class="py-name">PIPE</tt> </tt>
<a name="L32"></a><tt class="py-lineno"> 32</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt class="py-name">math</tt> <tt class="py-keyword">import</tt> <tt class="py-name">degrees</tt> </tt>
<a name="L33"></a><tt class="py-lineno"> 33</tt>  <tt class="py-line"><tt class="py-keyword">import</tt> <tt class="py-name">numpy</tt> <tt class="py-keyword">as</tt> <tt class="py-name">np</tt> </tt>
<a name="L34"></a><tt class="py-lineno"> 34</tt>  <tt class="py-line"><tt class="py-keyword">import</tt> <tt class="py-name">shutil</tt> </tt>
<a name="L35"></a><tt class="py-lineno"> 35</tt>  <tt class="py-line"> </tt>
<a name="L36"></a><tt class="py-lineno"> 36</tt>  <tt class="py-line"><tt id="link-20" class="py-name" targets="Variable zgf_analyze.options_desc=zgf_analyze-module.html#options_desc,Variable zgf_cleanup.options_desc=zgf_cleanup-module.html#options_desc,Variable zgf_create_nodes.options_desc=zgf_create_nodes-module.html#options_desc,Variable zgf_create_pool.options_desc=zgf_create_pool-module.html#options_desc,Variable zgf_create_rates.options_desc=zgf_create_rates-module.html#options_desc,Variable zgf_create_unrestrained_nodes.options_desc=zgf_create_unrestrained_nodes-module.html#options_desc,Variable zgf_extract_conformations.options_desc=zgf_extract_conformations-module.html#options_desc,Variable zgf_genion.options_desc=zgf_genion-module.html#options_desc,Variable zgf_grompp.options_desc=zgf_grompp-module.html#options_desc,Variable zgf_mdrun.options_desc=zgf_mdrun-module.html#options_desc,Variable zgf_recover_failed.options_desc=zgf_recover_failed-module.html#options_desc,Variable zgf_refine.options_desc=zgf_refine-module.html#options_desc,Variable zgf_remove_nodes.options_desc=zgf_remove_nodes-module.html#options_desc,Variable zgf_reweight.options_desc=zgf_reweight-module.html#options_desc,Variable zgf_setup_nodes.options_desc=zgf_setup_nodes-module.html#options_desc,Variable zgf_solvate_nodes.options_desc=zgf_solvate_nodes-module.html#options_desc,Variable zgf_submit_job_HLRN.options_desc=zgf_submit_job_HLRN-module.html#options_desc,Variable zgf_upgrade.options_desc=zgf_upgrade-module.html#options_desc"><a title="zgf_analyze.options_desc
zgf_cleanup.options_desc
zgf_create_nodes.options_desc
zgf_create_pool.options_desc
zgf_create_rates.options_desc
zgf_create_unrestrained_nodes.options_desc
zgf_extract_conformations.options_desc
zgf_genion.options_desc
zgf_grompp.options_desc
zgf_mdrun.options_desc
zgf_recover_failed.options_desc
zgf_refine.options_desc
zgf_remove_nodes.options_desc
zgf_reweight.options_desc
zgf_setup_nodes.options_desc
zgf_solvate_nodes.options_desc
zgf_submit_job_HLRN.options_desc
zgf_upgrade.options_desc" class="py-name" href="#" onclick="return doclink('link-20', 'options_desc', 'link-20');">options_desc</a></tt> <tt class="py-op">=</tt> <tt id="link-21" class="py-name"><a title="ZIBMolPy.ui.OptionsList" class="py-name" href="#" onclick="return doclink('link-21', 'OptionsList', 'link-12');">OptionsList</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L37"></a><tt class="py-lineno"> 37</tt>  <tt class="py-line"> </tt>
<a name="L38"></a><tt class="py-lineno"> 38</tt>  <tt class="py-line"><tt class="py-name">sys</tt><tt class="py-op">.</tt><tt class="py-name">modules</tt><tt class="py-op">[</tt><tt class="py-name">__name__</tt><tt class="py-op">]</tt><tt class="py-op">.</tt><tt class="py-name">__doc__</tt> <tt class="py-op">+=</tt> <tt id="link-22" class="py-name"><a title="zgf_analyze.options_desc
zgf_cleanup.options_desc
zgf_create_nodes.options_desc
zgf_create_pool.options_desc
zgf_create_rates.options_desc
zgf_create_unrestrained_nodes.options_desc
zgf_extract_conformations.options_desc
zgf_genion.options_desc
zgf_grompp.options_desc
zgf_mdrun.options_desc
zgf_recover_failed.options_desc
zgf_refine.options_desc
zgf_remove_nodes.options_desc
zgf_reweight.options_desc
zgf_setup_nodes.options_desc
zgf_solvate_nodes.options_desc
zgf_submit_job_HLRN.options_desc
zgf_upgrade.options_desc" class="py-name" href="#" onclick="return doclink('link-22', 'options_desc', 'link-20');">options_desc</a></tt><tt class="py-op">.</tt><tt id="link-23" class="py-name" targets="Method ZIBMolPy.ui.OptionsList.epytext()=ZIBMolPy.ui.OptionsList-class.html#epytext"><a title="ZIBMolPy.ui.OptionsList.epytext" class="py-name" href="#" onclick="return doclink('link-23', 'epytext', 'link-23');">epytext</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt> <tt class="py-comment"># for epydoc</tt> </tt>
<a name="L39"></a><tt class="py-lineno"> 39</tt>  <tt class="py-line"> </tt>
<a name="L40"></a><tt class="py-lineno"> 40</tt>  <tt class="py-line"> </tt>
<a name="is_applicable"></a><div id="is_applicable-def"><a name="L41"></a><tt class="py-lineno"> 41</tt> <a class="py-toggle" href="#" id="is_applicable-toggle" onclick="return toggle('is_applicable');">-</a><tt class="py-line"><tt class="py-keyword">def</tt> <a class="py-def-name" href="zgf_setup_nodes-module.html#is_applicable">is_applicable</a><tt class="py-op">(</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
</div><div id="is_applicable-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="is_applicable-expanded"><a name="L42"></a><tt class="py-lineno"> 42</tt>  <tt class="py-line">        <tt id="link-24" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-24', 'pool', 'link-5');">pool</a></tt> <tt class="py-op">=</tt> <tt id="link-25" class="py-name"><a title="ZIBMolPy.pool.Pool" class="py-name" href="#" onclick="return doclink('link-25', 'Pool', 'link-6');">Pool</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L43"></a><tt class="py-lineno"> 43</tt>  <tt class="py-line">        <tt class="py-keyword">return</tt><tt class="py-op">(</tt><tt class="py-name">len</tt><tt class="py-op">(</tt><tt id="link-26" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-26', 'pool', 'link-5');">pool</a></tt><tt class="py-op">.</tt><tt id="link-27" class="py-name" targets="Method ZIBMolPy.pool.NodeList.where()=ZIBMolPy.pool.NodeList-class.html#where"><a title="ZIBMolPy.pool.NodeList.where" class="py-name" href="#" onclick="return doclink('link-27', 'where', 'link-27');">where</a></tt><tt class="py-op">(</tt><tt class="py-string">"state == 'created'"</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> <tt class="py-op">&gt;</tt> <tt class="py-number">0</tt><tt class="py-op">)</tt> </tt>
</div><a name="L44"></a><tt class="py-lineno"> 44</tt>  <tt class="py-line"> </tt>
<a name="L45"></a><tt class="py-lineno"> 45</tt>  <tt class="py-line">         </tt>
<a name="L46"></a><tt class="py-lineno"> 46</tt>  <tt class="py-line"><tt class="py-comment">#===============================================================================</tt> </tt>
<a name="main"></a><div id="main-def"><a name="L47"></a><tt class="py-lineno"> 47</tt> <a class="py-toggle" href="#" id="main-toggle" onclick="return toggle('main');">-</a><tt class="py-line"><tt class="py-keyword">def</tt> <a class="py-def-name" href="zgf_setup_nodes-module.html#main">main</a><tt class="py-op">(</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
</div><div id="main-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="main-expanded"><a name="L48"></a><tt class="py-lineno"> 48</tt>  <tt class="py-line">         </tt>
<a name="L49"></a><tt class="py-lineno"> 49</tt>  <tt class="py-line">        <tt id="link-28" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-28', 'pool', 'link-5');">pool</a></tt> <tt class="py-op">=</tt> <tt id="link-29" class="py-name"><a title="ZIBMolPy.pool.Pool" class="py-name" href="#" onclick="return doclink('link-29', 'Pool', 'link-6');">Pool</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L50"></a><tt class="py-lineno"> 50</tt>  <tt class="py-line">        <tt class="py-name">needy_nodes</tt> <tt class="py-op">=</tt> <tt id="link-30" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-30', 'pool', 'link-5');">pool</a></tt><tt class="py-op">.</tt><tt id="link-31" class="py-name"><a title="ZIBMolPy.pool.NodeList.where" class="py-name" href="#" onclick="return doclink('link-31', 'where', 'link-27');">where</a></tt><tt class="py-op">(</tt><tt class="py-string">"state == 'created'"</tt><tt class="py-op">)</tt> </tt>
<a name="L51"></a><tt class="py-lineno"> 51</tt>  <tt class="py-line">        <tt class="py-keyword">assert</tt><tt class="py-op">(</tt><tt class="py-name">len</tt><tt class="py-op">(</tt><tt class="py-name">needy_nodes</tt><tt class="py-op">)</tt> <tt class="py-op">==</tt> <tt class="py-name">len</tt><tt class="py-op">(</tt><tt class="py-name">needy_nodes</tt><tt class="py-op">.</tt><tt id="link-32" class="py-name" targets="Method ZIBMolPy.pool.NodeList.multilock()=ZIBMolPy.pool.NodeList-class.html#multilock"><a title="ZIBMolPy.pool.NodeList.multilock" class="py-name" href="#" onclick="return doclink('link-32', 'multilock', 'link-32');">multilock</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> <tt class="py-comment"># make sure we lock ALL nodes</tt> </tt>
<a name="L52"></a><tt class="py-lineno"> 52</tt>  <tt class="py-line">         </tt>
<a name="L53"></a><tt class="py-lineno"> 53</tt>  <tt class="py-line">        <tt id="link-33" class="py-name" targets="Function zgf_setup_nodes.extract_frames()=zgf_setup_nodes-module.html#extract_frames"><a title="zgf_setup_nodes.extract_frames" class="py-name" href="#" onclick="return doclink('link-33', 'extract_frames', 'link-33');">extract_frames</a></tt><tt class="py-op">(</tt><tt id="link-34" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-34', 'pool', 'link-5');">pool</a></tt><tt class="py-op">)</tt> </tt>
<a name="L54"></a><tt class="py-lineno"> 54</tt>  <tt class="py-line">        <tt id="link-35" class="py-name" targets="Function zgf_setup_nodes.generate_topology()=zgf_setup_nodes-module.html#generate_topology"><a title="zgf_setup_nodes.generate_topology" class="py-name" href="#" onclick="return doclink('link-35', 'generate_topology', 'link-35');">generate_topology</a></tt><tt class="py-op">(</tt><tt id="link-36" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-36', 'pool', 'link-5');">pool</a></tt><tt class="py-op">)</tt> </tt>
<a name="L55"></a><tt class="py-lineno"> 55</tt>  <tt class="py-line">        <tt id="link-37" class="py-name" targets="Function zgf_setup_nodes.generate_mdp()=zgf_setup_nodes-module.html#generate_mdp"><a title="zgf_setup_nodes.generate_mdp" class="py-name" href="#" onclick="return doclink('link-37', 'generate_mdp', 'link-37');">generate_mdp</a></tt><tt class="py-op">(</tt><tt id="link-38" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-38', 'pool', 'link-5');">pool</a></tt><tt class="py-op">)</tt> </tt>
<a name="L56"></a><tt class="py-lineno"> 56</tt>  <tt class="py-line">         </tt>
<a name="L57"></a><tt class="py-lineno"> 57</tt>  <tt class="py-line">        <tt class="py-keyword">for</tt> <tt class="py-name">n</tt> <tt class="py-keyword">in</tt> <tt class="py-name">needy_nodes</tt><tt class="py-op">:</tt> </tt>
<a name="L58"></a><tt class="py-lineno"> 58</tt>  <tt class="py-line">                <tt class="py-name">n</tt><tt class="py-op">.</tt><tt class="py-name">state</tt> <tt class="py-op">=</tt> <tt class="py-string">"grompp-able"</tt> </tt>
<a name="L59"></a><tt class="py-lineno"> 59</tt>  <tt class="py-line">                <tt class="py-name">n</tt><tt class="py-op">.</tt><tt id="link-39" class="py-name" targets="Method ZIBMolPy.node.Node.save()=ZIBMolPy.node.Node-class.html#save,Method ZIBMolPy.pool.Pool.save()=ZIBMolPy.pool.Pool-class.html#save"><a title="ZIBMolPy.node.Node.save
ZIBMolPy.pool.Pool.save" class="py-name" href="#" onclick="return doclink('link-39', 'save', 'link-39');">save</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L60"></a><tt class="py-lineno"> 60</tt>  <tt class="py-line">                <tt class="py-name">n</tt><tt class="py-op">.</tt><tt id="link-40" class="py-name" targets="Method ZIBMolPy.node.Node.unlock()=ZIBMolPy.node.Node-class.html#unlock,Method ZIBMolPy.pool.NodeList.unlock()=ZIBMolPy.pool.NodeList-class.html#unlock"><a title="ZIBMolPy.node.Node.unlock
ZIBMolPy.pool.NodeList.unlock" class="py-name" href="#" onclick="return doclink('link-40', 'unlock', 'link-40');">unlock</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
</div><a name="L61"></a><tt class="py-lineno"> 61</tt>  <tt class="py-line"> </tt>
<a name="L62"></a><tt class="py-lineno"> 62</tt>  <tt class="py-line"><tt class="py-comment">#===============================================================================</tt> </tt>
<a name="generate_mdp"></a><div id="generate_mdp-def"><a name="L63"></a><tt class="py-lineno"> 63</tt> <a class="py-toggle" href="#" id="generate_mdp-toggle" onclick="return toggle('generate_mdp');">-</a><tt class="py-line"><tt class="py-keyword">def</tt> <a class="py-def-name" href="zgf_setup_nodes-module.html#generate_mdp">generate_mdp</a><tt class="py-op">(</tt><tt class="py-param">pool</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
</div><div id="generate_mdp-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="generate_mdp-expanded"><a name="L64"></a><tt class="py-lineno"> 64</tt>  <tt class="py-line">        <tt class="py-name">mdp</tt> <tt class="py-op">=</tt> <tt id="link-41" class="py-name"><a title="ZIBMolPy.gromacs.read_mdp_file" class="py-name" href="#" onclick="return doclink('link-41', 'read_mdp_file', 'link-19');">read_mdp_file</a></tt><tt class="py-op">(</tt><tt id="link-42" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-42', 'pool', 'link-5');">pool</a></tt><tt class="py-op">.</tt><tt id="link-43" class="py-name" targets="Variable ZIBMolPy.node.Node.mdp_fn=ZIBMolPy.node.Node-class.html#mdp_fn"><a title="ZIBMolPy.node.Node.mdp_fn" class="py-name" href="#" onclick="return doclink('link-43', 'mdp_fn', 'link-43');">mdp_fn</a></tt><tt class="py-op">)</tt> </tt>
<a name="L65"></a><tt class="py-lineno"> 65</tt>  <tt class="py-line">        <tt class="py-name">dt</tt> <tt class="py-op">=</tt> <tt class="py-name">float</tt><tt class="py-op">(</tt><tt class="py-name">mdp</tt><tt class="py-op">[</tt><tt class="py-string">'dt'</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L66"></a><tt class="py-lineno"> 66</tt>  <tt class="py-line">        <tt class="py-name">orig_mdp</tt> <tt class="py-op">=</tt> <tt class="py-name">open</tt><tt class="py-op">(</tt><tt id="link-44" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-44', 'pool', 'link-5');">pool</a></tt><tt class="py-op">.</tt><tt id="link-45" class="py-name"><a title="ZIBMolPy.node.Node.mdp_fn" class="py-name" href="#" onclick="return doclink('link-45', 'mdp_fn', 'link-43');">mdp_fn</a></tt><tt class="py-op">)</tt><tt class="py-op">.</tt><tt class="py-name">read</tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L67"></a><tt class="py-lineno"> 67</tt>  <tt class="py-line">        <tt class="py-name">orig_mdp</tt> <tt class="py-op">=</tt> <tt class="py-name">re</tt><tt class="py-op">.</tt><tt id="link-46" class="py-name" targets="Static Method ZIBMolPy.internals.DihedralCoordinate.sub()=ZIBMolPy.internals.DihedralCoordinate-class.html#sub,Static Method ZIBMolPy.internals.InternalCoordinate.sub()=ZIBMolPy.internals.InternalCoordinate-class.html#sub,Static Method ZIBMolPy.internals.LinearCoordinate.sub()=ZIBMolPy.internals.LinearCoordinate-class.html#sub"><a title="ZIBMolPy.internals.DihedralCoordinate.sub
ZIBMolPy.internals.InternalCoordinate.sub
ZIBMolPy.internals.LinearCoordinate.sub" class="py-name" href="#" onclick="return doclink('link-46', 'sub', 'link-46');">sub</a></tt><tt class="py-op">(</tt><tt class="py-string">"\nnsteps"</tt><tt class="py-op">,</tt> <tt class="py-string">"\n; zgf_setup_nodes: commented-out the following line\n; nsteps"</tt><tt class="py-op">,</tt> <tt class="py-name">orig_mdp</tt><tt class="py-op">)</tt> </tt>
<a name="L68"></a><tt class="py-lineno"> 68</tt>  <tt class="py-line">         </tt>
<a name="L69"></a><tt class="py-lineno"> 69</tt>  <tt class="py-line">        <tt class="py-keyword">for</tt> <tt class="py-name">n</tt> <tt class="py-keyword">in</tt> <tt id="link-47" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-47', 'pool', 'link-5');">pool</a></tt><tt class="py-op">.</tt><tt id="link-48" class="py-name"><a title="ZIBMolPy.pool.NodeList.where" class="py-name" href="#" onclick="return doclink('link-48', 'where', 'link-27');">where</a></tt><tt class="py-op">(</tt><tt class="py-string">"state == 'created'"</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L70"></a><tt class="py-lineno"> 70</tt>  <tt class="py-line">                <tt class="py-keyword">print</tt><tt class="py-op">(</tt><tt class="py-string">"Writing: "</tt><tt class="py-op">+</tt><tt class="py-name">n</tt><tt class="py-op">.</tt><tt id="link-49" class="py-name"><a title="ZIBMolPy.node.Node.mdp_fn" class="py-name" href="#" onclick="return doclink('link-49', 'mdp_fn', 'link-43');">mdp_fn</a></tt><tt class="py-op">)</tt> </tt>
<a name="L71"></a><tt class="py-lineno"> 71</tt>  <tt class="py-line">                <tt class="py-name">nsteps</tt> <tt class="py-op">=</tt> <tt class="py-name">int</tt><tt class="py-op">(</tt><tt class="py-name">n</tt><tt class="py-op">.</tt><tt class="py-name">sampling_length</tt> <tt class="py-op">/</tt> <tt class="py-name">dt</tt><tt class="py-op">)</tt> </tt>
<a name="L72"></a><tt class="py-lineno"> 72</tt>  <tt class="py-line">                <tt class="py-name">f</tt> <tt class="py-op">=</tt> <tt class="py-name">open</tt><tt class="py-op">(</tt><tt class="py-name">n</tt><tt class="py-op">.</tt><tt id="link-50" class="py-name"><a title="ZIBMolPy.node.Node.mdp_fn" class="py-name" href="#" onclick="return doclink('link-50', 'mdp_fn', 'link-43');">mdp_fn</a></tt><tt class="py-op">,</tt> <tt class="py-string">"w"</tt><tt class="py-op">)</tt> </tt>
<a name="L73"></a><tt class="py-lineno"> 73</tt>  <tt class="py-line">                <tt class="py-name">f</tt><tt class="py-op">.</tt><tt id="link-51" class="py-name" targets="Method ZIBMolPy.io.topology.Moleculetype.write()=ZIBMolPy.io.topology.Moleculetype-class.html#write,Method ZIBMolPy.io.topology.Section.write()=ZIBMolPy.io.topology.Section-class.html#write,Method ZIBMolPy.io.topology.Topology.write()=ZIBMolPy.io.topology.Topology-class.html#write,Method ZIBMolPy.topology.Topology.write()=ZIBMolPy.topology.Topology-class.html#write"><a title="ZIBMolPy.io.topology.Moleculetype.write
ZIBMolPy.io.topology.Section.write
ZIBMolPy.io.topology.Topology.write
ZIBMolPy.topology.Topology.write" class="py-name" href="#" onclick="return doclink('link-51', 'write', 'link-51');">write</a></tt><tt class="py-op">(</tt><tt class="py-name">orig_mdp</tt><tt class="py-op">)</tt> </tt>
<a name="L74"></a><tt class="py-lineno"> 74</tt>  <tt class="py-line">                <tt class="py-name">f</tt><tt class="py-op">.</tt><tt id="link-52" class="py-name"><a title="ZIBMolPy.io.topology.Moleculetype.write
ZIBMolPy.io.topology.Section.write
ZIBMolPy.io.topology.Topology.write
ZIBMolPy.topology.Topology.write" class="py-name" href="#" onclick="return doclink('link-52', 'write', 'link-51');">write</a></tt><tt class="py-op">(</tt><tt class="py-string">"\n; zgf_setup_nodes:\n"</tt><tt class="py-op">)</tt>  </tt>
<a name="L75"></a><tt class="py-lineno"> 75</tt>  <tt class="py-line">                <tt class="py-name">f</tt><tt class="py-op">.</tt><tt id="link-53" class="py-name"><a title="ZIBMolPy.io.topology.Moleculetype.write
ZIBMolPy.io.topology.Section.write
ZIBMolPy.io.topology.Topology.write
ZIBMolPy.topology.Topology.write" class="py-name" href="#" onclick="return doclink('link-53', 'write', 'link-51');">write</a></tt><tt class="py-op">(</tt><tt class="py-string">"nsteps = %d\n"</tt><tt class="py-op">%</tt><tt class="py-name">nsteps</tt><tt class="py-op">)</tt> </tt>
<a name="L76"></a><tt class="py-lineno"> 76</tt>  <tt class="py-line">                <tt class="py-name">f</tt><tt class="py-op">.</tt><tt id="link-54" class="py-name" targets="Method ZIBMolPy.io.trr.TrrFile.close()=ZIBMolPy.io.trr.TrrFile-class.html#close"><a title="ZIBMolPy.io.trr.TrrFile.close" class="py-name" href="#" onclick="return doclink('link-54', 'close', 'link-54');">close</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
</div><a name="L77"></a><tt class="py-lineno"> 77</tt>  <tt class="py-line"> </tt>
<a name="L78"></a><tt class="py-lineno"> 78</tt>  <tt class="py-line"><tt class="py-comment">#===============================================================================</tt> </tt>
<a name="extract_frames"></a><div id="extract_frames-def"><a name="L79"></a><tt class="py-lineno"> 79</tt> <a class="py-toggle" href="#" id="extract_frames-toggle" onclick="return toggle('extract_frames');">-</a><tt class="py-line"><tt class="py-keyword">def</tt> <a class="py-def-name" href="zgf_setup_nodes-module.html#extract_frames">extract_frames</a><tt class="py-op">(</tt><tt class="py-param">pool</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
</div><div id="extract_frames-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="extract_frames-expanded"><a name="L80"></a><tt class="py-lineno"> 80</tt>  <tt class="py-line">        <tt class="py-name">needy_nodes</tt> <tt class="py-op">=</tt> <tt id="link-55" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-55', 'pool', 'link-5');">pool</a></tt><tt class="py-op">.</tt><tt id="link-56" class="py-name"><a title="ZIBMolPy.pool.NodeList.where" class="py-name" href="#" onclick="return doclink('link-56', 'where', 'link-27');">where</a></tt><tt class="py-op">(</tt><tt class="py-string">"state == 'created'"</tt><tt class="py-op">)</tt> </tt>
<a name="L81"></a><tt class="py-lineno"> 81</tt>  <tt class="py-line">         </tt>
<a name="L82"></a><tt class="py-lineno"> 82</tt>  <tt class="py-line">        <tt class="py-comment"># we want to scan through a parent-trr only once - saves time</tt> </tt>
<a name="L83"></a><tt class="py-lineno"> 83</tt>  <tt class="py-line">        <tt class="py-name">parents</tt> <tt class="py-op">=</tt> <tt class="py-name">set</tt><tt class="py-op">(</tt><tt class="py-op">[</tt><tt class="py-name">n</tt><tt class="py-op">.</tt><tt class="py-name">parent</tt> <tt class="py-keyword">for</tt> <tt class="py-name">n</tt> <tt class="py-keyword">in</tt> <tt class="py-name">needy_nodes</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L84"></a><tt class="py-lineno"> 84</tt>  <tt class="py-line">        <tt class="py-keyword">for</tt> <tt class="py-name">p</tt> <tt class="py-keyword">in</tt> <tt class="py-name">parents</tt><tt class="py-op">:</tt> </tt>
<a name="L85"></a><tt class="py-lineno"> 85</tt>  <tt class="py-line">                <tt class="py-name">childs</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-name">n</tt> <tt class="py-keyword">for</tt> <tt class="py-name">n</tt> <tt class="py-keyword">in</tt> <tt class="py-name">needy_nodes</tt> <tt class="py-keyword">if</tt> <tt class="py-name">n</tt><tt class="py-op">.</tt><tt class="py-name">parent</tt> <tt class="py-op">==</tt> <tt class="py-name">p</tt><tt class="py-op">]</tt> </tt>
<a name="L86"></a><tt class="py-lineno"> 86</tt>  <tt class="py-line">                <tt class="py-name">childs</tt><tt class="py-op">.</tt><tt class="py-name">sort</tt><tt class="py-op">(</tt><tt class="py-name">key</tt><tt class="py-op">=</tt><tt class="py-keyword">lambda</tt> <tt id="link-57" class="py-name" targets="Variable zgf_refine.x=zgf_refine-module.html#x,Variable zgf_submit_job_HLRN.x=zgf_submit_job_HLRN-module.html#x"><a title="zgf_refine.x
zgf_submit_job_HLRN.x" class="py-name" href="#" onclick="return doclink('link-57', 'x', 'link-57');">x</a></tt><tt class="py-op">:</tt> <tt id="link-58" class="py-name"><a title="zgf_refine.x
zgf_submit_job_HLRN.x" class="py-name" href="#" onclick="return doclink('link-58', 'x', 'link-57');">x</a></tt><tt class="py-op">.</tt><tt class="py-name">parent_frame_num</tt><tt class="py-op">)</tt> </tt>
<a name="L87"></a><tt class="py-lineno"> 87</tt>  <tt class="py-line">                <tt class="py-name">trr_in</tt> <tt class="py-op">=</tt> <tt id="link-59" class="py-name"><a title="ZIBMolPy.io.trr.TrrFile" class="py-name" href="#" onclick="return doclink('link-59', 'TrrFile', 'link-16');">TrrFile</a></tt><tt class="py-op">(</tt><tt class="py-name">p</tt><tt class="py-op">.</tt><tt id="link-60" class="py-name" targets="Variable ZIBMolPy.node.Node.trr_fn=ZIBMolPy.node.Node-class.html#trr_fn"><a title="ZIBMolPy.node.Node.trr_fn" class="py-name" href="#" onclick="return doclink('link-60', 'trr_fn', 'link-60');">trr_fn</a></tt><tt class="py-op">)</tt> </tt>
<a name="L88"></a><tt class="py-lineno"> 88</tt>  <tt class="py-line">                 </tt>
<a name="L89"></a><tt class="py-lineno"> 89</tt>  <tt class="py-line">                <tt class="py-name">frame</tt> <tt class="py-op">=</tt> <tt class="py-name">trr_in</tt><tt class="py-op">.</tt><tt class="py-name">first_frame</tt> </tt>
<a name="L90"></a><tt class="py-lineno"> 90</tt>  <tt class="py-line">                <tt class="py-keyword">for</tt> <tt class="py-name">n</tt> <tt class="py-keyword">in</tt> <tt class="py-name">childs</tt><tt class="py-op">:</tt> </tt>
<a name="L91"></a><tt class="py-lineno"> 91</tt>  <tt class="py-line">                        <tt class="py-keyword">for</tt> <tt class="py-name">dummy</tt> <tt class="py-keyword">in</tt> <tt class="py-name">range</tt><tt class="py-op">(</tt><tt class="py-name">n</tt><tt class="py-op">.</tt><tt class="py-name">parent_frame_num</tt> <tt class="py-op">-</tt> <tt class="py-name">frame</tt><tt class="py-op">.</tt><tt class="py-name">number</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L92"></a><tt class="py-lineno"> 92</tt>  <tt class="py-line">                                <tt class="py-name">frame</tt> <tt class="py-op">=</tt> <tt class="py-name">frame</tt><tt class="py-op">.</tt><tt id="link-61" class="py-name" targets="Method ZIBMolPy.io.trr.TrrFrame.next()=ZIBMolPy.io.trr.TrrFrame-class.html#next"><a title="ZIBMolPy.io.trr.TrrFrame.next" class="py-name" href="#" onclick="return doclink('link-61', 'next', 'link-61');">next</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L93"></a><tt class="py-lineno"> 93</tt>  <tt class="py-line">                        <tt class="py-keyword">assert</tt><tt class="py-op">(</tt><tt class="py-name">frame</tt><tt class="py-op">.</tt><tt class="py-name">number</tt> <tt class="py-op">==</tt> <tt class="py-name">n</tt><tt class="py-op">.</tt><tt class="py-name">parent_frame_num</tt><tt class="py-op">)</tt> </tt>
<a name="L94"></a><tt class="py-lineno"> 94</tt>  <tt class="py-line">                        <tt class="py-name">trr_tmp_fn</tt> <tt class="py-op">=</tt> <tt class="py-name">mktemp</tt><tt class="py-op">(</tt><tt class="py-name">suffix</tt><tt class="py-op">=</tt><tt class="py-string">'.trr'</tt><tt class="py-op">)</tt> </tt>
<a name="L95"></a><tt class="py-lineno"> 95</tt>  <tt class="py-line">                        <tt class="py-name">trr_tmp</tt> <tt class="py-op">=</tt> <tt class="py-name">open</tt><tt class="py-op">(</tt><tt class="py-name">trr_tmp_fn</tt><tt class="py-op">,</tt> <tt class="py-string">"wb"</tt><tt class="py-op">)</tt> </tt>
<a name="L96"></a><tt class="py-lineno"> 96</tt>  <tt class="py-line">                        <tt class="py-name">trr_tmp</tt><tt class="py-op">.</tt><tt id="link-62" class="py-name"><a title="ZIBMolPy.io.topology.Moleculetype.write
ZIBMolPy.io.topology.Section.write
ZIBMolPy.io.topology.Topology.write
ZIBMolPy.topology.Topology.write" class="py-name" href="#" onclick="return doclink('link-62', 'write', 'link-51');">write</a></tt><tt class="py-op">(</tt><tt class="py-name">frame</tt><tt class="py-op">.</tt><tt id="link-63" class="py-name" targets="Variable ZIBMolPy.io.trr.TrrFrame.raw_data=ZIBMolPy.io.trr.TrrFrame-class.html#raw_data"><a title="ZIBMolPy.io.trr.TrrFrame.raw_data" class="py-name" href="#" onclick="return doclink('link-63', 'raw_data', 'link-63');">raw_data</a></tt><tt class="py-op">)</tt> </tt>
<a name="L97"></a><tt class="py-lineno"> 97</tt>  <tt class="py-line">                        <tt class="py-name">trr_tmp</tt><tt class="py-op">.</tt><tt id="link-64" class="py-name"><a title="ZIBMolPy.io.trr.TrrFile.close" class="py-name" href="#" onclick="return doclink('link-64', 'close', 'link-54');">close</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L98"></a><tt class="py-lineno"> 98</tt>  <tt class="py-line">                        <tt class="py-name">cmd</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-string">"trjconv"</tt><tt class="py-op">,</tt> <tt class="py-string">"-f"</tt><tt class="py-op">,</tt> <tt class="py-name">trr_tmp_fn</tt><tt class="py-op">,</tt> <tt class="py-string">"-o"</tt><tt class="py-op">,</tt> <tt class="py-name">n</tt><tt class="py-op">.</tt><tt id="link-65" class="py-name" targets="Variable ZIBMolPy.node.Node.pdb_fn=ZIBMolPy.node.Node-class.html#pdb_fn"><a title="ZIBMolPy.node.Node.pdb_fn" class="py-name" href="#" onclick="return doclink('link-65', 'pdb_fn', 'link-65');">pdb_fn</a></tt><tt class="py-op">,</tt> <tt class="py-string">"-s"</tt><tt class="py-op">,</tt> <tt class="py-name">n</tt><tt class="py-op">.</tt><tt class="py-name">parent</tt><tt class="py-op">.</tt><tt id="link-66" class="py-name"><a title="ZIBMolPy.node.Node.pdb_fn" class="py-name" href="#" onclick="return doclink('link-66', 'pdb_fn', 'link-65');">pdb_fn</a></tt><tt class="py-op">]</tt>  </tt>
<a name="L99"></a><tt class="py-lineno"> 99</tt>  <tt class="py-line">                        <tt class="py-name">p</tt> <tt class="py-op">=</tt> <tt class="py-name">Popen</tt><tt class="py-op">(</tt><tt class="py-name">cmd</tt><tt class="py-op">,</tt> <tt class="py-name">stdin</tt><tt class="py-op">=</tt><tt class="py-name">PIPE</tt><tt class="py-op">)</tt> </tt>
<a name="L100"></a><tt class="py-lineno">100</tt>  <tt class="py-line">                        <tt class="py-name">p</tt><tt class="py-op">.</tt><tt class="py-name">communicate</tt><tt class="py-op">(</tt><tt class="py-name">input</tt><tt class="py-op">=</tt><tt class="py-string">"System\n"</tt><tt class="py-op">)</tt> </tt>
<a name="L101"></a><tt class="py-lineno">101</tt>  <tt class="py-line">                        <tt class="py-keyword">assert</tt><tt class="py-op">(</tt><tt class="py-name">p</tt><tt class="py-op">.</tt><tt class="py-name">wait</tt><tt class="py-op">(</tt><tt class="py-op">)</tt> <tt class="py-op">==</tt> <tt class="py-number">0</tt><tt class="py-op">)</tt> </tt>
<a name="L102"></a><tt class="py-lineno">102</tt>  <tt class="py-line">                        <tt class="py-name">os</tt><tt class="py-op">.</tt><tt class="py-name">remove</tt><tt class="py-op">(</tt><tt class="py-name">trr_tmp_fn</tt><tt class="py-op">)</tt> </tt>
<a name="L103"></a><tt class="py-lineno">103</tt>  <tt class="py-line">                <tt class="py-name">trr_in</tt><tt class="py-op">.</tt><tt id="link-67" class="py-name"><a title="ZIBMolPy.io.trr.TrrFile.close" class="py-name" href="#" onclick="return doclink('link-67', 'close', 'link-54');">close</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L104"></a><tt class="py-lineno">104</tt>  <tt class="py-line">         </tt>
<a name="L105"></a><tt class="py-lineno">105</tt>  <tt class="py-line">         </tt>
<a name="L106"></a><tt class="py-lineno">106</tt>  <tt class="py-line">        <tt class="py-comment">#Check if the right frames where extracted</tt> </tt>
<a name="L107"></a><tt class="py-lineno">107</tt>  <tt class="py-line">        <tt class="py-comment"># In principle PDB coordinates should have a precision of 1e-4 nm</tt> </tt>
<a name="L108"></a><tt class="py-lineno">108</tt>  <tt class="py-line">        <tt class="py-comment"># beause they are given in Angstr&#246;m with three decimal places.</tt> </tt>
<a name="L109"></a><tt class="py-lineno">109</tt>  <tt class="py-line">         </tt>
<a name="L110"></a><tt class="py-lineno">110</tt>  <tt class="py-line">        <tt class="py-keyword">for</tt> <tt class="py-name">n</tt> <tt class="py-keyword">in</tt> <tt class="py-name">needy_nodes</tt><tt class="py-op">:</tt> </tt>
<a name="L111"></a><tt class="py-lineno">111</tt>  <tt class="py-line">                <tt class="py-name">a</tt> <tt class="py-op">=</tt> <tt id="link-68" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-68', 'pool', 'link-5');">pool</a></tt><tt class="py-op">.</tt><tt id="link-69" class="py-name" targets="Variable ZIBMolPy.internals.InternalArray.converter=ZIBMolPy.internals.InternalArray-class.html#converter,Variable ZIBMolPy.pool.Pool.converter=ZIBMolPy.pool.Pool-class.html#converter"><a title="ZIBMolPy.internals.InternalArray.converter
ZIBMolPy.pool.Pool.converter" class="py-name" href="#" onclick="return doclink('link-69', 'converter', 'link-69');">converter</a></tt><tt class="py-op">.</tt><tt id="link-70" class="py-name" targets="Method ZIBMolPy.internals.Converter.read_pdb()=ZIBMolPy.internals.Converter-class.html#read_pdb,Function ZIBMolPy.io.PDBTools.read_pdb()=ZIBMolPy.io.PDBTools-module.html#read_pdb"><a title="ZIBMolPy.internals.Converter.read_pdb
ZIBMolPy.io.PDBTools.read_pdb" class="py-name" href="#" onclick="return doclink('link-70', 'read_pdb', 'link-70');">read_pdb</a></tt><tt class="py-op">(</tt><tt class="py-name">n</tt><tt class="py-op">.</tt><tt id="link-71" class="py-name"><a title="ZIBMolPy.node.Node.pdb_fn" class="py-name" href="#" onclick="return doclink('link-71', 'pdb_fn', 'link-65');">pdb_fn</a></tt><tt class="py-op">)</tt> </tt>
<a name="L112"></a><tt class="py-lineno">112</tt>  <tt class="py-line">                <tt class="py-name">d</tt> <tt class="py-op">=</tt> <tt class="py-name">np</tt><tt class="py-op">.</tt><tt class="py-name">max</tt><tt class="py-op">(</tt><tt class="py-name">np</tt><tt class="py-op">.</tt><tt class="py-name">abs</tt><tt class="py-op">(</tt><tt class="py-name">n</tt><tt class="py-op">.</tt><tt id="link-72" class="py-name" targets="Module ZIBMolPy.internals=ZIBMolPy.internals-module.html,Variable ZIBMolPy.pool.NodeList.internals=ZIBMolPy.pool.NodeList-class.html#internals"><a title="ZIBMolPy.internals
ZIBMolPy.pool.NodeList.internals" class="py-name" href="#" onclick="return doclink('link-72', 'internals', 'link-72');">internals</a></tt><tt class="py-op">.</tt><tt id="link-73" class="py-name" targets="Variable ZIBMolPy.internals.InternalArray.array=ZIBMolPy.internals.InternalArray-class.html#array"><a title="ZIBMolPy.internals.InternalArray.array" class="py-name" href="#" onclick="return doclink('link-73', 'array', 'link-73');">array</a></tt> <tt class="py-op">-</tt> <tt class="py-name">a</tt><tt class="py-op">.</tt><tt id="link-74" class="py-name"><a title="ZIBMolPy.internals.InternalArray.array" class="py-name" href="#" onclick="return doclink('link-74', 'array', 'link-73');">array</a></tt><tt class="py-op">)</tt><tt class="py-op">)</tt> </tt>
<a name="L113"></a><tt class="py-lineno">113</tt>  <tt class="py-line">                <tt class="py-keyword">print</tt> <tt class="py-name">n</tt><tt class="py-op">.</tt><tt id="link-75" class="py-name" targets="Variable ZIBMolPy.node.Node.name=ZIBMolPy.node.Node-class.html#name,Method ZIBMolPy.topology.Moleculetype.name()=ZIBMolPy.topology.Moleculetype-class.html#name"><a title="ZIBMolPy.node.Node.name
ZIBMolPy.topology.Moleculetype.name" class="py-name" href="#" onclick="return doclink('link-75', 'name', 'link-75');">name</a></tt><tt class="py-op">+</tt><tt class="py-string">": pdb vs internals deviation: %.2e"</tt><tt class="py-op">%</tt><tt class="py-name">np</tt><tt class="py-op">.</tt><tt class="py-name">max</tt><tt class="py-op">(</tt><tt class="py-name">np</tt><tt class="py-op">.</tt><tt class="py-name">abs</tt><tt class="py-op">(</tt><tt class="py-name">n</tt><tt class="py-op">.</tt><tt id="link-76" class="py-name"><a title="ZIBMolPy.internals
ZIBMolPy.pool.NodeList.internals" class="py-name" href="#" onclick="return doclink('link-76', 'internals', 'link-72');">internals</a></tt><tt class="py-op">.</tt><tt id="link-77" class="py-name"><a title="ZIBMolPy.internals.InternalArray.array" class="py-name" href="#" onclick="return doclink('link-77', 'array', 'link-73');">array</a></tt> <tt class="py-op">-</tt> <tt class="py-name">a</tt><tt class="py-op">.</tt><tt id="link-78" class="py-name"><a title="ZIBMolPy.internals.InternalArray.array" class="py-name" href="#" onclick="return doclink('link-78', 'array', 'link-73');">array</a></tt><tt class="py-op">)</tt><tt class="py-op">)</tt> </tt>
<a name="L114"></a><tt class="py-lineno">114</tt>  <tt class="py-line">                <tt class="py-keyword">assert</tt><tt class="py-op">(</tt><tt class="py-number">1e-2</tt> <tt class="py-op">&gt;</tt> <tt class="py-name">d</tt><tt class="py-op">)</tt> </tt>
</div><a name="L115"></a><tt class="py-lineno">115</tt>  <tt class="py-line">                 </tt>
<a name="L116"></a><tt class="py-lineno">116</tt>  <tt class="py-line"><tt class="py-comment">#===============================================================================</tt> </tt>
<a name="generate_topology"></a><div id="generate_topology-def"><a name="L117"></a><tt class="py-lineno">117</tt> <a class="py-toggle" href="#" id="generate_topology-toggle" onclick="return toggle('generate_topology');">-</a><tt class="py-line"><tt class="py-keyword">def</tt> <a class="py-def-name" href="zgf_setup_nodes-module.html#generate_topology">generate_topology</a><tt class="py-op">(</tt><tt class="py-param">pool</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
</div><div id="generate_topology-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="generate_topology-expanded"><a name="L118"></a><tt class="py-lineno">118</tt>  <tt class="py-line">        <tt class="py-keyword">for</tt> <tt class="py-name">n</tt> <tt class="py-keyword">in</tt> <tt id="link-79" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-79', 'pool', 'link-5');">pool</a></tt><tt class="py-op">.</tt><tt id="link-80" class="py-name"><a title="ZIBMolPy.pool.NodeList.where" class="py-name" href="#" onclick="return doclink('link-80', 'where', 'link-27');">where</a></tt><tt class="py-op">(</tt><tt class="py-string">"state == 'created'"</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L119"></a><tt class="py-lineno">119</tt>  <tt class="py-line">                 </tt>
<a name="L120"></a><tt class="py-lineno">120</tt>  <tt class="py-line">                <tt class="py-keyword">if</tt><tt class="py-op">(</tt><tt class="py-keyword">not</tt> <tt class="py-name">n</tt><tt class="py-op">.</tt><tt id="link-81" class="py-name" targets="Variable ZIBMolPy.node.Node.has_restraints=ZIBMolPy.node.Node-class.html#has_restraints"><a title="ZIBMolPy.node.Node.has_restraints" class="py-name" href="#" onclick="return doclink('link-81', 'has_restraints', 'link-81');">has_restraints</a></tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L121"></a><tt class="py-lineno">121</tt>  <tt class="py-line">                        <tt class="py-name">shutil</tt><tt class="py-op">.</tt><tt class="py-name">copyfile</tt><tt class="py-op">(</tt><tt id="link-82" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-82', 'pool', 'link-5');">pool</a></tt><tt class="py-op">.</tt><tt id="link-83" class="py-name" targets="Variable ZIBMolPy.node.Node.top_fn=ZIBMolPy.node.Node-class.html#top_fn"><a title="ZIBMolPy.node.Node.top_fn" class="py-name" href="#" onclick="return doclink('link-83', 'top_fn', 'link-83');">top_fn</a></tt><tt class="py-op">,</tt> <tt class="py-name">n</tt><tt class="py-op">.</tt><tt id="link-84" class="py-name"><a title="ZIBMolPy.node.Node.top_fn" class="py-name" href="#" onclick="return doclink('link-84', 'top_fn', 'link-83');">top_fn</a></tt><tt class="py-op">)</tt> </tt>
<a name="L122"></a><tt class="py-lineno">122</tt>  <tt class="py-line">                        <tt class="py-keyword">continue</tt> </tt>
<a name="L123"></a><tt class="py-lineno">123</tt>  <tt class="py-line">                 </tt>
<a name="L124"></a><tt class="py-lineno">124</tt>  <tt class="py-line">                <tt class="py-comment"># load unmodified topology</tt> </tt>
<a name="L125"></a><tt class="py-lineno">125</tt>  <tt class="py-line">                <tt class="py-name">top</tt> <tt class="py-op">=</tt> <tt id="link-85" class="py-name"><a title="ZIBMolPy.io.topology
ZIBMolPy.topology" class="py-name" href="#" onclick="return doclink('link-85', 'topology', 'link-8');">topology</a></tt><tt class="py-op">.</tt><tt id="link-86" class="py-name" targets="Class ZIBMolPy.io.topology.Topology=ZIBMolPy.io.topology.Topology-class.html,Class ZIBMolPy.topology.Topology=ZIBMolPy.topology.Topology-class.html"><a title="ZIBMolPy.io.topology.Topology
ZIBMolPy.topology.Topology" class="py-name" href="#" onclick="return doclink('link-86', 'Topology', 'link-86');">Topology</a></tt><tt class="py-op">(</tt><tt id="link-87" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-87', 'pool', 'link-5');">pool</a></tt><tt class="py-op">.</tt><tt id="link-88" class="py-name"><a title="ZIBMolPy.node.Node.top_fn" class="py-name" href="#" onclick="return doclink('link-88', 'top_fn', 'link-83');">top_fn</a></tt><tt class="py-op">)</tt> </tt>
<a name="L126"></a><tt class="py-lineno">126</tt>  <tt class="py-line">                 </tt>
<a name="L127"></a><tt class="py-lineno">127</tt>  <tt class="py-line">                <tt class="py-comment">#k = node.alpha / get_beta(node.temperature) # in kJ/(mol rad^2)</tt> </tt>
<a name="L128"></a><tt class="py-lineno">128</tt>  <tt class="py-line">                 </tt>
<a name="L129"></a><tt class="py-lineno">129</tt>  <tt class="py-line">                <tt class="py-comment"># Gromacs topologies consist of molecules, where each molecule belongs to a moleculetype.</tt> </tt>
<a name="L130"></a><tt class="py-lineno">130</tt>  <tt class="py-line">                <tt class="py-comment"># Atoms, bonds, dihedrals belong to a moleculetype.</tt> </tt>
<a name="L131"></a><tt class="py-lineno">131</tt>  <tt class="py-line">                <tt class="py-comment"># Atomnumbers are counted in each moleculetype seperately, starting with 1 (internals start with 0)</tt> </tt>
<a name="L132"></a><tt class="py-lineno">132</tt>  <tt class="py-line">                <tt class="py-comment">#disres_idx = 0</tt> </tt>
<a name="L133"></a><tt class="py-lineno">133</tt>  <tt class="py-line">                 </tt>
<a name="L134"></a><tt class="py-lineno">134</tt>  <tt class="py-line">                <tt class="py-keyword">assert</tt><tt class="py-op">(</tt><tt class="py-name">len</tt><tt class="py-op">(</tt><tt id="link-89" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-89', 'pool', 'link-5');">pool</a></tt><tt class="py-op">.</tt><tt id="link-90" class="py-name"><a title="ZIBMolPy.internals.InternalArray.converter
ZIBMolPy.pool.Pool.converter" class="py-name" href="#" onclick="return doclink('link-90', 'converter', 'link-69');">converter</a></tt><tt class="py-op">)</tt> <tt class="py-op">==</tt> <tt class="py-name">len</tt><tt class="py-op">(</tt><tt class="py-name">n</tt><tt class="py-op">.</tt><tt class="py-name">restraints</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> </tt>
<a name="L135"></a><tt class="py-lineno">135</tt>  <tt class="py-line">                 </tt>
<a name="L136"></a><tt class="py-lineno">136</tt>  <tt class="py-line">                <tt class="py-keyword">for</tt> <tt class="py-op">(</tt><tt class="py-name">c</tt><tt class="py-op">,</tt> <tt class="py-name">r</tt><tt class="py-op">)</tt> <tt class="py-keyword">in</tt> <tt class="py-name">zip</tt><tt class="py-op">(</tt><tt id="link-91" class="py-name"><a title="ZIBMolPy.node.Node.pool
ZIBMolPy.pool" class="py-name" href="#" onclick="return doclink('link-91', 'pool', 'link-5');">pool</a></tt><tt class="py-op">.</tt><tt id="link-92" class="py-name"><a title="ZIBMolPy.internals.InternalArray.converter
ZIBMolPy.pool.Pool.converter" class="py-name" href="#" onclick="return doclink('link-92', 'converter', 'link-69');">converter</a></tt><tt class="py-op">,</tt> <tt class="py-name">n</tt><tt class="py-op">.</tt><tt class="py-name">restraints</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L137"></a><tt class="py-lineno">137</tt>  <tt class="py-line">                        <tt class="py-keyword">assert</tt><tt class="py-op">(</tt><tt class="py-name">c</tt><tt class="py-op">.</tt><tt id="link-93" class="py-name" targets="Variable ZIBMolPy.internals.InternalCoordinate.atoms=ZIBMolPy.internals.InternalCoordinate-class.html#atoms"><a title="ZIBMolPy.internals.InternalCoordinate.atoms" class="py-name" href="#" onclick="return doclink('link-93', 'atoms', 'link-93');">atoms</a></tt> <tt class="py-op">==</tt> <tt class="py-name">r</tt><tt class="py-op">.</tt><tt id="link-94" class="py-name"><a title="ZIBMolPy.internals.InternalCoordinate.atoms" class="py-name" href="#" onclick="return doclink('link-94', 'atoms', 'link-93');">atoms</a></tt><tt class="py-op">)</tt> <tt class="py-comment"># information is stored redundantly :-(</tt> </tt>
<a name="L138"></a><tt class="py-lineno">138</tt>  <tt class="py-line">                         </tt>
<a name="L139"></a><tt class="py-lineno">139</tt>  <tt class="py-line">                        <tt class="py-comment"># find Molecule of Interest</tt> </tt>
<a name="L140"></a><tt class="py-lineno">140</tt>  <tt class="py-line">                        <tt class="py-name">moi</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-name">top</tt><tt class="py-op">.</tt><tt id="link-95" class="py-name" targets="Method ZIBMolPy.topology.Topology.atomnum2molnum()=ZIBMolPy.topology.Topology-class.html#atomnum2molnum"><a title="ZIBMolPy.topology.Topology.atomnum2molnum" class="py-name" href="#" onclick="return doclink('link-95', 'atomnum2molnum', 'link-95');">atomnum2molnum</a></tt><tt class="py-op">(</tt><tt class="py-name">a</tt><tt class="py-op">+</tt><tt class="py-number">1</tt><tt class="py-op">)</tt> <tt class="py-keyword">for</tt> <tt class="py-name">a</tt> <tt class="py-keyword">in</tt> <tt class="py-name">r</tt><tt class="py-op">.</tt><tt id="link-96" class="py-name"><a title="ZIBMolPy.internals.InternalCoordinate.atoms" class="py-name" href="#" onclick="return doclink('link-96', 'atoms', 'link-93');">atoms</a></tt><tt class="py-op">]</tt> </tt>
<a name="L141"></a><tt class="py-lineno">141</tt>  <tt class="py-line">                        <tt class="py-keyword">if</tt><tt class="py-op">(</tt><tt class="py-keyword">not</tt> <tt class="py-name">len</tt><tt class="py-op">(</tt><tt class="py-name">set</tt><tt class="py-op">(</tt><tt class="py-name">moi</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> <tt class="py-op">==</tt> <tt class="py-number">1</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L142"></a><tt class="py-lineno">142</tt>  <tt class="py-line">                                <tt class="py-keyword">raise</tt><tt class="py-op">(</tt><tt class="py-name">Exception</tt><tt class="py-op">(</tt><tt class="py-string">"Found restraint that spans more than one molecule. Merge moleculetypes in topology."</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> </tt>
<a name="L143"></a><tt class="py-lineno">143</tt>  <tt class="py-line">                         </tt>
<a name="L144"></a><tt class="py-lineno">144</tt>  <tt class="py-line">                        <tt class="py-name">rel_atoms</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-name">top</tt><tt class="py-op">.</tt><tt id="link-97" class="py-name" targets="Method ZIBMolPy.topology.Topology.abs2rel_atomnum()=ZIBMolPy.topology.Topology-class.html#abs2rel_atomnum"><a title="ZIBMolPy.topology.Topology.abs2rel_atomnum" class="py-name" href="#" onclick="return doclink('link-97', 'abs2rel_atomnum', 'link-97');">abs2rel_atomnum</a></tt><tt class="py-op">(</tt><tt class="py-name">a</tt><tt class="py-op">+</tt><tt class="py-number">1</tt><tt class="py-op">)</tt> <tt class="py-keyword">for</tt> <tt class="py-name">a</tt> <tt class="py-keyword">in</tt> <tt class="py-name">r</tt><tt class="py-op">.</tt><tt id="link-98" class="py-name"><a title="ZIBMolPy.internals.InternalCoordinate.atoms" class="py-name" href="#" onclick="return doclink('link-98', 'atoms', 'link-93');">atoms</a></tt><tt class="py-op">]</tt> </tt>
<a name="L145"></a><tt class="py-lineno">145</tt>  <tt class="py-line">                        <tt class="py-name">moltype_of_interest</tt> <tt class="py-op">=</tt> <tt class="py-name">top</tt><tt class="py-op">.</tt><tt id="link-99" class="py-name" targets="Method ZIBMolPy.topology.Topology.molnum2moltype()=ZIBMolPy.topology.Topology-class.html#molnum2moltype"><a title="ZIBMolPy.topology.Topology.molnum2moltype" class="py-name" href="#" onclick="return doclink('link-99', 'molnum2moltype', 'link-99');">molnum2moltype</a></tt><tt class="py-op">(</tt><tt class="py-name">moi</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L146"></a><tt class="py-lineno">146</tt>  <tt class="py-line">                        <tt class="py-keyword">if</tt> <tt class="py-name">isinstance</tt><tt class="py-op">(</tt><tt class="py-name">r</tt><tt class="py-op">,</tt> <tt id="link-100" class="py-name"><a title="ZIBMolPy.restraint.DihedralRestraint" class="py-name" href="#" onclick="return doclink('link-100', 'DihedralRestraint', 'link-2');">DihedralRestraint</a></tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L147"></a><tt class="py-lineno">147</tt>  <tt class="py-line">                                <tt class="py-op">(</tt><tt class="py-name">phi0</tt><tt class="py-op">,</tt> <tt class="py-name">dphi</tt><tt class="py-op">,</tt> <tt class="py-name">k</tt><tt class="py-op">)</tt> <tt class="py-op">=</tt> <tt class="py-name">r</tt><tt class="py-op">.</tt><tt class="py-name">params</tt> </tt>
<a name="L148"></a><tt class="py-lineno">148</tt>  <tt class="py-line">                                <tt class="py-name">t</tt> <tt class="py-op">=</tt> <tt class="py-name">tuple</tt><tt class="py-op">(</tt> <tt class="py-name">rel_atoms</tt> <tt class="py-op">+</tt> <tt class="py-op">[</tt><tt class="py-name">degrees</tt><tt class="py-op">(</tt><tt class="py-name">phi0</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> <tt class="py-name">degrees</tt><tt class="py-op">(</tt><tt class="py-name">dphi</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> <tt class="py-name">k</tt><tt class="py-op">]</tt> <tt class="py-op">)</tt> </tt>
<a name="L149"></a><tt class="py-lineno">149</tt>  <tt class="py-line">                                <tt class="py-name">newline</tt> <tt class="py-op">=</tt> <tt class="py-string">"%d  %d  %d  %d  1  1  %.10f  %.10f  %.10f  2; ZIBgridfree\n"</tt> <tt class="py-op">%</tt> <tt class="py-name">t</tt> </tt>
<a name="L150"></a><tt class="py-lineno">150</tt>  <tt class="py-line">                                <tt class="py-name">moltype_of_interest</tt><tt class="py-op">.</tt><tt id="link-101" class="py-name" targets="Method ZIBMolPy.topology.Moleculetype.add2section()=ZIBMolPy.topology.Moleculetype-class.html#add2section"><a title="ZIBMolPy.topology.Moleculetype.add2section" class="py-name" href="#" onclick="return doclink('link-101', 'add2section', 'link-101');">add2section</a></tt><tt class="py-op">(</tt><tt class="py-string">"dihedral_restraints"</tt><tt class="py-op">,</tt> <tt class="py-name">newline</tt><tt class="py-op">)</tt> </tt>
<a name="L151"></a><tt class="py-lineno">151</tt>  <tt class="py-line">                         </tt>
<a name="L152"></a><tt class="py-lineno">152</tt>  <tt class="py-line">                        <tt class="py-keyword">elif</tt> <tt class="py-name">isinstance</tt><tt class="py-op">(</tt><tt class="py-name">r</tt><tt class="py-op">,</tt> <tt id="link-102" class="py-name"><a title="ZIBMolPy.restraint.DistanceRestraint" class="py-name" href="#" onclick="return doclink('link-102', 'DistanceRestraint', 'link-3');">DistanceRestraint</a></tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L153"></a><tt class="py-lineno">153</tt>  <tt class="py-line">                                <tt class="py-op">(</tt><tt class="py-name">r0_scaled</tt><tt class="py-op">,</tt> <tt class="py-name">r1_scaled</tt><tt class="py-op">,</tt> <tt class="py-name">r2_scaled</tt><tt class="py-op">,</tt> <tt class="py-name">k_scaled</tt><tt class="py-op">)</tt> <tt class="py-op">=</tt> <tt class="py-name">r</tt><tt class="py-op">.</tt><tt class="py-name">params</tt> </tt>
<a name="L154"></a><tt class="py-lineno">154</tt>  <tt class="py-line">                                 </tt>
<a name="L155"></a><tt class="py-lineno">155</tt>  <tt class="py-line">                                <tt class="py-name">r0_real</tt> <tt class="py-op">=</tt> <tt class="py-name">c</tt><tt class="py-op">.</tt><tt id="link-103" class="py-name" targets="Method ZIBMolPy.internals.LinearCoordinate.scaled2real()=ZIBMolPy.internals.LinearCoordinate-class.html#scaled2real"><a title="ZIBMolPy.internals.LinearCoordinate.scaled2real" class="py-name" href="#" onclick="return doclink('link-103', 'scaled2real', 'link-103');">scaled2real</a></tt><tt class="py-op">(</tt><tt class="py-name">r0_scaled</tt><tt class="py-op">)</tt> </tt>
<a name="L156"></a><tt class="py-lineno">156</tt>  <tt class="py-line">                                <tt class="py-name">r1_real</tt> <tt class="py-op">=</tt> <tt class="py-name">c</tt><tt class="py-op">.</tt><tt id="link-104" class="py-name"><a title="ZIBMolPy.internals.LinearCoordinate.scaled2real" class="py-name" href="#" onclick="return doclink('link-104', 'scaled2real', 'link-103');">scaled2real</a></tt><tt class="py-op">(</tt><tt class="py-name">r1_scaled</tt><tt class="py-op">)</tt> </tt>
<a name="L157"></a><tt class="py-lineno">157</tt>  <tt class="py-line">                                <tt class="py-name">r2_real</tt> <tt class="py-op">=</tt> <tt class="py-name">c</tt><tt class="py-op">.</tt><tt id="link-105" class="py-name"><a title="ZIBMolPy.internals.LinearCoordinate.scaled2real" class="py-name" href="#" onclick="return doclink('link-105', 'scaled2real', 'link-103');">scaled2real</a></tt><tt class="py-op">(</tt><tt class="py-name">r2_scaled</tt><tt class="py-op">)</tt> </tt>
<a name="L158"></a><tt class="py-lineno">158</tt>  <tt class="py-line">                                <tt class="py-name">k_real</tt>  <tt class="py-op">=</tt> <tt class="py-name">k_scaled</tt> <tt class="py-op">*</tt> <tt class="py-name">pow</tt><tt class="py-op">(</tt><tt class="py-name">c</tt><tt class="py-op">.</tt><tt id="link-106" class="py-name" targets="Variable ZIBMolPy.internals.LinearCoordinate.weight=ZIBMolPy.internals.LinearCoordinate-class.html#weight"><a title="ZIBMolPy.internals.LinearCoordinate.weight" class="py-name" href="#" onclick="return doclink('link-106', 'weight', 'link-106');">weight</a></tt><tt class="py-op">,</tt><tt class="py-number">2</tt><tt class="py-op">)</tt> </tt>
<a name="L159"></a><tt class="py-lineno">159</tt>  <tt class="py-line">                                 </tt>
<a name="L160"></a><tt class="py-lineno">160</tt>  <tt class="py-line">                                <tt class="py-comment">#t = tuple( rel_atoms + [disres_idx] + [r0, r1, r2, k] )</tt> </tt>
<a name="L161"></a><tt class="py-lineno">161</tt>  <tt class="py-line">                                <tt class="py-comment">#newline = "%d  %d  1  %d  1  %.10f  %.10f  %.10f  %.10f; ZIBgridfree\n" % t</tt> </tt>
<a name="L162"></a><tt class="py-lineno">162</tt>  <tt class="py-line">                                <tt class="py-comment">#moltype_of_interest.add2section("distance_restraints", newline)</tt> </tt>
<a name="L163"></a><tt class="py-lineno">163</tt>  <tt class="py-line">                                <tt class="py-comment"># Using bond type 10 instead of "true" distance restraints because</tt> </tt>
<a name="L164"></a><tt class="py-lineno">164</tt>  <tt class="py-line">                                <tt class="py-comment"># - it will keep the molecule together when resolving PBC</tt> </tt>
<a name="L165"></a><tt class="py-lineno">165</tt>  <tt class="py-line">                                <tt class="py-comment"># - distance restraints do not write energies to edr when DD is on</tt> </tt>
<a name="L166"></a><tt class="py-lineno">166</tt>  <tt class="py-line">                                 </tt>
<a name="L167"></a><tt class="py-lineno">167</tt>  <tt class="py-line">                                <tt class="py-name">t</tt> <tt class="py-op">=</tt> <tt class="py-name">tuple</tt><tt class="py-op">(</tt> <tt class="py-name">rel_atoms</tt> <tt class="py-op">+</tt> <tt class="py-op">[</tt><tt class="py-name">r0_real</tt><tt class="py-op">,</tt> <tt class="py-name">r1_real</tt><tt class="py-op">,</tt> <tt class="py-name">r2_real</tt><tt class="py-op">,</tt> <tt class="py-name">k_real</tt><tt class="py-op">]</tt> <tt class="py-op">)</tt> </tt>
<a name="L168"></a><tt class="py-lineno">168</tt>  <tt class="py-line">                                <tt class="py-name">newline</tt> <tt class="py-op">=</tt> <tt class="py-string">"%d  %d  10  %.10f  %.10f  %.10f  %.10f; ZIBgridfree\n"</tt> <tt class="py-op">%</tt> <tt class="py-name">t</tt> </tt>
<a name="L169"></a><tt class="py-lineno">169</tt>  <tt class="py-line">                                <tt class="py-name">moltype_of_interest</tt><tt class="py-op">.</tt><tt id="link-107" class="py-name"><a title="ZIBMolPy.topology.Moleculetype.add2section" class="py-name" href="#" onclick="return doclink('link-107', 'add2section', 'link-101');">add2section</a></tt><tt class="py-op">(</tt><tt class="py-string">"bonds"</tt><tt class="py-op">,</tt> <tt class="py-name">newline</tt><tt class="py-op">)</tt> </tt>
<a name="L170"></a><tt class="py-lineno">170</tt>  <tt class="py-line">                                <tt class="py-comment">#disres_idx += 1</tt> </tt>
<a name="L171"></a><tt class="py-lineno">171</tt>  <tt class="py-line">                                 </tt>
<a name="L172"></a><tt class="py-lineno">172</tt>  <tt class="py-line">                        <tt class="py-keyword">else</tt><tt class="py-op">:</tt> </tt>
<a name="L173"></a><tt class="py-lineno">173</tt>  <tt class="py-line">                                <tt class="py-keyword">raise</tt><tt class="py-op">(</tt><tt class="py-name">Exception</tt><tt class="py-op">(</tt><tt class="py-string">"Unkown Restraint-Type"</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> </tt>
<a name="L174"></a><tt class="py-lineno">174</tt>  <tt class="py-line">                         </tt>
<a name="L175"></a><tt class="py-lineno">175</tt>  <tt class="py-line">                <tt class="py-keyword">print</tt><tt class="py-op">(</tt><tt class="py-string">"Writing: %s"</tt><tt class="py-op">%</tt><tt class="py-name">n</tt><tt class="py-op">.</tt><tt id="link-108" class="py-name"><a title="ZIBMolPy.node.Node.top_fn" class="py-name" href="#" onclick="return doclink('link-108', 'top_fn', 'link-83');">top_fn</a></tt><tt class="py-op">)</tt> </tt>
<a name="L176"></a><tt class="py-lineno">176</tt>  <tt class="py-line">                <tt class="py-name">top</tt><tt class="py-op">.</tt><tt id="link-109" class="py-name"><a title="ZIBMolPy.io.topology.Moleculetype.write
ZIBMolPy.io.topology.Section.write
ZIBMolPy.io.topology.Topology.write
ZIBMolPy.topology.Topology.write" class="py-name" href="#" onclick="return doclink('link-109', 'write', 'link-51');">write</a></tt><tt class="py-op">(</tt><tt class="py-name">n</tt><tt class="py-op">.</tt><tt id="link-110" class="py-name"><a title="ZIBMolPy.node.Node.top_fn" class="py-name" href="#" onclick="return doclink('link-110', 'top_fn', 'link-83');">top_fn</a></tt><tt class="py-op">)</tt> </tt>
</div><a name="L177"></a><tt class="py-lineno">177</tt>  <tt class="py-line"> </tt>
<a name="L178"></a><tt class="py-lineno">178</tt>  <tt class="py-line"> </tt>
<a name="L179"></a><tt class="py-lineno">179</tt>  <tt class="py-line"><tt class="py-comment">#===============================================================================</tt> </tt>
<a name="L180"></a><tt class="py-lineno">180</tt>  <tt class="py-line"><tt class="py-keyword">if</tt><tt class="py-op">(</tt><tt class="py-name">__name__</tt> <tt class="py-op">==</tt> <tt class="py-string">"__main__"</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L181"></a><tt class="py-lineno">181</tt>  <tt class="py-line">        <tt id="link-111" class="py-name" targets="Function zgf_analyze.main()=zgf_analyze-module.html#main,Function zgf_browser.main()=zgf_browser-module.html#main,Function zgf_cleanup.main()=zgf_cleanup-module.html#main,Function zgf_create_nodes.main()=zgf_create_nodes-module.html#main,Function zgf_create_pool.main()=zgf_create_pool-module.html#main,Function zgf_create_rates.main()=zgf_create_rates-module.html#main,Function zgf_create_unrestrained_nodes.main()=zgf_create_unrestrained_nodes-module.html#main,Function zgf_extract_conformations.main()=zgf_extract_conformations-module.html#main,Function zgf_gauge_times.main()=zgf_gauge_times-module.html#main,Function zgf_genion.main()=zgf_genion-module.html#main,Function zgf_grompp.main()=zgf_grompp-module.html#main,Function zgf_mdrun.main()=zgf_mdrun-module.html#main,Function zgf_recover_failed.main()=zgf_recover_failed-module.html#main,Function zgf_refine.main()=zgf_refine-module.html#main,Function zgf_remove_nodes.main()=zgf_remove_nodes-module.html#main,Function zgf_reweight.main()=zgf_reweight-module.html#main,Function zgf_setup_nodes.main()=zgf_setup_nodes-module.html#main,Function zgf_solvate_nodes.main()=zgf_solvate_nodes-module.html#main,Function zgf_submit_job_HLRN.main()=zgf_submit_job_HLRN-module.html#main,Function zgf_test.main()=zgf_test-module.html#main,Function zgf_upgrade.main()=zgf_upgrade-module.html#main"><a title="zgf_analyze.main
zgf_browser.main
zgf_cleanup.main
zgf_create_nodes.main
zgf_create_pool.main
zgf_create_rates.main
zgf_create_unrestrained_nodes.main
zgf_extract_conformations.main
zgf_gauge_times.main
zgf_genion.main
zgf_grompp.main
zgf_mdrun.main
zgf_recover_failed.main
zgf_refine.main
zgf_remove_nodes.main
zgf_reweight.main
zgf_setup_nodes.main
zgf_solvate_nodes.main
zgf_submit_job_HLRN.main
zgf_test.main
zgf_upgrade.main" class="py-name" href="#" onclick="return doclink('link-111', 'main', 'link-111');">main</a></tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L182"></a><tt class="py-lineno">182</tt>  <tt class="py-line"> </tt>
<a name="L183"></a><tt class="py-lineno">183</tt>  <tt class="py-line"><tt class="py-comment">#EOF</tt> </tt>
<a name="L184"></a><tt class="py-lineno">184</tt>  <tt class="py-line"> </tt><script type="text/javascript">
<!--
expandto(location.href);
// -->
</script>
</pre>
<br />
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">
  <!-- Home link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="ZIBMolPy-module.html">Home</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="https://wiki.kobv.de/confluence/display/AGCMD/ZIBMolPy">ZIBMolPy</a></th>
          </tr></table></th>
  </tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%%">
  <tr>
    <td align="left" class="footer">
    Generated by Epydoc 3.0.1 on Fri Jul  6 17:41:52 2012
    </td>
    <td align="right" class="footer">
      <a target="mainFrame" href="http://epydoc.sourceforge.net"
        >http://epydoc.sourceforge.net</a>
    </td>
  </tr>
</table>

<script type="text/javascript">
  <!--
  // Private objects are initially displayed (because if
  // javascript is turned off then we want them to be
  // visible); but by default, we want to hide them.  So hide
  // them unless we have a cookie that says to show them.
  checkCookie();
  // -->
</script>
</body>
</html>
